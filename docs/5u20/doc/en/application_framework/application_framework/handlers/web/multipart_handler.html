


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv='content-language' content='ja'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.2.9. Multipart Request Handler &mdash; ∇Nablarch  5u20 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  

  
  <link rel="canonical" href="https://nablarch.github.io/docs/LATEST/doc/application_framework/application_framework/handlers/web/multipart_handler.html" />
  
    <link rel="top" title="∇Nablarch  5u20 documentation" href="../../../../index.html"/>
        <link rel="up" title="6.2. Web Application Dedicated Handler" href="index.html"/>
        <link rel="next" title="6.2.10. Session Variable Store Handler" href="SessionStoreHandler.html"/>
        <link rel="prev" title="6.2.8. HTTP Access Log Handler" href="http_access_log_handler.html"/>
 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  
  <a href="../../../../index.html" id="sidebar-title" class="icon"> ∇Nablarch 
  

  
    <div id="sidebar-version">Version: 5u20</div>
  </a>

  <div role="search">
    <form id="google-search-form" class="wy-form" method="get" action="https://www.google.co.jp/search">
      <input type="text" name="text" placeholder="Search docs on google" id="text"/>
      <input type="hidden" name="q" id="q"/>
    </form>
  </div>
    
    

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../about_nablarch/index.html">What is the Nablarch?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/concept.html">Nablarch Concept</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#robustness">Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#testability">Testability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#ready-to-use">Ready-to-Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/mvn_module.html">Module List of Nablarch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/license.html">Information on Nablarch License</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Nablarch Application Framework</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Application Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../nablarch/index.html">1. What is Nablarch Application Framework?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/index.html">2. Web Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web_service/index.html">3. Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../batch/index.html">4. Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../messaging/index.html">5. Messaging</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">6. Standard Handler Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../libraries/index.html">7. Libraries Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../blank_project/index.html">8. Blank Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../setting_guide/index.html">9. Nablarch Application Framework Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/index.html">10. Default Configuration List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cloud_native/index.html">11. Nablarch Cloud Native Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../adaptors/index.html">Adaptor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/log_adaptor.html">log Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/router_adaptor.html">Routing Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/webspheremq_adaptor.html">IBM WebSphere MQ Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/jaxrs_adaptor.html">JAX-RS Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/doma_adaptor.html">Doma Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/jsr310_adaptor.html">JSR310(Date and Time API)Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_freemarker_adaptor.html">E-mail FreeMarker Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_thymeleaf_adaptor.html">E-mail Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_velocity_adaptor.html">E-mail Velocity Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/web_thymeleaf_adaptor.html">Web Application Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/lettuce_adaptor.html">Lettuce Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/slf4j_adaptor.html">SLF4J Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/micrometer_adaptor.html">Micrometer Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../example/index.html">Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../example/index.html#procedure-to-build-the-environment">Procedure to build the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../example/index.html#application-execution-procedure">Application execution procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../extension_components/index.html">Nablarch extension component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/report/index.html">1. Form library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/workflow/doc/index.html">2. Workflow library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/workflow/tool/index.html">3. Workflow definition data generation tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/etl/index.html">4. ETL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/etl/etl_maven_plugin.html">5. ETL Maven plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development_tools/index.html">Nablarch development tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html">1. Efficient Java Static Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#conduct-syntax-check">1.1. Conduct syntax check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#unify-the-format">1.2. Unify the format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#check-if-unauthorized-apis-are-being-used">1.3. Check if unauthorized APIs are being used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/ui_dev/index.html">2. Front-end UI development platform for advanced users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/testing_framework/index.html">3. Testing framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/05_UnitTestGuide/index.html">3.1. How to Execute Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/06_TestFWGuide/index.html">3.2. How to Use the Automated Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/08_TestTools/index.html">3.3. Tools Used in the Programming Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/toolbox/index.html">4. Useful Tools When Developing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/JspStaticAnalysis/index.html">4.1. JSP Static Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/SqlExecutor/SqlExecutor.html">4.2. Nablarch SQL Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/JspVerifier/JspVerifier.html">4.3. Job Screen JSP Validation Tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/index.html">Nablarch Implementation Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/01/index.html">Sample Password Encryption Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/0101_PBKDF2PasswordEncryptor.html">Sample Password Encryption Function Using PBKDF2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/02/index.html">Extended Validation Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#email-address-validation">Email address validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#validation-of-japan-telephone-numbers">Validation of Japan telephone numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#code-value-validation">Code value validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/03/index.html">Display a List of Search Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-use">How to Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#listsearchinfo-class">ListSearchInfo class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#listsearchresult-tag">listSearchResult tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#sort-search-results">Sort search results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-implement-displaying-a-list-of-all-search-results-on-a-single-screen">How to implement displaying a list of all search results on a single screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-implement-the-initial-display-of-search-results-with-the-default-search-conditions">How to implement the initial display of search results with the default search conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#default-settings-for-the-search-result-list-display-function">Default settings for the search result list display function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-import-a-sample-implementation-tag-file-into-the-business-application">How to import a sample implementation (tag file) into the business application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#tag-reference">Tag Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/04/index.html">Extended Formatter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/04/0401_ExtendedDataFormatter.html">Data Formatter Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/04/0402_ExtendedFieldType.html">Field Type Expansion in the Data Formatter Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/05/index.html">Sample File Management Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/06/index.html">CAPTCHA Function Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/06_Captcha_guide.html">How to Incorporate the CAPTCHA Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/07/index.html">Sample UserAgent Information Acquisition Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#description-of-configuration">Description of configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#use-case">Use case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/08/index.html">Sample of HTML Email Send Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#implementation-examples">Implementation examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/09/index.html">How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#environment-preparation">Environment preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#structure-of-digitally-signed-email-send-function">Structure of digitally signed email send function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#preparation-of-configuration-file">Preparation of configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/10/index.html">How to Use the Log Aggregation Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/10/index.html#list-of-samples-provided">List of samples provided</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/11/index.html">Messaging Platform Test Simulator Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#uses">Uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#how-to-use">How to use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#expansion-example">Expansion example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nablarch_api/index.html">Nablarch API</a></li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">∇Nablarch </a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../index.html">Nablarch Application Framework</a> &raquo;</li>
      
          <li><a href="../../index.html">Application Framework</a> &raquo;</li>
      
          <li><a href="../index.html">6. Standard Handler Provided by Nablarch</a> &raquo;</li>
      
          <li><a href="index.html">6.2. Web Application Dedicated Handler</a> &raquo;</li>
      
    <li>6.2.9. Multipart Request Handler</li>
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/nablarch" class="fa fa-github">GitHub</a>
    </li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://nablarch.github.io/docs/LATEST/doc/index.html" class="ja">日本語</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="multipart-request-handler">
<span id="multipart-handler"></span><h1>6.2.9. Multipart Request Handler<a class="headerlink" href="#multipart-request-handler" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#handler-class-name" id="id2">Handler class name</a></li>
<li><a class="reference internal" href="#module-list" id="id3">Module list</a></li>
<li><a class="reference internal" href="#constraints" id="id4">Constraints</a></li>
<li><a class="reference internal" href="#operating-conditions-of-this-handler" id="id5">Operating conditions of this handler</a></li>
<li><a class="reference internal" href="#specify-the-temporary-storage-location-for-upload-files" id="id6">Specify the temporary storage location for upload files</a></li>
<li><a class="reference internal" href="#prevent-uploading-of-large-files" id="id7">Prevent uploading of large files</a></li>
<li><a class="reference internal" href="#delete-clean-temporary-files" id="id8">Delete (clean) temporary files</a></li>
<li><a class="reference internal" href="#configure-the-transition-destination-screen-for-multipart-parsing-error-and-file-size-upper-limit-are-exceeded" id="id9">Configure the transition destination screen for multipart parsing error and file size upper limit are exceeded</a></li>
<li><a class="reference internal" href="#read-the-upload-file" id="id10">Read the upload file</a></li>
</ul>
</div>
<p>This handler parses the body part and saves the uploaded file as a temporary file when the HTTP request is in the multipart format.</p>
<p>This handler performs the following processes.</p>
<ul class="simple">
<li>Parses multi-part requests</li>
<li>Saves upload files as temporary files</li>
<li>Deletes saved temporary files</li>
</ul>
<p>The process flow is as follows.</p>
<img alt="../../../../_images/flow36.png" src="../../../../_images/flow36.png" />
<div class="section" id="handler-class-name">
<h2><a class="toc-backref" href="#id2">6.2.9.1. Handler class name</a><a class="headerlink" href="#handler-class-name" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/web/upload/MultipartHandler.html" title="nablarch.fw.web.upload.MultipartHandler">nablarch.fw.web.upload.MultipartHandler</a></li>
</ul>
</div>
<div class="section" id="module-list">
<h2><a class="toc-backref" href="#id3">6.2.9.2. Module list</a><a class="headerlink" href="#module-list" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.framework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-fw-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- Only when specifying the temporary storage location --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.framework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-core<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="constraints">
<span id="multipart-handler-constraint"></span><h2><a class="toc-backref" href="#id4">6.2.9.3. Constraints</a><a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h2>
<p>None.</p>
</div>
<div class="section" id="operating-conditions-of-this-handler">
<h2><a class="toc-backref" href="#id5">6.2.9.4. Operating conditions of this handler</a><a class="headerlink" href="#operating-conditions-of-this-handler" title="Permalink to this headline">¶</a></h2>
<p>This handler parses the request body only for multipart requests. Whether the request is in a multipart format is determined based on the <code class="docutils literal"><span class="pre">Content-Type</span></code> of the request header.</p>
<p>When the <code class="docutils literal"><span class="pre">Content-Type</span></code> matches the <code class="docutils literal"><span class="pre">multipart/form-data</span></code>, the request is determined to be in multipart format and the body is parsed.
In case of other requests, this handler does nothing and delegates processing to the subsequent handlers.</p>
</div>
<div class="section" id="specify-the-temporary-storage-location-for-upload-files">
<h2><a class="toc-backref" href="#id6">6.2.9.5. Specify the temporary storage location for upload files</a><a class="headerlink" href="#specify-the-temporary-storage-location-for-upload-files" title="Permalink to this headline">¶</a></h2>
<p>Configure the temporary storage directory for upload file in <a class="reference internal" href="../../libraries/file_path_management.html#file-path-management"><span>File path management</span></a>.</p>
<p>If the temporary storage destination directory is not specified in file path management, the value of system property <cite>java.io.tmpdir</cite> is used as the default storage destination.</p>
<p>Below is a configuration example for the destination directory for temporary files.</p>
<dl class="docutils">
<dt>Point</dt>
<dd><ul class="first last simple">
<li>The logical name of the storage destination directory should be <code class="docutils literal"><span class="pre">uploadFileTmpDir</span></code>.</li>
</ul>
</dd>
</dl>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;filePathSetting&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.core.util.FilePathSetting&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Configuration of directory--&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;basePathSettings&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;map&gt;</span>
      <span class="c">&lt;!-- Temporary storage directory for the upload file --&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;uploadFileTmpDir&quot;</span> <span class="na">value=</span><span class="s">&quot;file:/var/nablarch/uploadTmpDir&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/map&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>In the above example, the storage destination directory is specified directly, but this value will change depending on the environment.
Therefore, it is recommended that the directory be configured in the environment configuration file instead of configuring the directory directly in the component configuration file.</p>
<p class="last">For details, see <a class="reference internal" href="../../libraries/repository.html#repository-environment-configuration"><span>Set the dependent value</span></a>.</p>
</div>
</div>
<div class="section" id="prevent-uploading-of-large-files">
<span id="multipart-handler-file-limit"></span><h2><a class="toc-backref" href="#id7">6.2.9.6. Prevent uploading of large files</a><a class="headerlink" href="#prevent-uploading-of-large-files" title="Permalink to this headline">¶</a></h2>
<p>If a large file is uploaded, the system may not operate normally due to insufficient disc space.
Therefore, this handler returns 400 (Bad Request) to the client when the maximum upload size is exceeded.</p>
<p>The upper limit of upload size is configured in bytes. If the value is not configured, there is no limit to the upload size.</p>
<p>A configuration example for the upload size is shown below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.fw.web.upload.MultipartHandler&quot;</span> <span class="na">name=</span><span class="s">&quot;multipartHandler&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;uploadSettings&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.fw.web.upload.UploadSettings&quot;</span><span class="nt">&gt;</span>
      <span class="c">&lt;!-- Upload size (Content-Length) upper limit (about 10M) --&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;contentLengthLimit&quot;</span> <span class="na">value=</span><span class="s">&quot;1000000&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/component&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>The upper limit of the upload size is not for a file, but for one request.</p>
<p>Therefore, when multiple files are uploaded, the upper limit check is based on the total of the file sizes (strictly speaking, by Content-Length).</p>
<p class="last">If the size of each file is to be checked, implement the check in the action.</p>
</div>
</div>
<div class="section" id="delete-clean-temporary-files">
<h2><a class="toc-backref" href="#id8">6.2.9.7. Delete (clean) temporary files</a><a class="headerlink" href="#delete-clean-temporary-files" title="Permalink to this headline">¶</a></h2>
<p>Clean the upload files based on the following conditions.</p>
<ul class="simple">
<li>If an exception occurs while parsing of the body is in progress</li>
<li>When automatic deletion configuration is enabled on the return path of the handler</li>
</ul>
<p>The automatic deletion configuration is enabled by default.
Note that if this setting is disabled in the production environment, a large number of temporary files will remain on the disk, and may cause the disk to become full in the worst case.</p>
<p>To invalidate the configuration value, configure <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/web/upload/UploadSettings.html#setAutoCleaning-boolean-" title="nablarch.fw.web.upload.UploadSettings.setAutoCleaning(boolean)">UploadSettings#autoCleaning</a> to <cite>false</cite>.</p>
</div>
<div class="section" id="configure-the-transition-destination-screen-for-multipart-parsing-error-and-file-size-upper-limit-are-exceeded">
<h2><a class="toc-backref" href="#id9">6.2.9.8. Configure the transition destination screen for multipart parsing error and file size upper limit are exceeded</a><a class="headerlink" href="#configure-the-transition-destination-screen-for-multipart-parsing-error-and-file-size-upper-limit-are-exceeded" title="Permalink to this headline">¶</a></h2>
<p>This handler returns <cite>400(BadRequest)</cite> to the client,
when multipart parsing error <a class="footnote-reference" href="#part-error" id="id1">[1]</a> or <a class="reference internal" href="#multipart-handler-file-limit"><span>file size exceeds the upper limit</span></a> is encountered.</p>
<p>Therefore, the error page corresponding to <cite>400(BadRequest)</cite> must be configured in <cite>web.xml</cite>.
If the error page is not configured in <cite>web.xml</cite>, the default page of web application server is returned to the client.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">This handler must be configured before the <a class="reference internal" href="SessionStoreHandler.html#session-store-handler"><span>Session Variable Store Handler</span></a> as described in <a class="reference internal" href="SessionStoreHandler.html#session-store-handler-constraint"><span>Constraints</span></a>.
Therefore, <a class="reference internal" href="HttpErrorHandler.html#httperrorhandler-defaultpage"><span>Configuration of the default page</span></a> of the <a class="reference internal" href="HttpErrorHandler.html#http-error-handler"><span>HTTP Error Control Handler</span></a>, configured after the <a class="reference internal" href="SessionStoreHandler.html#session-store-handler"><span>Session Variable Store Handler</span></a> cannot be used.</p>
</div>
<table class="docutils footnote" frame="void" id="part-error" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><p class="first">Case of multipart parsing error</p>
<ul class="last simple">
<li>If there is a disconnect request from the client during upload and the body part is incomplete</li>
<li>When there is no boundary</li>
</ul>
</td></tr>
</tbody>
</table>
</div>
<div class="section" id="read-the-upload-file">
<span id="multipart-handler-read-upload-file"></span><h2><a class="toc-backref" href="#id10">6.2.9.9. Read the upload file</a><a class="headerlink" href="#read-the-upload-file" title="Permalink to this headline">¶</a></h2>
<p>The uploaded file (temporarily saved file) is acquired from <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/web/HttpRequest.html" title="nablarch.fw.web.HttpRequest">HttpRequest</a>.</p>
<p>An implementation example is shown below.</p>
<dl class="docutils">
<dt>Point</dt>
<dd><ul class="first last simple">
<li>The upload file is acquired by calling <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/web/HttpRequest.html#getPart-java.lang.String-" title="nablarch.fw.web.HttpRequest.getPart(java.lang.String)">HttpRequest#getPart</a>.</li>
<li>The parameter name is specified in the argument of <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/web/HttpRequest.html#getPart-java.lang.String-" title="nablarch.fw.web.HttpRequest.getPart(java.lang.String)">HttpRequest#getPart</a>.</li>
</ul>
</dd>
</dl>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">HttpResponse</span> <span class="nf">upload</span><span class="o">(</span><span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
  <span class="c1">// Acquire the uploaded file</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">PartInfo</span><span class="o">&gt;</span> <span class="n">partInfoList</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getPart</span><span class="o">(</span><span class="s">&quot;uploadFile&quot;</span><span class="o">);</span>

  <span class="k">if</span> <span class="o">(</span><span class="n">partInfoList</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
    <span class="c1">// Business error if the uploaded file is not specified</span>
  <span class="o">}</span>

  <span class="c1">// Process the uploaded file</span>
  <span class="n">InputStream</span> <span class="n">file</span> <span class="o">=</span> <span class="n">partInfoList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getInputStream</span><span class="o">()</span>

  <span class="c1">// The read process of the uploaded file is performed below.</span>
<span class="o">}</span>
</pre></div>
</div>
<p>For the detailed implementation method to process the upload file, refer to the following document.
As described in <a class="reference internal" href="../../libraries/data_converter.html#data-converter"><span>Access to Data in Various Formats</span></a>, <a class="reference internal" href="../../libraries/data_io/data_bind.html#data-bind"><span>Data Bind</span></a> is recommended.
(If the format cannot be handled by <a class="reference internal" href="../../libraries/data_io/data_bind.html#data-bind"><span>Data Bind</span></a>, use <a class="reference internal" href="../../libraries/data_io/data_format.html#data-format"><span>General Data Format</span></a>.)</p>
<ul class="simple">
<li><a class="reference internal" href="../../libraries/data_io/data_bind.html#data-bind-upload-file"><span>Process the upload files using data bind</span></a></li>
<li><a class="reference internal" href="../../libraries/data_io/data_format.html#data-format-load-upload-file"><span>Process the upload files using general data format</span></a></li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>If the uploaded file is a binary file such as an image file, use the binary data that has been read for processing.</p>
<p>If the file is Java8, the byte data of the uploaded file can be read with the following implementation.</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="n">savedFile</span> <span class="o">=</span> <span class="n">partInfo</span><span class="o">.</span><span class="na">getSavedFile</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(</span><span class="n">savedFile</span><span class="o">.</span><span class="na">toPath</span><span class="o">());</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
        <p>
            &copy; Copyright 2010-2021, TIS Inc.
        </p>
    </div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'5u20',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>