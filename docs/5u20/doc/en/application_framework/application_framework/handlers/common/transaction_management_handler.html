


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv='content-language' content='ja'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.1.8. Transaction Control Handler &mdash; ∇Nablarch  5u20 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  

  
  <link rel="canonical" href="https://nablarch.github.io/docs/LATEST/doc/application_framework/application_framework/handlers/common/transaction_management_handler.html" />
  
    <link rel="top" title="∇Nablarch  5u20 documentation" href="../../../../index.html"/>
        <link rel="up" title="6.1. Common Handler" href="index.html"/>
        <link rel="next" title="6.1.9. Permission Check Handler" href="permission_check_handler.html"/>
        <link rel="prev" title="6.1.7. Database Connection Management Handler" href="database_connection_management_handler.html"/>
 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  
  <a href="../../../../index.html" id="sidebar-title" class="icon"> ∇Nablarch 
  

  
    <div id="sidebar-version">Version: 5u20</div>
  </a>

  <div role="search">
    <form id="google-search-form" class="wy-form" method="get" action="https://www.google.co.jp/search">
      <input type="text" name="text" placeholder="Search docs on google" id="text"/>
      <input type="hidden" name="q" id="q"/>
    </form>
  </div>
    
    

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../about_nablarch/index.html">What is the Nablarch?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/concept.html">Nablarch Concept</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#robustness">Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#testability">Testability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#ready-to-use">Ready-to-Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/mvn_module.html">Module List of Nablarch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/license.html">Information on Nablarch License</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Nablarch Application Framework</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Application Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../nablarch/index.html">1. What is Nablarch Application Framework?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/index.html">2. Web Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web_service/index.html">3. Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../batch/index.html">4. Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../messaging/index.html">5. Messaging</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">6. Standard Handler Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../libraries/index.html">7. Libraries Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../blank_project/index.html">8. Blank Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../setting_guide/index.html">9. Nablarch Application Framework Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/index.html">10. Default Configuration List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cloud_native/index.html">11. Nablarch Cloud Native Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../adaptors/index.html">Adaptor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/log_adaptor.html">log Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/router_adaptor.html">Routing Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/webspheremq_adaptor.html">IBM WebSphere MQ Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/jaxrs_adaptor.html">JAX-RS Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/doma_adaptor.html">Doma Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/jsr310_adaptor.html">JSR310(Date and Time API)Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_freemarker_adaptor.html">E-mail FreeMarker Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_thymeleaf_adaptor.html">E-mail Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_velocity_adaptor.html">E-mail Velocity Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/web_thymeleaf_adaptor.html">Web Application Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/lettuce_adaptor.html">Lettuce Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/slf4j_adaptor.html">SLF4J Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/micrometer_adaptor.html">Micrometer Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../example/index.html">Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../example/index.html#procedure-to-build-the-environment">Procedure to build the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../example/index.html#application-execution-procedure">Application execution procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../extension_components/index.html">Nablarch extension component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/report/index.html">1. Form library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/workflow/doc/index.html">2. Workflow library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/workflow/tool/index.html">3. Workflow definition data generation tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/etl/index.html">4. ETL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/etl/etl_maven_plugin.html">5. ETL Maven plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development_tools/index.html">Nablarch development tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html">1. Efficient Java Static Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#conduct-syntax-check">1.1. Conduct syntax check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#unify-the-format">1.2. Unify the format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#check-if-unauthorized-apis-are-being-used">1.3. Check if unauthorized APIs are being used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/ui_dev/index.html">2. Front-end UI development platform for advanced users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/testing_framework/index.html">3. Testing framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/05_UnitTestGuide/index.html">3.1. How to Execute Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/06_TestFWGuide/index.html">3.2. How to Use the Automated Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/08_TestTools/index.html">3.3. Tools Used in the Programming Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/toolbox/index.html">4. Useful Tools When Developing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/JspStaticAnalysis/index.html">4.1. JSP Static Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/SqlExecutor/SqlExecutor.html">4.2. Nablarch SQL Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/JspVerifier/JspVerifier.html">4.3. Job Screen JSP Validation Tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/index.html">Nablarch Implementation Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/01/index.html">Sample Password Encryption Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/0101_PBKDF2PasswordEncryptor.html">Sample Password Encryption Function Using PBKDF2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/02/index.html">Extended Validation Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#email-address-validation">Email address validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#validation-of-japan-telephone-numbers">Validation of Japan telephone numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#code-value-validation">Code value validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/03/index.html">Display a List of Search Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-use">How to Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#listsearchinfo-class">ListSearchInfo class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#listsearchresult-tag">listSearchResult tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#sort-search-results">Sort search results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-implement-displaying-a-list-of-all-search-results-on-a-single-screen">How to implement displaying a list of all search results on a single screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-implement-the-initial-display-of-search-results-with-the-default-search-conditions">How to implement the initial display of search results with the default search conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#default-settings-for-the-search-result-list-display-function">Default settings for the search result list display function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-import-a-sample-implementation-tag-file-into-the-business-application">How to import a sample implementation (tag file) into the business application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#tag-reference">Tag Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/04/index.html">Extended Formatter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/04/0401_ExtendedDataFormatter.html">Data Formatter Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/04/0402_ExtendedFieldType.html">Field Type Expansion in the Data Formatter Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/05/index.html">Sample File Management Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/06/index.html">CAPTCHA Function Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/06_Captcha_guide.html">How to Incorporate the CAPTCHA Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/07/index.html">Sample UserAgent Information Acquisition Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#description-of-configuration">Description of configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#use-case">Use case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/08/index.html">Sample of HTML Email Send Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#implementation-examples">Implementation examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/09/index.html">How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#environment-preparation">Environment preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#structure-of-digitally-signed-email-send-function">Structure of digitally signed email send function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#preparation-of-configuration-file">Preparation of configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/10/index.html">How to Use the Log Aggregation Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/10/index.html#list-of-samples-provided">List of samples provided</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/11/index.html">Messaging Platform Test Simulator Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#uses">Uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#how-to-use">How to use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#expansion-example">Expansion example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nablarch_api/index.html">Nablarch API</a></li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">∇Nablarch </a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../index.html">Nablarch Application Framework</a> &raquo;</li>
      
          <li><a href="../../index.html">Application Framework</a> &raquo;</li>
      
          <li><a href="../index.html">6. Standard Handler Provided by Nablarch</a> &raquo;</li>
      
          <li><a href="index.html">6.1. Common Handler</a> &raquo;</li>
      
    <li>6.1.8. Transaction Control Handler</li>
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/nablarch" class="fa fa-github">GitHub</a>
    </li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://nablarch.github.io/docs/LATEST/doc/index.html" class="ja">日本語</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="transaction-control-handler">
<span id="transaction-management-handler"></span><h1>6.1.8. Transaction Control Handler<a class="headerlink" href="#transaction-control-handler" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#handler-class-name" id="id1">Handler class name</a></li>
<li><a class="reference internal" href="#module-list" id="id2">Module list</a></li>
<li><a class="reference internal" href="#constraints" id="id3">Constraints</a></li>
<li><a class="reference internal" href="#configure-the-transaction-control-target" id="id4">Configure the transaction control target</a></li>
<li><a class="reference internal" href="#commit-a-transaction-in-the-case-of-specific-exception" id="id5">Commit a transaction in the case of specific exception</a></li>
<li><a class="reference internal" href="#execute-optional-processing-at-the-end-of-the-transaction" id="id6">Execute optional processing at the end of the transaction</a></li>
<li><a class="reference internal" href="#using-multiple-transactions-in-an-application" id="id7">Using multiple transactions in an application</a></li>
</ul>
</div>
<p>This handler realizes transparent transactions in subsequent processes using resources corresponding to transactions such as databases and message queues.</p>
<p>For transaction details, see <a class="reference internal" href="../../libraries/transaction.html#transaction"><span>Transaction Management</span></a> .</p>
<p>This handler performs the following process.</p>
<ul class="simple">
<li>Begin a transaction</li>
<li>End a transaction (commit or rollback)</li>
<li>Callback at the end of the transaction</li>
</ul>
<p>The process flow is as follows.</p>
<img alt="../../../../_images/flow8.png" src="../../../../_images/flow8.png" />
<div class="section" id="handler-class-name">
<h2><a class="toc-backref" href="#id1">6.1.8.1. Handler class name</a><a class="headerlink" href="#handler-class-name" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/TransactionManagementHandler.html" title="nablarch.common.handler.TransactionManagementHandler">nablarch.common.handler.TransactionManagementHandler</a></li>
</ul>
</div>
<div class="section" id="module-list">
<h2><a class="toc-backref" href="#id2">6.1.8.2. Module list</a><a class="headerlink" href="#module-list" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.framework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-core-transaction<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- Only to control transactions to the database --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.framework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-core-jdbc<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- Only when executing an optional process at the end of the transaction --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.framework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-core<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="constraints">
<h2><a class="toc-backref" href="#id3">6.1.8.3. Constraints</a><a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Place after <a class="reference internal" href="database_connection_management_handler.html#database-connection-management-handler"><span>Database Connection Management Handler</span></a></dt>
<dd>When controlling a transaction in a database, a database connection for transaction management must exist in the thread.
Therefore, this handler must be placed after the <a class="reference internal" href="database_connection_management_handler.html#database-connection-management-handler"><span>Database Connection Management Handler</span></a> .</dd>
</dl>
</div>
<div class="section" id="configure-the-transaction-control-target">
<h2><a class="toc-backref" href="#id4">6.1.8.4. Configure the transaction control target</a><a class="headerlink" href="#configure-the-transaction-control-target" title="Permalink to this headline">¶</a></h2>
<p>This handler uses the factory class ( <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/transaction/TransactionFactory.html" title="nablarch.core.transaction.TransactionFactory">TransactionFactory</a> implementation class) configured in the <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/TransactionManagementHandler.html#setTransactionFactory-nablarch.core.transaction.TransactionFactory-" title="nablarch.common.handler.TransactionManagementHandler.setTransactionFactory(nablarch.core.transaction.TransactionFactory)">transactionFactory</a> property to obtain the control target of the transaction and manage it on the thread.</p>
<p>When managing on a thread, configure a name to identify the transaction.
By default,  <code class="docutils literal"><span class="pre">transaction</span></code>  is used but to use a different name, configure the name in the  <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/TransactionManagementHandler.html#setTransactionName-java.lang.String-" title="nablarch.common.handler.TransactionManagementHandler.setTransactionName(java.lang.String)">transactionName</a> .
<a class="reference internal" href="#transaction-management-handler-multi-transaction"><span>When using multiple transactions</span></a> , it is required to set the value to the  <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/TransactionManagementHandler.html#setTransactionName-java.lang.String-" title="nablarch.common.handler.TransactionManagementHandler.setTransactionName(java.lang.String)">transactionName</a>  property.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>To perform transaction control on the database configured with <a class="reference internal" href="database_connection_management_handler.html#database-connection-management-handler"><span>Database Connection Management Handler</span></a> ,
configure the same value configured in <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/DbConnectionManagementHandler.html#setConnectionName-java.lang.String-" title="nablarch.common.handler.DbConnectionManagementHandler.setConnectionName(java.lang.String)">DbConnectionManagementHandler#connectionName</a>  to the <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/TransactionManagementHandler.html#setTransactionName-java.lang.String-" title="nablarch.common.handler.TransactionManagementHandler.setTransactionName(java.lang.String)">transactionName</a>  property.</p>
<p class="last">If a value is not configured in  <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/DbConnectionManagementHandler.html#setConnectionName-java.lang.String-" title="nablarch.common.handler.DbConnectionManagementHandler.setConnectionName(java.lang.String)">DbConnectionManagementHandler#connectionName</a> ,
then the configuration of <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/TransactionManagementHandler.html#setTransactionName-java.lang.String-" title="nablarch.common.handler.TransactionManagementHandler.setTransactionName(java.lang.String)">transactionName</a> can be omitted.</p>
</div>
<p>Configure the handler by referring to the configuration file example given below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Transaction control handler --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.TransactionManagementHandler&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;transactionFactory&quot;</span> <span class="na">ref=</span><span class="s">&quot;databaseTransactionFactory&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;transactionName&quot;</span> <span class="na">value=</span><span class="s">&quot;name&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="c">&lt;!-- When performing transaction control on the database, configure JdbcTransactionFactory --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;databaseTransactionFactory&quot;</span>
    <span class="na">class=</span><span class="s">&quot;nablarch.core.db.transaction.JdbcTransactionFactory&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Property configuration is omitted --&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="commit-a-transaction-in-the-case-of-specific-exception">
<h2><a class="toc-backref" href="#id5">6.1.8.5. Commit a transaction in the case of specific exception</a><a class="headerlink" href="#commit-a-transaction-in-the-case-of-specific-exception" title="Permalink to this headline">¶</a></h2>
<p>All errors and exceptions are subject to rollback in the default operation of this handler,
but you may want to commit transaction depending on the contents of the exception that was thrown.</p>
<p>In this case, configure the exception class of the commit target for the <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/TransactionManagementHandler.html#setTransactionCommitExceptions-java.util.List-" title="nablarch.common.handler.TransactionManagementHandler.setTransactionCommitExceptions(java.util.List)">transactionCommitExceptions</a> property.
The subclass of the configured exception class will also be a target for commit.</p>
<p>A configuration example is shown below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.TransactionManagementHandler&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Configure the exception class of commit target in transactionCommitExceptions property with FQCN. --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;transactionCommitExceptions&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;list&gt;</span>
      <span class="c">&lt;!-- example.TransactionCommitException is targeted for commit --&gt;</span>
      <span class="nt">&lt;value&gt;</span>example.TransactionCommitException<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="execute-optional-processing-at-the-end-of-the-transaction">
<h2><a class="toc-backref" href="#id6">6.1.8.6. Execute optional processing at the end of the transaction</a><a class="headerlink" href="#execute-optional-processing-at-the-end-of-the-transaction" title="Permalink to this headline">¶</a></h2>
<p>This handler performs the callback process when the transaction ends (commit or rollback).</p>
<p>The process to be called back is the handler that implements <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/TransactionEventCallback.html" title="nablarch.fw.TransactionEventCallback">TransactionEventCallback</a>  among the handlers configured after this handler.
If multiple handlers implement <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/TransactionEventCallback.html" title="nablarch.fw.TransactionEventCallback">TransactionEventCallback</a> , then the callback process is performed sequentially from the handler that has been configured earlier.</p>
<p>When rolling back a transaction, the callback process is executed after roll back.
Therefore, the callback process is performed in a new transaction and is committed when the callback has completed successfully.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Note that if multiple handlers have implemented the callback process and an error or exception occurs during the callback process,
the callback process for the remaining handlers is not performed.</p>
</div>
<p>An example is shown below.</p>
<dl class="docutils">
<dt>Creating a handler that performs callback process</dt>
<dd><p class="first">Create a handler that implements <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/TransactionEventCallback.html" title="nablarch.fw.TransactionEventCallback">TransactionEventCallback</a>  as shown in the following implementation example.</p>
<p>Implement the callback process at the time of transaction commit in <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/TransactionEventCallback.html#transactionNormalEnd-TData-nablarch.fw.ExecutionContext-" title="nablarch.fw.TransactionEventCallback.transactionNormalEnd(TData-nablarch.fw.ExecutionContext)">transactionNormalEnd</a> ,
and implement the callback process at the time of transaction rollback in <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/TransactionEventCallback.html#transactionAbnormalEnd-java.lang.Throwable-TData-nablarch.fw.ExecutionContext-" title="nablarch.fw.TransactionEventCallback.transactionAbnormalEnd(java.lang.Throwable-TData-nablarch.fw.ExecutionContext)">transactionAbnormalEnd</a>.</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SampleHandler</span>
    <span class="kd">implements</span> <span class="n">Handler</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;,</span> <span class="n">TransactionEventCallback</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Implement handler processing</span>
    <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">handleNext</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transactionNormalEnd</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="n">ExecutionContext</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Implement callback process when committing a transaction</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transactionAbnormalEnd</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="n">ExecutionContext</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Implement callback process during transaction rollback</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</dd>
<dt>Build a handler queue</dt>
<dd><p class="first">Configure the handler that implements callback process in the subsequent handler of this handler as follows.</p>
<div class="last highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;list</span> <span class="na">name=</span><span class="s">&quot;handlerQueue&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Transaction control handler --&gt;</span>
  <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.TransactionManagementHandler&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- Configuration of property is omitted --&gt;</span>
  <span class="nt">&lt;/component&gt;</span>

  <span class="c">&lt;!-- Handler that implements callback process --&gt;</span>
  <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;sample.SampleHandler&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/list&gt;</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="using-multiple-transactions-in-an-application">
<span id="transaction-management-handler-multi-transaction"></span><h2><a class="toc-backref" href="#id7">6.1.8.7. Using multiple transactions in an application</a><a class="headerlink" href="#using-multiple-transactions-in-an-application" title="Permalink to this headline">¶</a></h2>
<p>There may be cases where one application requires multiple transaction controls.
In this case, multiple handlers are configured on the handler queue to manage the situation.</p>
<p>A configuration example for controlling transactions of multiple database connections is shown below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Configure default database connection --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;defaultDatabaseHandler&quot;</span>
    <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.DbConnectionManagementHandler&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">ref=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/component&gt;</span>

<span class="c">&lt;!-- Register a database connection with the name userAccessLog --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;userAccessLogDatabaseHandler&quot;</span>
    <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.DbConnectionManagementHandler&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">ref=</span><span class="s">&quot;userAccessLogConnectionFactory&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;connectionName&quot;</span> <span class="na">value=</span><span class="s">&quot;userAccessLog&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/component&gt;</span>

<span class="c">&lt;!-- Configure transaction control for the default database connection --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;defaultTransactionHandler&quot;</span>
    <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.TransactionManagementHandler&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;transactionFactory&quot;</span> <span class="na">ref=</span><span class="s">&quot;databaseTransactionFactory&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/component&gt;</span>

<span class="c">&lt;!-- Transaction control configuration for the database connection userAccessLog --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;userAccessLogTransactionHandler&quot;</span>
    <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.TransactionManagementHandler&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;transactionFactory&quot;</span> <span class="na">ref=</span><span class="s">&quot;databaseTransactionFactory&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;transactionName&quot;</span> <span class="na">value=</span><span class="s">&quot;userAccessLog&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>An example where the above handler is configured in the handler queue is shown.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Handlers other than database and transaction control are omitted --&gt;</span>

<span class="nt">&lt;list</span> <span class="na">name=</span><span class="s">&quot;handlerQueue&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Connection to default database and transaction control --&gt;</span>
  <span class="nt">&lt;component-ref</span> <span class="na">name=</span><span class="s">&quot;defaultDatabaseHandler&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;component-ref</span> <span class="na">name=</span><span class="s">&quot;defaultTransactionHandler&quot;</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- Connection and transaction control of userAccessLog database --&gt;</span>
  <span class="nt">&lt;component-ref</span> <span class="na">name=</span><span class="s">&quot;userAccessLogDatabaseHandler&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;component-ref</span> <span class="na">name=</span><span class="s">&quot;userAccessLogTransactionHandler&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/list&gt;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
        <p>
            &copy; Copyright 2010-2021, TIS Inc.
        </p>
    </div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'5u20',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>