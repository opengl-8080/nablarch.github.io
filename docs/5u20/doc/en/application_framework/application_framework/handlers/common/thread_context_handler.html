


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv='content-language' content='ja'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.1.5. Thread Context Variable Management Handler &mdash; ∇Nablarch  5u20 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  

  
  <link rel="canonical" href="https://nablarch.github.io/docs/LATEST/doc/application_framework/application_framework/handlers/common/thread_context_handler.html" />
  
    <link rel="top" title="∇Nablarch  5u20 documentation" href="../../../../index.html"/>
        <link rel="up" title="6.1. Common Handler" href="index.html"/>
        <link rel="next" title="6.1.6. Thread Context Variable Delete Handler" href="thread_context_clear_handler.html"/>
        <link rel="prev" title="6.1.4. Request Handler Entry" href="request_handler_entry.html"/>
 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  
  <a href="../../../../index.html" id="sidebar-title" class="icon"> ∇Nablarch 
  

  
    <div id="sidebar-version">Version: 5u20</div>
  </a>

  <div role="search">
    <form id="google-search-form" class="wy-form" method="get" action="https://www.google.co.jp/search">
      <input type="text" name="text" placeholder="Search docs on google" id="text"/>
      <input type="hidden" name="q" id="q"/>
    </form>
  </div>
    
    

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../about_nablarch/index.html">What is the Nablarch?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/concept.html">Nablarch Concept</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#robustness">Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#testability">Testability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#ready-to-use">Ready-to-Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/mvn_module.html">Module List of Nablarch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/license.html">Information on Nablarch License</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Nablarch Application Framework</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Application Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../nablarch/index.html">1. What is Nablarch Application Framework?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/index.html">2. Web Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web_service/index.html">3. Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../batch/index.html">4. Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../messaging/index.html">5. Messaging</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">6. Standard Handler Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../libraries/index.html">7. Libraries Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../blank_project/index.html">8. Blank Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../setting_guide/index.html">9. Nablarch Application Framework Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/index.html">10. Default Configuration List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cloud_native/index.html">11. Nablarch Cloud Native Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../adaptors/index.html">Adaptor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/log_adaptor.html">log Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/router_adaptor.html">Routing Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/webspheremq_adaptor.html">IBM WebSphere MQ Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/jaxrs_adaptor.html">JAX-RS Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/doma_adaptor.html">Doma Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/jsr310_adaptor.html">JSR310(Date and Time API)Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_freemarker_adaptor.html">E-mail FreeMarker Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_thymeleaf_adaptor.html">E-mail Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_velocity_adaptor.html">E-mail Velocity Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/web_thymeleaf_adaptor.html">Web Application Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/lettuce_adaptor.html">Lettuce Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/slf4j_adaptor.html">SLF4J Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/micrometer_adaptor.html">Micrometer Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../example/index.html">Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../example/index.html#procedure-to-build-the-environment">Procedure to build the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../example/index.html#application-execution-procedure">Application execution procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../extension_components/index.html">Nablarch extension component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/report/index.html">1. Form library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/workflow/doc/index.html">2. Workflow library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/workflow/tool/index.html">3. Workflow definition data generation tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/etl/index.html">4. ETL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/etl/etl_maven_plugin.html">5. ETL Maven plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development_tools/index.html">Nablarch development tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html">1. Efficient Java Static Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#conduct-syntax-check">1.1. Conduct syntax check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#unify-the-format">1.2. Unify the format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#check-if-unauthorized-apis-are-being-used">1.3. Check if unauthorized APIs are being used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/ui_dev/index.html">2. Front-end UI development platform for advanced users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/testing_framework/index.html">3. Testing framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/05_UnitTestGuide/index.html">3.1. How to Execute Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/06_TestFWGuide/index.html">3.2. How to Use the Automated Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/08_TestTools/index.html">3.3. Tools Used in the Programming Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/toolbox/index.html">4. Useful Tools When Developing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/JspStaticAnalysis/index.html">4.1. JSP Static Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/SqlExecutor/SqlExecutor.html">4.2. Nablarch SQL Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/JspVerifier/JspVerifier.html">4.3. Job Screen JSP Validation Tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/index.html">Nablarch Implementation Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/01/index.html">Sample Password Encryption Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/0101_PBKDF2PasswordEncryptor.html">Sample Password Encryption Function Using PBKDF2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/02/index.html">Extended Validation Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#email-address-validation">Email address validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#validation-of-japan-telephone-numbers">Validation of Japan telephone numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#code-value-validation">Code value validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/03/index.html">Display a List of Search Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-use">How to Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#listsearchinfo-class">ListSearchInfo class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#listsearchresult-tag">listSearchResult tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#sort-search-results">Sort search results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-implement-displaying-a-list-of-all-search-results-on-a-single-screen">How to implement displaying a list of all search results on a single screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-implement-the-initial-display-of-search-results-with-the-default-search-conditions">How to implement the initial display of search results with the default search conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#default-settings-for-the-search-result-list-display-function">Default settings for the search result list display function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-import-a-sample-implementation-tag-file-into-the-business-application">How to import a sample implementation (tag file) into the business application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#tag-reference">Tag Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/04/index.html">Extended Formatter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/04/0401_ExtendedDataFormatter.html">Data Formatter Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/04/0402_ExtendedFieldType.html">Field Type Expansion in the Data Formatter Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/05/index.html">Sample File Management Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/06/index.html">CAPTCHA Function Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/06_Captcha_guide.html">How to Incorporate the CAPTCHA Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/07/index.html">Sample UserAgent Information Acquisition Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#description-of-configuration">Description of configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#use-case">Use case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/08/index.html">Sample of HTML Email Send Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#implementation-examples">Implementation examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/09/index.html">How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#environment-preparation">Environment preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#structure-of-digitally-signed-email-send-function">Structure of digitally signed email send function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#preparation-of-configuration-file">Preparation of configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/10/index.html">How to Use the Log Aggregation Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/10/index.html#list-of-samples-provided">List of samples provided</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/11/index.html">Messaging Platform Test Simulator Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#uses">Uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#how-to-use">How to use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#expansion-example">Expansion example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nablarch_api/index.html">Nablarch API</a></li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">∇Nablarch </a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../index.html">Nablarch Application Framework</a> &raquo;</li>
      
          <li><a href="../../index.html">Application Framework</a> &raquo;</li>
      
          <li><a href="../index.html">6. Standard Handler Provided by Nablarch</a> &raquo;</li>
      
          <li><a href="index.html">6.1. Common Handler</a> &raquo;</li>
      
    <li>6.1.5. Thread Context Variable Management Handler</li>
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/nablarch" class="fa fa-github">GitHub</a>
    </li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://nablarch.github.io/docs/LATEST/doc/index.html" class="ja">日本語</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="thread-context-variable-management-handler">
<span id="thread-context-handler"></span><h1>6.1.5. Thread Context Variable Management Handler<a class="headerlink" href="#thread-context-variable-management-handler" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#handler-class-name" id="id1">Handler class name</a></li>
<li><a class="reference internal" href="#module-list" id="id2">Module list</a></li>
<li><a class="reference internal" href="#constraints" id="id3">Constraints</a></li>
<li><a class="reference internal" href="#initialize-the-thread-context-for-each-request" id="id4">Initialize the thread context for each request</a><ul>
<li><a class="reference internal" href="#setting-a-user-id" id="id5">Setting a User ID</a></li>
</ul>
</li>
<li><a class="reference internal" href="#set-get-attribute-value-of-thread-context" id="id6">Set/get attribute value of thread context</a></li>
<li><a class="reference internal" href="#create-a-screen-for-the-user-to-select-a-language" id="id7">Create a screen for the user to select a language</a></li>
<li><a class="reference internal" href="#create-a-screen-for-the-user-to-select-a-time-zone" id="id8">Create a screen for the user to select a time zone</a></li>
</ul>
</div>
<p>This handler performs the initialization process for each attribute value of thread context for each request.</p>
<p>Thread context is a mechanism for storing shared values within the same processing thread,
such as request ID and user ID, in the thread local area.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Use <a class="reference internal" href="thread_context_clear_handler.html#thread-context-clear-handler"><span>Thread Context Variable Delete Handler</span></a>  to delete the value in the thread-local configured by this handler in response processing.
Since the value cannot be obtained if the thread context is accessed by the handler before this handler in request processing,
be careful that the thread context is not accessed before this handler.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Many of the thread context attribute values are configured by this handler,
but it is also possible to set arbitrary variables from handlers other than this handler and business actions.</p>
</div>
<p>This handler performs the following process.</p>
<ul class="simple">
<li><a class="reference internal" href="#thread-context-handler-initialization"><span>Initialize the thread context for each request</span></a></li>
</ul>
<p>The process flow is as follows.</p>
<img alt="../../../../_images/ThreadContextHandler_flow.png" src="../../../../_images/ThreadContextHandler_flow.png" />
<div class="section" id="handler-class-name">
<h2><a class="toc-backref" href="#id1">6.1.5.1. Handler class name</a><a class="headerlink" href="#handler-class-name" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/threadcontext/ThreadContextHandler.html" title="nablarch.common.handler.threadcontext.ThreadContextHandler">nablarch.common.handler.threadcontext.ThreadContextHandler</a></li>
</ul>
</div>
<div class="section" id="module-list">
<h2><a class="toc-backref" href="#id2">6.1.5.2. Module list</a><a class="headerlink" href="#module-list" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.framework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-fw<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- Only when creating a screen to select a language or time zone with internationalization  --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.framework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-fw-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="constraints">
<h2><a class="toc-backref" href="#id3">6.1.5.3. Constraints</a><a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h2>
<p>None.</p>
</div>
<div class="section" id="initialize-the-thread-context-for-each-request">
<span id="thread-context-handler-initialization"></span><h2><a class="toc-backref" href="#id4">6.1.5.4. Initialize the thread context for each request</a><a class="headerlink" href="#initialize-the-thread-context-for-each-request" title="Permalink to this headline">¶</a></h2>
<p>Initializes the thread context using a class that implements <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/threadcontext/ThreadContextAttribute.html" title="nablarch.common.handler.threadcontext.ThreadContextAttribute">ThreadContextAttribute interface</a>.</p>
<p>The following classes are provided by default:</p>
<dl class="docutils">
<dt>Request ID, internal request ID</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/threadcontext/RequestIdAttribute.html" title="nablarch.common.handler.threadcontext.RequestIdAttribute">RequestIdAttribute</a></li>
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/threadcontext/InternalRequestIdAttribute.html" title="nablarch.common.handler.threadcontext.InternalRequestIdAttribute">InternalRequestIdAttribute</a></li>
</ul>
</dd>
<dt>User ID</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/threadcontext/UserIdAttribute.html" title="nablarch.common.handler.threadcontext.UserIdAttribute">UserIdAttribute</a></li>
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/UserIdAttributeInSessionStore.html" title="nablarch.common.web.handler.threadcontext.UserIdAttributeInSessionStore">UserIdAttributeInSessionStore</a></li>
</ul>
</dd>
<dt>Language</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/threadcontext/LanguageAttribute.html" title="nablarch.common.handler.threadcontext.LanguageAttribute">LanguageAttribute</a></li>
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/HttpLanguageAttribute.html" title="nablarch.common.web.handler.threadcontext.HttpLanguageAttribute">HttpLanguageAttribute</a></li>
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/LanguageAttributeInHttpCookie.html" title="nablarch.common.web.handler.threadcontext.LanguageAttributeInHttpCookie">LanguageAttributeInHttpCookie</a></li>
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/LanguageAttributeInHttpSession.html" title="nablarch.common.web.handler.threadcontext.LanguageAttributeInHttpSession">LanguageAttributeInHttpSession</a></li>
</ul>
</dd>
<dt>Time zone</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/threadcontext/TimeZoneAttribute.html" title="nablarch.common.handler.threadcontext.TimeZoneAttribute">TimeZoneAttribute</a></li>
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/TimeZoneAttributeInHttpCookie.html" title="nablarch.common.web.handler.threadcontext.TimeZoneAttributeInHttpCookie">TimeZoneAttributeInHttpCookie</a></li>
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/TimeZoneAttributeInHttpSession.html" title="nablarch.common.web.handler.threadcontext.TimeZoneAttributeInHttpSession">TimeZoneAttributeInHttpSession</a></li>
</ul>
</dd>
<dt>Execution ID</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/threadcontext/ExecutionIdAttribute.html" title="nablarch.common.handler.threadcontext.ExecutionIdAttribute">ExecutionIdAttribute</a></li>
</ul>
</dd>
</dl>
<p>These classes are used by adding definitions to the component configuration file.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.threadcontext.ThreadContextHandler&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;attributes&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;list&gt;</span>

      <span class="c">&lt;!-- Request ID --&gt;</span>
      <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.threadcontext.RequestIdAttribute&quot;</span> <span class="nt">/&gt;</span>

      <span class="c">&lt;!-- Internal request ID --&gt;</span>
      <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.threadcontext.InternalRequestIdAttribute&quot;</span> <span class="nt">/&gt;</span>

      <span class="c">&lt;!-- User ID --&gt;</span>
      <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.threadcontext.UserIdAttribute&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sessionKey&quot;</span>  <span class="na">value=</span><span class="s">&quot;user.id&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;anonymousId&quot;</span> <span class="na">value=</span><span class="s">&quot;guest&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/component&gt;</span>

      <span class="c">&lt;!-- Language --&gt;</span>
      <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.threadcontext.LanguageAttribute&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultLanguage&quot;</span> <span class="na">value=</span><span class="s">&quot;ja&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/component&gt;</span>

      <span class="c">&lt;!-- Time zone --&gt;</span>
      <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.threadcontext.TimeZoneAttribute&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultTimeZone&quot;</span> <span class="na">value=</span><span class="s">&quot;Asia/Tokyo&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/component&gt;</span>

      <span class="c">&lt;!-- Execution ID --&gt;</span>
      <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.threadcontext.ExecutionIdAttribute&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<div class="section" id="setting-a-user-id">
<span id="thread-context-handler-user-id-attribute-setting"></span><h3><a class="toc-backref" href="#id5">6.1.5.4.1. Setting a User ID</a><a class="headerlink" href="#setting-a-user-id" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/UserIdAttributeInSessionStore.html" title="nablarch.common.web.handler.threadcontext.UserIdAttributeInSessionStore">UserIdAttributeInSessionStore</a> gets the user ID from the session store by default.
Because the framework does not set the user ID in the session store, it must be set in the application in the login process and so on.
By default, &#8220;user.id&#8221; is used as the key for setting the user ID in the session store.
To overwrite it, set the value to the <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/threadcontext/UserIdAttribute.html#setSessionKey-java.lang.String-" title="nablarch.common.handler.threadcontext.UserIdAttribute.setSessionKey(java.lang.String)">UserIdAttribute#sessionKey</a>.
The following is an example of how to override &#8220;login_id&#8221;.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;threadContextHandler&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.threadcontext.ThreadContextHandler&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;attributes&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;list&gt;</span>
      <span class="c">&lt;!-- User ID --&gt;</span>
      <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.web.handler.threadcontext.UserIdAttributeInSessionStore&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sessionKey&quot;</span> <span class="na">value=</span><span class="s">&quot;login_id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;anonymousId&quot;</span> <span class="na">value=</span><span class="s">&quot;${nablarch.userIdAttribute.anonymousId}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/component&gt;</span>
      <span class="c">&lt;!-- Other component definitions are omitted. --&gt;</span>
    <span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>The following is an example implementation of setting the user ID in the session store with a default key.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">SessionUtil</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">&quot;user.id&quot;</span><span class="o">,</span> <span class="n">userId</span><span class="o">);</span>
</pre></div>
</div>
<p>Also, instead of storing the user ID directly in the session store, you may want to store the login information together.
In that case, the user ID can be obtained from an arbitrary source by overriding
<a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/handler/threadcontext/UserIdAttribute.html#getUserIdSession-nablarch.fw.ExecutionContext-java.lang.String-" title="nablarch.common.handler.threadcontext.UserIdAttribute.getUserIdSession(nablarch.fw.ExecutionContext-java.lang.String)">UserIdAttribute#getUserIdSession</a> as shown below.
The following is an example of how to get the user ID from an object set in the session store using the &#8220;userContext&#8221; key.
In the following case, you still need to set up the object in the session store in your application.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionStoreUserIdAttribute</span> <span class="kd">extends</span> <span class="n">UserIdAttribute</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">Object</span> <span class="nf">getUserIdSession</span><span class="o">(</span><span class="n">ExecutionContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">String</span> <span class="n">skey</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">LoginUserPrincipal</span> <span class="n">userContext</span> <span class="o">=</span> <span class="n">SessionUtil</span><span class="o">.</span><span class="na">orNull</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="s">&quot;userContext&quot;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">userContext</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">userContext</span><span class="o">.</span><span class="na">getUserId</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.threadcontext.ThreadContextHandler&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;attributes&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;list&gt;</span>
       <span class="c">&lt;!-- User ID --&gt;</span>
       <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;com.nablarch.example.proman.web.common.handler.threadcontext.SessionStoreUserIdAttribute&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;anonymousId&quot;</span> <span class="na">value=</span><span class="s">&quot;${nablarch.userIdAttribute.anonymousId}&quot;</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;/component&gt;</span>
       <span class="c">&lt;!-- Other component definitions are omitted. --&gt;</span>
    <span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="set-get-attribute-value-of-thread-context">
<span id="thread-context-handler-attribute-access"></span><h2><a class="toc-backref" href="#id6">6.1.5.5. Set/get attribute value of thread context</a><a class="headerlink" href="#set-get-attribute-value-of-thread-context" title="Permalink to this headline">¶</a></h2>
<p>Use <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/ThreadContext.html" title="nablarch.core.ThreadContext">ThreadContext</a>  to access the thread context.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Get request ID</span>
<span class="n">String</span> <span class="n">requestId</span> <span class="o">=</span> <span class="n">ThreadContext</span><span class="o">.</span><span class="na">getRequestId</span><span class="o">();</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-screen-for-the-user-to-select-a-language">
<span id="thread-context-handler-language-selection"></span><h2><a class="toc-backref" href="#id7">6.1.5.6. Create a screen for the user to select a language</a><a class="headerlink" href="#create-a-screen-for-the-user-to-select-a-language" title="Permalink to this headline">¶</a></h2>
<p>In some cases, users are required to be able to select a language, such as for internationalization.
In such cases, using one of the following classes and <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/LanguageAttributeInHttpUtil.html" title="nablarch.common.web.handler.threadcontext.LanguageAttributeInHttpUtil">LanguageAttributeInHttpUtil</a> will enable the user to select the language.</p>
<ul class="simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/LanguageAttributeInHttpCookie.html" title="nablarch.common.web.handler.threadcontext.LanguageAttributeInHttpCookie">LanguageAttributeInHttpCookie</a></li>
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/LanguageAttributeInHttpSession.html" title="nablarch.common.web.handler.threadcontext.LanguageAttributeInHttpSession">LanguageAttributeInHttpSession</a></li>
</ul>
<p>Here, an implementation example of a screen in which a language is stored in a cookie and language is selected by a link is shown.</p>
<dl class="docutils">
<dt>Configuration example</dt>
<dd><div class="first last highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Set the component name to &quot;languageAttribute&quot;,</span>
<span class="c">     to use LanguageAttributeInHttpUtil. --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;languageAttribute&quot;</span>
           <span class="na">class=</span><span class="s">&quot;nablarch.common.web.handler.threadcontext.LanguageAttributeInHttpCookie&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultLanguage&quot;</span> <span class="na">value=</span><span class="s">&quot;ja&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;supportedLanguages&quot;</span> <span class="na">value=</span><span class="s">&quot;ja,en&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</dd>
<dt>Implementation example of JSP</dt>
<dd><div class="first last highlight-jsp"><div class="highlight"><pre><span></span><span class="k">&lt;%-</span><span class="o">-</span> <span class="n">Output</span> <span class="n">link</span> <span class="n">using</span> <span class="n">n</span><span class="o">:</span><span class="n">submitLink</span> <span class="n">tag</span><span class="o">,</span>
     <span class="n">send</span> <span class="n">a</span> <span class="n">different</span> <span class="n">language</span> <span class="k">for</span> <span class="n">each</span> <span class="n">link</span> <span class="n">using</span> <span class="n">the</span> <span class="n">n</span><span class="o">:</span><span class="n">param</span> <span class="n">tag</span><span class="o">.</span> <span class="o">--</span><span class="k">%&gt;</span>

<span class="nt">&lt;n:submitLink</span> <span class="na">uri=</span><span class="s">&quot;/action/menu/index&quot;</span> <span class="na">name=</span><span class="s">&quot;switchToEnglish&quot;</span><span class="nt">&gt;</span>

  English

  <span class="nt">&lt;n:param</span> <span class="na">paramName=</span><span class="s">&quot;user.language&quot;</span> <span class="na">value=</span><span class="s">&quot;en&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/n:submitLink&gt;</span>
<span class="nt">&lt;n:submitLink</span> <span class="na">uri=</span><span class="s">&quot;/action/menu/index&quot;</span> <span class="na">name=</span><span class="s">&quot;switchToJapanese&quot;</span><span class="nt">&gt;</span>

  Japanese

  <span class="nt">&lt;n:param</span> <span class="na">paramName=</span><span class="s">&quot;user.language&quot;</span> <span class="na">value=</span><span class="s">&quot;ja&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/n:submitLink&gt;</span>
</pre></div>
</div>
</dd>
<dt>Implementation example of handler</dt>
<dd><div class="first last highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Handler for holding the language selected by the user.</span>
<span class="c1">// Implement as a handler assuming that the user selects the language on multiple screens.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">I18nHandler</span> <span class="kd">implements</span> <span class="n">HttpRequestHandler</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">HttpResponse</span> <span class="nf">handle</span><span class="o">(</span><span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">language</span> <span class="o">=</span> <span class="n">getLanguage</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="s">&quot;user.language&quot;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtil</span><span class="o">.</span><span class="na">hasValue</span><span class="o">(</span><span class="n">language</span><span class="o">))</span> <span class="o">{</span>

            <span class="c1">// Call keepLanguage method of LanguageAttributeInHttpUtil,</span>
            <span class="c1">// and configure the selected language for cookie.</span>
            <span class="c1">// Language is also set in the thread context.</span>
            <span class="c1">// If the specified language is not supported,</span>
            <span class="c1">// cookies and thread context are not configured.</span>
            <span class="n">LanguageAttributeInHttpUtil</span><span class="o">.</span><span class="na">keepLanguage</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="n">language</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">handleNext</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getLanguage</span><span class="o">(</span><span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">String</span> <span class="n">paramName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">request</span><span class="o">.</span><span class="na">getParamMap</span><span class="o">().</span><span class="na">containsKey</span><span class="o">(</span><span class="n">paramName</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">getParam</span><span class="o">(</span><span class="n">paramName</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="create-a-screen-for-the-user-to-select-a-time-zone">
<span id="thread-context-handler-time-zone-selection"></span><h2><a class="toc-backref" href="#id8">6.1.5.7. Create a screen for the user to select a time zone</a><a class="headerlink" href="#create-a-screen-for-the-user-to-select-a-time-zone" title="Permalink to this headline">¶</a></h2>
<p>In some cases, users are required to be able to select a time zone, such as for internationalization.
In such cases, using one of the following classes and <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/TimeZoneAttributeInHttpUtil.html" title="nablarch.common.web.handler.threadcontext.TimeZoneAttributeInHttpUtil">TimeZoneAttributeInHttpUtil</a> will enable the user to select the time zone.</p>
<ul class="simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/TimeZoneAttributeInHttpCookie.html" title="nablarch.common.web.handler.threadcontext.TimeZoneAttributeInHttpCookie">TimeZoneAttributeInHttpCookie</a></li>
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/handler/threadcontext/TimeZoneAttributeInHttpSession.html" title="nablarch.common.web.handler.threadcontext.TimeZoneAttributeInHttpSession">TimeZoneAttributeInHttpSession</a></li>
</ul>
<p>Here, an implementation example of a screen in which a time zone is stored in a cookie and time zone is selected by a link is shown.</p>
<dl class="docutils">
<dt>Configuration example</dt>
<dd><div class="first last highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Set the component name to &quot;timeZoneAttribute&quot;,</span>
<span class="c">     to use TimeZoneAttributeInHttpUtil. --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;timeZoneAttribute&quot;</span>
           <span class="na">class=</span><span class="s">&quot;nablarch.common.web.handler.threadcontext.TimeZoneAttributeInHttpCookie&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultTimeZone&quot;</span> <span class="na">value=</span><span class="s">&quot;Asia/Tokyo&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;supportedTimeZones&quot;</span> <span class="na">value=</span><span class="s">&quot;Asia/Tokyo,America/New_York&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</dd>
<dt>Implementation example of JSP</dt>
<dd><div class="first last highlight-jsp"><div class="highlight"><pre><span></span><span class="k">&lt;%-</span><span class="o">-</span> <span class="n">Output</span> <span class="n">link</span> <span class="n">using</span> <span class="n">n</span><span class="o">:</span><span class="n">submitLink</span> <span class="n">tag</span><span class="o">,</span>
     <span class="n">send</span> <span class="n">a</span> <span class="n">different</span> <span class="n">time</span> <span class="n">zone</span> <span class="k">for</span> <span class="n">each</span> <span class="n">link</span> <span class="n">using</span> <span class="n">the</span> <span class="n">n</span><span class="o">:</span><span class="n">param</span> <span class="n">tag</span><span class="o">.</span> <span class="o">--</span><span class="k">%&gt;</span>

<span class="nt">&lt;n:submitLink</span> <span class="na">uri=</span><span class="s">&quot;/action/menu/index&quot;</span> <span class="na">name=</span><span class="s">&quot;switchToNewYork&quot;</span><span class="nt">&gt;</span>

  New York

  <span class="nt">&lt;n:param</span> <span class="na">paramName=</span><span class="s">&quot;user.timeZone&quot;</span> <span class="na">value=</span><span class="s">&quot;America/New_York&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/n:submitLink&gt;</span>
<span class="nt">&lt;n:submitLink</span> <span class="na">uri=</span><span class="s">&quot;/action/menu/index&quot;</span> <span class="na">name=</span><span class="s">&quot;switchToTokyo&quot;</span><span class="nt">&gt;</span>

  Tokyo

  <span class="nt">&lt;n:param</span> <span class="na">paramName=</span><span class="s">&quot;user.timeZone&quot;</span> <span class="na">value=</span><span class="s">&quot;Asia/Tokyo&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/n:submitLink&gt;</span>
</pre></div>
</div>
</dd>
<dt>Implementation example of handler</dt>
<dd><div class="first last highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Handler for holding the time zone selected by the user.</span>
<span class="c1">// Implement as a handler assuming that the user selects the time zone on multiple screens.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">I18nHandler</span> <span class="kd">implements</span> <span class="n">HttpRequestHandler</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">HttpResponse</span> <span class="nf">handle</span><span class="o">(</span><span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">timeZone</span> <span class="o">=</span> <span class="n">getTimeZone</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="s">&quot;user.timeZone&quot;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtil</span><span class="o">.</span><span class="na">hasValue</span><span class="o">(</span><span class="n">timeZone</span><span class="o">))</span> <span class="o">{</span>

            <span class="c1">// Call keepTimeZone method of TimeZoneAttributeInHttpUtil,</span>
            <span class="c1">//  and configure the selected time zone for cookie.</span>
            <span class="c1">// Time zone is also set in the thread context.</span>
            <span class="c1">// If the specified time zone is not supported,</span>
            <span class="c1">// cookies and thread context are not configured.</span>
            <span class="n">TimeZoneAttributeInHttpUtil</span><span class="o">.</span><span class="na">keepTimeZone</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="n">timeZone</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">handleNext</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getTimeZone</span><span class="o">(</span><span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">String</span> <span class="n">paramName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">request</span><span class="o">.</span><span class="na">getParamMap</span><span class="o">().</span><span class="na">containsKey</span><span class="o">(</span><span class="n">paramName</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">getParam</span><span class="o">(</span><span class="n">paramName</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
        <p>
            &copy; Copyright 2010-2021, TIS Inc.
        </p>
    </div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'5u20',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>