


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv='content-language' content='ja'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.1.1.2.1. Output of Failure Log &mdash; ∇Nablarch  5u20 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  

  
  <link rel="canonical" href="https://nablarch.github.io/docs/LATEST/doc/application_framework/application_framework/libraries/log/failure_log.html" />
  
    <link rel="top" title="∇Nablarch  5u20 documentation" href="../../../../index.html"/>
        <link rel="up" title="7.1. Log Output" href="../log.html"/>
        <link rel="next" title="7.1.1.2.2. Output of SQL Log" href="sql_log.html"/>
        <link rel="prev" title="7.1. Log Output" href="../log.html"/>
 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  
  <a href="../../../../index.html" id="sidebar-title" class="icon"> ∇Nablarch 
  

  
    <div id="sidebar-version">Version: 5u20</div>
  </a>

  <div role="search">
    <form id="google-search-form" class="wy-form" method="get" action="https://www.google.co.jp/search">
      <input type="text" name="text" placeholder="Search docs on google" id="text"/>
      <input type="hidden" name="q" id="q"/>
    </form>
  </div>
    
    

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../about_nablarch/index.html">What is the Nablarch?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/concept.html">Nablarch Concept</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#robustness">Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#testability">Testability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#ready-to-use">Ready-to-Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/mvn_module.html">Module List of Nablarch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/license.html">Information on Nablarch License</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Nablarch Application Framework</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Application Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../nablarch/index.html">1. What is Nablarch Application Framework?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/index.html">2. Web Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web_service/index.html">3. Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../batch/index.html">4. Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../messaging/index.html">5. Messaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../handlers/index.html">6. Standard Handler Provided by Nablarch</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">7. Libraries Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../blank_project/index.html">8. Blank Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../setting_guide/index.html">9. Nablarch Application Framework Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/index.html">10. Default Configuration List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cloud_native/index.html">11. Nablarch Cloud Native Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../adaptors/index.html">Adaptor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/log_adaptor.html">log Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/router_adaptor.html">Routing Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/webspheremq_adaptor.html">IBM WebSphere MQ Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/jaxrs_adaptor.html">JAX-RS Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/doma_adaptor.html">Doma Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/jsr310_adaptor.html">JSR310(Date and Time API)Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_freemarker_adaptor.html">E-mail FreeMarker Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_thymeleaf_adaptor.html">E-mail Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_velocity_adaptor.html">E-mail Velocity Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/web_thymeleaf_adaptor.html">Web Application Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/lettuce_adaptor.html">Lettuce Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/slf4j_adaptor.html">SLF4J Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/micrometer_adaptor.html">Micrometer Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../example/index.html">Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../example/index.html#procedure-to-build-the-environment">Procedure to build the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../example/index.html#application-execution-procedure">Application execution procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../extension_components/index.html">Nablarch extension component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/report/index.html">1. Form library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/workflow/doc/index.html">2. Workflow library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/workflow/tool/index.html">3. Workflow definition data generation tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/etl/index.html">4. ETL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/etl/etl_maven_plugin.html">5. ETL Maven plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development_tools/index.html">Nablarch development tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html">1. Efficient Java Static Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#conduct-syntax-check">1.1. Conduct syntax check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#unify-the-format">1.2. Unify the format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#check-if-unauthorized-apis-are-being-used">1.3. Check if unauthorized APIs are being used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/ui_dev/index.html">2. Front-end UI development platform for advanced users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/testing_framework/index.html">3. Testing framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/05_UnitTestGuide/index.html">3.1. How to Execute Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/06_TestFWGuide/index.html">3.2. How to Use the Automated Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/08_TestTools/index.html">3.3. Tools Used in the Programming Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/toolbox/index.html">4. Useful Tools When Developing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/JspStaticAnalysis/index.html">4.1. JSP Static Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/SqlExecutor/SqlExecutor.html">4.2. Nablarch SQL Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/JspVerifier/JspVerifier.html">4.3. Job Screen JSP Validation Tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/index.html">Nablarch Implementation Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/01/index.html">Sample Password Encryption Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/0101_PBKDF2PasswordEncryptor.html">Sample Password Encryption Function Using PBKDF2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/02/index.html">Extended Validation Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#email-address-validation">Email address validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#validation-of-japan-telephone-numbers">Validation of Japan telephone numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#code-value-validation">Code value validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/03/index.html">Display a List of Search Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-use">How to Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#listsearchinfo-class">ListSearchInfo class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#listsearchresult-tag">listSearchResult tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#sort-search-results">Sort search results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-implement-displaying-a-list-of-all-search-results-on-a-single-screen">How to implement displaying a list of all search results on a single screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-implement-the-initial-display-of-search-results-with-the-default-search-conditions">How to implement the initial display of search results with the default search conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#default-settings-for-the-search-result-list-display-function">Default settings for the search result list display function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-import-a-sample-implementation-tag-file-into-the-business-application">How to import a sample implementation (tag file) into the business application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#tag-reference">Tag Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/04/index.html">Extended Formatter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/04/0401_ExtendedDataFormatter.html">Data Formatter Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/04/0402_ExtendedFieldType.html">Field Type Expansion in the Data Formatter Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/05/index.html">Sample File Management Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/06/index.html">CAPTCHA Function Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/06_Captcha_guide.html">How to Incorporate the CAPTCHA Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/07/index.html">Sample UserAgent Information Acquisition Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#description-of-configuration">Description of configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#use-case">Use case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/08/index.html">Sample of HTML Email Send Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#implementation-examples">Implementation examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/09/index.html">How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#environment-preparation">Environment preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#structure-of-digitally-signed-email-send-function">Structure of digitally signed email send function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#preparation-of-configuration-file">Preparation of configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/10/index.html">How to Use the Log Aggregation Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/10/index.html#list-of-samples-provided">List of samples provided</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/11/index.html">Messaging Platform Test Simulator Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#uses">Uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#how-to-use">How to use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#expansion-example">Expansion example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nablarch_api/index.html">Nablarch API</a></li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">∇Nablarch </a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../index.html">Nablarch Application Framework</a> &raquo;</li>
      
          <li><a href="../../index.html">Application Framework</a> &raquo;</li>
      
          <li><a href="../index.html">7. Libraries Provided by Nablarch</a> &raquo;</li>
      
          <li><a href="../log.html">7.1. Log Output</a> &raquo;</li>
      
    <li>7.1.1.2.1. Output of Failure Log</li>
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/nablarch" class="fa fa-github">GitHub</a>
    </li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://nablarch.github.io/docs/LATEST/doc/index.html" class="ja">日本語</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="output-of-failure-log">
<span id="failure-log"></span><h1>7.1.1.2.1. Output of Failure Log<a class="headerlink" href="#output-of-failure-log" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#output-policy-of-failure-log" id="id2">Output policy of failure log</a></li>
<li><a class="reference internal" href="#how-to-use" id="id3">How to use</a><ul>
<li><a class="reference internal" href="#output-failure-log" id="id4">Output failure log</a></li>
<li><a class="reference internal" href="#configure-the-failure-log" id="id5">Configure the failure log</a></li>
<li><a class="reference internal" href="#add-contact-information-to-failure-log" id="id6">Add contact information to failure log</a></li>
<li><a class="reference internal" href="#change-the-framework-failure-codes" id="id7">Change the framework failure codes</a></li>
<li><a class="reference internal" href="#output-the-derived-source-run-time-information" id="id8">Output the derived source run time information</a></li>
<li><a class="reference internal" href="#customize-the-output-process-for-placeholders" id="id9">Customize the output process for placeholders</a></li>
</ul>
</li>
</ul>
</div>
<p>In the framework, the failure log is output by the exception handler for each process architecture.
The log is output in the application if a subsequent process is continued in the case of a failure during a batch process.</p>
<div class="section" id="output-policy-of-failure-log">
<h2><a class="toc-backref" href="#id2">7.1.1.2.1.1. Output policy of failure log</a><a class="headerlink" href="#output-policy-of-failure-log" title="Permalink to this headline">¶</a></h2>
<p>The log monitoring tool is assumed to monitor and detect failures,
the failure notification log is output to a dedicated failure notification file with the logger name.
The failure analysis log is output to an application log that outputs the log of the entire application.</p>
<table border="1" class="colwidths-given white-space-normal docutils" id="id1">
<caption><span class="caption-text">Output policy of failure log</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Log type</th>
<th class="head">Log level</th>
<th class="head">Logger name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Failure notification log</td>
<td>FATAL, ERROR</td>
<td>MONITOR</td>
</tr>
<tr class="row-odd"><td>Failure analysis log</td>
<td>FATAL, ERROR</td>
<td>Class name</td>
</tr>
</tbody>
</table>
<p>A configuration example of the log output for the above mentioned output policy is shown below</p>
<dl class="docutils">
<dt>Configuration example of log.properties</dt>
<dd><div class="first last highlight-properties"><div class="highlight"><pre><span></span><span class="na">writerNames</span><span class="o">=</span><span class="s">monitorLog,appLog</span>

<span class="c"># Output destination of failure notification log</span>
<span class="na">writer.monitorLog.className</span><span class="o">=</span><span class="s">nablarch.core.log.basic.FileLogWriter</span>
<span class="na">writer.monitorLog.filePath</span><span class="o">=</span><span class="s">/var/log/app/monitor.log</span>
<span class="na">writer.monitorLog.formatter.className</span><span class="o">=</span><span class="s">nablarch.core.log.basic.BasicLogFormatter</span>
<span class="na">writer.monitorLog.formatter.format</span><span class="o">=</span><span class="s">$date$ -$logLevel$- $runtimeLoggerName$ [$executionId$] boot_proc = [$bootProcess$] proc_sys = [$processingSystem$] req_id = [$requestId$] usr_id = [$userId$] $message$</span>

<span class="c"># Output destination of application log</span>
<span class="na">writer.appLog.className</span><span class="o">=</span><span class="s">nablarch.core.log.basic.FileLogWriter</span>
<span class="na">writer.appLog.filePath</span><span class="o">=</span><span class="s">/var/log/app/app.log</span>
<span class="na">writer.appLog.maxFileSize</span><span class="o">=</span><span class="s">10000</span>
<span class="na">writer.appLog.formatter.className</span><span class="o">=</span><span class="s">nablarch.core.log.basic.BasicLogFormatter</span>
<span class="na">writer.appLog.formatter.format</span><span class="o">=</span><span class="s">$date$ -$logLevel$- $runtimeLoggerName$ [$executionId$] boot_proc = [$bootProcess$] proc_sys = [$processingSystem$] req_id = [$requestId$] usr_id = [$userId$] $message$$information$$stackTrace$</span>

<span class="na">availableLoggersNamesOrder</span><span class="o">=</span><span class="s">MON,ROO</span>

<span class="c"># Configure application log</span>
<span class="na">loggers.ROO.nameRegex</span><span class="o">=</span><span class="s">.*</span>
<span class="na">loggers.ROO.level</span><span class="o">=</span><span class="s">INFO</span>
<span class="na">loggers.ROO.writerNames</span><span class="o">=</span><span class="s">appLog</span>

<span class="c"># Output configuration of failure notification log</span>
<span class="na">loggers.MON.nameRegex</span><span class="o">=</span><span class="s">MONITOR</span>
<span class="na">loggers.MON.level</span><span class="o">=</span><span class="s">ERROR</span>
<span class="na">loggers.MON.writerNames</span><span class="o">=</span><span class="s">monitorLog</span>
</pre></div>
</div>
</dd>
<dt>Configuration example of app-log.properties</dt>
<dd><div class="first last highlight-properties"><div class="highlight"><pre><span></span><span class="c"># FailureLogFormatter</span>
<span class="c">#failureLogFormatter.className=</span>
<span class="na">failureLogFormatter.defaultFailureCode</span><span class="o">=</span><span class="s">MSG99999</span>
<span class="na">failureLogFormatter.defaultMessage</span><span class="o">=</span><span class="s">an unexpected exception occurred.</span>
<span class="na">failureLogFormatter.language</span><span class="o">=</span><span class="s">ja</span>
<span class="na">failureLogFormatter.notificationFormat</span><span class="o">=</span><span class="s">fail_code = [$failureCode$] $message$</span>
<span class="na">failureLogFormatter.analysisFormat</span><span class="o">=</span><span class="s">fail_code = [$failureCode$] $message$\nInput Data :\n$data$</span>
<span class="c">#failureLogFormatter.contactFilePath=</span>
<span class="c">#failureLogFormatter.fwFailureCodeFilePath=</span>
</pre></div>
</div>
</dd>
</dl>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">In large scale systems, when there are multiple contacts during failure,
contact information for each request ID can be included in the log by using <a class="reference internal" href="#failure-log-add-contact"><span>Add contact information to failure log</span></a>.</p>
</div>
</div>
<div class="section" id="how-to-use">
<h2><a class="toc-backref" href="#id3">7.1.1.2.1.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<div class="section" id="output-failure-log">
<span id="failure-log-logging"></span><h3><a class="toc-backref" href="#id4">7.1.1.2.1.2.1. Output failure log</a><a class="headerlink" href="#output-failure-log" title="Permalink to this headline">¶</a></h3>
<p>For failure log output, use <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/log/app/FailureLogUtil.html" title="nablarch.core.log.app.FailureLogUtil">FailureLogUtil</a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="o">{</span>
    <span class="c1">// Business process</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UserNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Specify the exception caught, process target data and failure code.</span>
    <span class="n">FailureLogUtil</span><span class="o">.</span><span class="na">logError</span><span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">inputData</span><span class="o">,</span> <span class="s">&quot;USER_NOT_FOUND&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>In batch process and messaging, it may be necessary to output the failure log and terminate the business process
when a failure is detected.
In such cases,
<a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/results/TransactionAbnormalEnd.html" title="nablarch.fw.results.TransactionAbnormalEnd">TransactionAbnormalEnd</a> or
<a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/launcher/ProcessAbnormalEnd.html" title="nablarch.fw.launcher.ProcessAbnormalEnd">ProcessAbnormalEnd</a> is thrown,
and a request is sent to the exception handler (<a class="reference internal" href="../../handlers/common/global_error_handler.html#global-error-handler"><span>Global Error Handler</span></a> or <a class="reference internal" href="../../handlers/standalone/request_thread_loop_handler.html#request-thread-loop-handler"><span>Loop Control Handler in Request Thread</span></a>) to output the failure log.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// When an own exception is generated</span>
<span class="k">if</span> <span class="o">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Specify the exit code and failure code.</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">TransactionAbnormalEnd</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="s">&quot;USER_NOT_FOUND&quot;</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// If an exception is caught</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="c1">// Business process</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UserNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Specify the exit code, caught exception and failure code.</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">ProcessAbnormalEnd</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">e</span><span class="o">,</span> <span class="s">&quot;USER_NOT_FOUND&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">As in the above example, failure code is specified in the failure log output to identify the failure content from the log.
Specify a code system for failure code in every project.</p>
</div>
<dl class="docutils">
<dt>Message output to the failure log</dt>
<dd><p class="first">For output of the message to the failure log, use <a class="reference internal" href="../message.html#message"><span>Message Management</span></a> and acquire the message corresponding to the failure code.
If the <a class="reference internal" href="../message.html#message"><span>Message Management</span></a> cannot be found in the message, an exception is thrown.
When an exception occurs in the message acquisition process, in addition to the failure log,
WARN level log of the exception in the message acquisition process is output and the following message is output in the failure log.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>failed to get the message to output the failure log. <span class="nv">failureCode</span> <span class="o">=</span> <span class="o">[</span>&lt;Failure code&gt;<span class="o">]</span>
</pre></div>
</div>
<p class="last">When a failure code is not specified, such as an exception or error captured by the framework exception handler,
the default <a class="reference internal" href="#failure-log-prop-default-failure-code"><span>failure code</span></a> and <a class="reference internal" href="#failure-log-prop-default-message"><span>message</span></a>
specified by the configuration are output.</p>
</dd>
</dl>
</div>
<div class="section" id="configure-the-failure-log">
<span id="failure-log-setting"></span><h3><a class="toc-backref" href="#id5">7.1.1.2.1.2.2. Configure the failure log</a><a class="headerlink" href="#configure-the-failure-log" title="Permalink to this headline">¶</a></h3>
<p>The failure log is configured in the property file described in <a class="reference internal" href="../log.html#log-app-log-setting"><span>Configure various logs</span></a>.</p>
<dl class="docutils">
<dt>Description rules</dt>
<dd><p class="first"></p>
<dl class="docutils">
<dt>failureLogFormatter.className</dt>
<dd>This class implements failureLogFormatter.className <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/log/app/FailureLogFormatter.html" title="nablarch.core.log.app.FailureLogFormatter">FailureLogFormatter</a>.
Specify to replace.</dd>
</dl>
<dl class="docutils" id="failure-log-prop-default-failure-code">
<dt>failureLogFormatter.defaultFailureCode <code class="docutils literal"><span class="pre">required</span></code></dt>
<dd>Default failure code.
Use when there is no failure code specified, like in cases where an error is captured by the exception handler.</dd>
</dl>
<dl class="docutils" id="failure-log-prop-default-message">
<dt>failureLogFormatter.defaultMessage <code class="docutils literal"><span class="pre">required</span></code></dt>
<dd>Default message.
This message is output when a default failure code is used.</dd>
<dt>failureLogFormatter.language</dt>
<dd>The language used to acquire the message from the failure code.
If it is not specified, the language configured in <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/ThreadContext.html" title="nablarch.core.ThreadContext">ThreadContext</a> will be used.</dd>
</dl>
<dl class="docutils" id="failure-log-prop-notification-format">
<dt>failureLogFormatter.notificationFormat</dt>
<dd><p class="first">Format for failure notification log.</p>
<dl class="last docutils">
<dt>Placeholders that can be specified for the format</dt>
<dd><p class="first"></p>
<table border="1" class="colwidths-given white-space-normal last docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Item名</th>
<th class="head">Placeholder</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Failure code</td>
<td>$failureCode$</td>
<td>A code that uniquely identifies the failure. Used to identify the nature of the failure.</td>
</tr>
<tr class="row-odd"><td>Message</td>
<td>$message$</td>
<td>The message corresponding to the failure code. Used to identify the nature of the failure.</td>
</tr>
<tr class="row-even"><td>Data to be processed</td>
<td>$data$</td>
<td>Used to identify the data targeted by the process in which the failure occurred.
Outputs by calling the toString method of the data object read using the data reader.</td>
</tr>
<tr class="row-odd"><td>Contact</td>
<td>$contact$</td>
<td>Used to identify the contacts.</td>
</tr>
</tbody>
</table>
</dd>
<dt>Default format</dt>
<dd><div class="first last highlight-java"><div class="highlight"><pre><span></span><span class="n">fail_code</span> <span class="o">=</span> <span class="o">[</span><span class="n">$failureCode$</span><span class="o">]</span> <span class="n">$message$</span>
</pre></div>
</div>
</dd>
</dl>
</dd>
<dt>failureLogFormatter.analysisFormat</dt>
<dd>Format of failure analysis log.
Placeholders that can be specified for the format and default format are same as
<a class="reference internal" href="#failure-log-prop-notification-format"><span>format for failure notification log</span></a>.</dd>
<dt>failureLogFormatter.contactFilePath</dt>
<dd>Path to the property file that specifies the contact information of the failure.
Specify to output the contact information of the failure.
For details, see <a class="reference internal" href="#failure-log-add-contact"><span>Add contact information to failure log</span></a>.</dd>
<dt>failureLogFormatter.fwFailureCodeFilePath</dt>
<dd>Path to the property file that specifies the information change of the failure code in the framework.
Specify when changing the failure code of the framework at the time of failure log output.
For details, see <a class="reference internal" href="#failure-log-change-fw-failure-code"><span>Change the framework failure codes</span></a>.</dd>
</dl>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">When output of personal, confidential information, etc. is not allowed even in the failure analysis log
due to security requirements of the system, refer to <a class="reference internal" href="#failure-log-placeholder-customize"><span>Customize the output process for placeholders</span></a> and customize the project.</p>
</div>
<div class="last admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Derived source run time information can be output to the failure log by output of the process target data.
When the data from the web has to be linked to the batch process,
runtime information (request ID or run time ID etc.) during execution of the screen process is the derived source run time information in the batch process.
For information on how to output the derived source run time information, <a class="reference internal" href="#failure-log-output-src-exe-info"><span>Output the derived source run time information</span></a>.</p>
</div>
</dd>
<dt>Example of the description</dt>
<dd><div class="first last highlight-properties"><div class="highlight"><pre><span></span><span class="na">failureLogFormatter.className</span><span class="o">=</span><span class="s">nablarch.core.log.app.FailureLogFormatter</span>
<span class="na">failureLogFormatter.defaultFailureCode</span><span class="o">=</span><span class="s">UNEXPECTED_ERROR</span>
<span class="na">failureLogFormatter.defaultMessage</span><span class="o">=</span><span class="s">an unexpected exception occurred.</span>
<span class="na">failureLogFormatter.language</span><span class="o">=</span><span class="s">en</span>
<span class="na">failureLogFormatter.notificationFormat</span><span class="o">=</span><span class="s">fail_code = [$failureCode$] $message$</span>
<span class="na">failureLogFormatter.analysisFormat</span><span class="o">=</span><span class="s">fail_code = [$failureCode$] $message$</span>
<span class="na">failureLogFormatter.derivedRequestIdPropName</span><span class="o">=</span><span class="s">insertRequestId</span>
<span class="na">failureLogFormatter.derivedUserIdPropName</span><span class="o">=</span><span class="s">updatedUserId</span>
<span class="na">failureLogFormatter.contactFilePath</span><span class="o">=</span><span class="s">classpath:failure-log-contact.properties</span>
<span class="na">failureLogFormatter.fwFailureCodeFilePath</span><span class="o">=</span><span class="s">classpath:failure-log-fw-codes.properties</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="add-contact-information-to-failure-log">
<span id="failure-log-add-contact"></span><h3><a class="toc-backref" href="#id6">7.1.1.2.1.2.3. Add contact information to failure log</a><a class="headerlink" href="#add-contact-information-to-failure-log" title="Permalink to this headline">¶</a></h3>
<p>The contact information may have to be included in the failure log, like in the case with multiple contacts during failure of large scale systems.
Therefore, a function that specifies the contact information for each request ID should be provided in the output failure log.</p>
<p>Addition of the contact information should be specified in the property file.Specify the request ID as the key and contact information as the value.
Request ID specified as the key is searched using prefix match with the request ID acquired from <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/ThreadContext.html" title="nablarch.core.ThreadContext">ThreadContext</a>.
Therefore, after reading the contents of the property file, sort in the descending order of the key name length for retrieval using limited request ID.</p>
<p>An example of adding the contact information is shown below.</p>
<p>First, prepare a property file. A file with the name <code class="docutils literal"><span class="pre">failure-log-contact.properties</span></code> that is placed directly under the class path.</p>
<dl class="docutils">
<dt>Configuration example of failure-log-contact.properties</dt>
<dd><div class="first highlight-properties"><div class="highlight"><pre><span></span><span class="c"># Request ID= Contact information</span>
<span class="na">/users/</span><span class="o">=</span><span class="s">USRMGR999</span>
<span class="na">/users/index</span><span class="o">=</span><span class="s">USRMGR300</span>
<span class="na">/users/list</span><span class="o">=</span><span class="s">USRMGR301</span>
<span class="na">/users/new</span><span class="o">=</span><span class="s">USRMGR302</span>
<span class="na">/users/edit</span><span class="o">=</span><span class="s">USRMGR303</span>
</pre></div>
</div>
<p>The above-mentioned property file is sorted as follows and is used for the search in order from the top.</p>
<div class="last highlight-properties"><div class="highlight"><pre><span></span><span class="c"># If the key names have the same length, the order changes each time they are executed.</span>
<span class="na">/users/index</span><span class="o">=</span><span class="s">USRMGR300</span>
<span class="na">/users/list</span><span class="o">=</span><span class="s">USRMGR301</span>
<span class="na">/users/edit</span><span class="o">=</span><span class="s">USRMGR303</span>
<span class="na">/users/new</span><span class="o">=</span><span class="s">USRMGR302</span>
<span class="na">/users/</span><span class="o">=</span><span class="s">USRMGR999</span>
</pre></div>
</div>
</dd>
</dl>
<p>Next, specify the placeholder <code class="docutils literal"><span class="pre">$contact$</span></code> that represents the contact information in the failure log format.
Specify the property file path.</p>
<dl class="docutils">
<dt>Configuration example of app-log.properties</dt>
<dd><div class="first last highlight-properties"><div class="highlight"><pre><span></span><span class="c"># Configuration of FailureLogFormatter</span>
<span class="na">failureLogFormatter.defaultFailureCode</span><span class="o">=</span><span class="s">UNEXPECTED_ERROR</span>
<span class="na">failureLogFormatter.defaultMessage</span><span class="o">=</span><span class="s">an unexpected exception occurred.</span>
<span class="na">failureLogFormatter.notificationFormat</span><span class="o">=</span><span class="s">[$failureCode$:$message$] &lt;$contact$&gt;</span>
<span class="na">failureLogFormatter.analysisFormat</span><span class="o">=</span><span class="s">fail_code = [$failureCode$] $message$ &lt;$contact$&gt;</span>

<span class="c"># Specify the property file path.</span>
<span class="na">failureLogFormatter.contactFilePath</span><span class="o">=</span><span class="s">classpath:failure-log-contact.properties</span>
</pre></div>
</div>
</dd>
</dl>
<p>Contact information is output for every request ID based on the above mentioned configuration.
An output example of failure that occurred for the request ID <code class="docutils literal"><span class="pre">/users/new</span></code> is shown below.
<code class="docutils literal"><span class="pre">USRMGR302</span></code> is output to the location (enclosed in &lt;&gt;) where <code class="docutils literal"><span class="pre">$contact$</span></code> is specified.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Failure notification log</span>
<span class="m">2011</span>-02-15 <span class="m">15</span>:09:57.691 -FATAL- <span class="o">[</span>APUSRMGR0001201102151509320020009<span class="o">]</span> R<span class="o">[</span>/users/new<span class="o">]</span> U<span class="o">[</span><span class="m">0000000001</span><span class="o">]</span> <span class="o">[</span>UNEXPECTED_ERROR:an unexpected exception occurred.<span class="o">]</span> &lt;USRMGR302&gt;

<span class="c1"># Failure analysis log</span>
<span class="m">2011</span>-02-15 <span class="m">15</span>:09:57.707 -FATAL- <span class="o">[</span>APUSRMGR0001201102151509320020009<span class="o">]</span> R<span class="o">[</span>/users/new<span class="o">]</span> U<span class="o">[</span><span class="m">0000000001</span><span class="o">]</span> <span class="nv">fail_code</span> <span class="o">=</span> <span class="o">[</span>UNEXPECTED_ERROR<span class="o">]</span> an unexpected exception occurred. &lt;USRMGR302&gt;
<span class="c1"># Stack trace is omitted.</span>
</pre></div>
</div>
<p>Outputs null when the contact information corresponding to the request ID cannot be found.</p>
</div>
<div class="section" id="change-the-framework-failure-codes">
<span id="failure-log-change-fw-failure-code"></span><h3><a class="toc-backref" href="#id7">7.1.1.2.1.2.4. Change the framework failure codes</a><a class="headerlink" href="#change-the-framework-failure-codes" title="Permalink to this headline">¶</a></h3>
<p>A RuntimeException exception is thrown when an unexpected error occurs in the framework.
As a result, for all the exceptions thrown by the framework, default failure code is used and output to the failure log.
In failure monitoring, since there may be cases where filtering the monitoring target based on the failure code may be required,
a function should be provided to specify the framework failure code in the output of the failure log.</p>
<p>Framework failure code can be specified for every class name that throws an exception.
The &#8220;class in which the exception is thrown&#8221; is the root element for the stack trace.
For example, the class is nablarch.core.message.StringResourceHolder for the following stack trace.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Stack Trace Information :
java.lang.RuntimeException: ValidateFor method invocation failed. <span class="nv">targetClass</span> <span class="o">=</span> java.lang.Class, <span class="nv">method</span> <span class="o">=</span> validateForRegisterUser
    at nablarch.core.validation.ValidationManager.validateAndConvert<span class="o">(</span>ValidationManager.java:202<span class="o">)</span>
    <span class="c1"># Omits stack trace in the middle.</span>
Caused by: nablarch.core.message.MessageNotFoundException: message was not found. message <span class="nv">id</span> <span class="o">=</span> MSG00010
    at nablarch.core.message.StringResourceHolder.get<span class="o">(</span>StringResourceHolder.java:40<span class="o">)</span>
    <span class="c1"># Subsequent stack trace is omitted.(Caused by does not appear subsequently)</span>
</pre></div>
</div>
<p>However, it is not realistic to configure failure codes for every framework class as the classification will become too detailed.
Basically, it is possible to determine which function of the framework threw an exception by specifying the failure code for the package name unit.</p>
<p>The failure code of the framework is specified in the property file.
Specify the framework package name as the key and failure code as value in the property file.
The package name specified as the key is used with prefix match to search the FQCN (fully qualified class name) of the class
which threw an exception obtained from stack trace. Therefore, after reading the contents of the property file,
sort in the descending order of the key name length for retrieval using limited package name.</p>
<p>An example for changing the framework failure code is shown below</p>
<p>First, prepare a property file.
A file with the name <code class="docutils literal"><span class="pre">failure-log-fw-codes.properties</span></code> that is placed directly under the class path.
By specifying the nablarch package name, failure codes can be specified for all the packages to which the failure codes have not been specified separately.</p>
<dl class="docutils">
<dt>Configuration example of failure-log-fw-codes.properties</dt>
<dd><div class="first highlight-properties"><div class="highlight"><pre><span></span><span class="c"># Framework package name = Failure code</span>
<span class="na">nablarch</span><span class="o">=</span><span class="s">FW_ERROR</span>
<span class="na">nablarch.core.cache</span><span class="o">=</span><span class="s">FW_CACHE_ERROR</span>
<span class="na">nablarch.core.date</span><span class="o">=</span><span class="s">FW_DATE_ERROR</span>
<span class="na">nablarch.core.db</span><span class="o">=</span><span class="s">FW_DB_ERROR</span>
<span class="na">nablarch.core.message</span><span class="o">=</span><span class="s">FW_MESSAGE_ERROR</span>
<span class="na">nablarch.core.repository</span><span class="o">=</span><span class="s">FW_REPOSITORY_ERROR</span>
<span class="na">nablarch.core.transaction</span><span class="o">=</span><span class="s">FW_TRANSACTION_ERROR</span>
</pre></div>
</div>
<p>The above-mentioned property file is sorted as follows and is used for the search in order from the top.</p>
<div class="last highlight-properties"><div class="highlight"><pre><span></span><span class="na">nablarch.core.transaction</span><span class="o">=</span><span class="s">FW_TRANSACTION_ERROR</span>
<span class="na">nablarch.core.repository</span><span class="o">=</span><span class="s">FW_REPOSITORY_ERROR</span>
<span class="na">nablarch.core.message</span><span class="o">=</span><span class="s">FW_MESSAGE_ERROR</span>
<span class="na">nablarch.core.cache</span><span class="o">=</span><span class="s">FW_CACHE_ERROR</span>
<span class="na">nablarch.core.date</span><span class="o">=</span><span class="s">FW_DATE_ERROR</span>
<span class="na">nablarch.core.db</span><span class="o">=</span><span class="s">FW_DB_ERROR</span>
<span class="na">nablarch</span><span class="o">=</span><span class="s">FW_ERROR</span>
</pre></div>
</div>
</dd>
</dl>
<p>Next, specify the property file path in the configuration of FailureLogFormatter.</p>
<dl class="docutils">
<dt>Configuration example of app-log.properties</dt>
<dd><div class="first last highlight-properties"><div class="highlight"><pre><span></span><span class="na">failureLogFormatter.defaultFailureCode</span><span class="o">=</span><span class="s">UNEXPECTED_ERROR</span>
<span class="na">failureLogFormatter.defaultMessage</span><span class="o">=</span><span class="s">an unexpected exception occurred.</span>
<span class="na">failureLogFormatter.notificationFormat</span><span class="o">=</span><span class="s">[$failureCode$:$message$]</span>
<span class="na">failureLogFormatter.analysisFormat</span><span class="o">=</span><span class="s">fail_code = [$failureCode$] $message$</span>
<span class="c"># Specify the property file path.</span>
<span class="na">failureLogFormatter.fwFailureCodeFilePath</span><span class="o">=</span><span class="s">classpath:failure-log-fw-codes.properties</span>
</pre></div>
</div>
</dd>
</dl>
<p>The framework failure code is changed based on the above configuration. Some output examples of the failure notification log is shown below</p>
<dl class="docutils">
<dt>When exception is thrown with nablarch.core.date.BasicBusinessDateProvider class</dt>
<dd><div class="first last highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Applicable when nablarch.core.date of property file = FW_DATE_ERROR.</span>
<span class="m">2011</span>-02-15 <span class="m">16</span>:48:54.993 -FATAL- <span class="o">[</span>APUSRMGR0001201102151648315060002<span class="o">]</span> R<span class="o">[</span>/login<span class="o">]</span> U<span class="o">[</span><span class="m">9999999999</span><span class="o">]</span> <span class="nv">fail_code</span> <span class="o">=</span> <span class="o">[</span>FW_DATE_ERROR<span class="o">]</span> segment was not found. segment:00.
Stack Trace Information :
java.lang.IllegalStateException: segment was not found. segment:00.
    at nablarch.core.date.BasicBusinessDateProvider.getDate<span class="o">(</span>BasicBusinessDateProvider.java:103<span class="o">)</span>
    <span class="c1"># Subsequent stack trace is omitted.</span>
</pre></div>
</div>
</dd>
<dt>When exception is thrown withnablarch.core.message.StringResourceHolder class</dt>
<dd><div class="first last highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Applicable when nablarch.core.message of property file = FW_MESSAGE_ERROR.</span>
<span class="m">2011</span>-02-15 <span class="m">16</span>:54:06.413 -FATAL- <span class="o">[</span>APUSRMGR0001201102151653476260011<span class="o">]</span> R<span class="o">[</span>/users/edit<span class="o">]</span> U<span class="o">[</span><span class="m">0000000001</span><span class="o">]</span> <span class="nv">fail_code</span> <span class="o">=</span> <span class="o">[</span>FW_MESSAGE_ERROR<span class="o">]</span> ValidateFor method invocation failed. <span class="nv">targetClass</span> <span class="o">=</span> java.lang.Class, <span class="nv">method</span> <span class="o">=</span> validateForRegisterUser
Stack Trace Information :
java.lang.RuntimeException: ValidateFor method invocation failed. <span class="nv">targetClass</span> <span class="o">=</span> java.lang.Class, <span class="nv">method</span> <span class="o">=</span> validateForRegisterUser
    at nablarch.core.validation.ValidationManager.validateAndConvert<span class="o">(</span>ValidationManager.java:202<span class="o">)</span>
    <span class="c1"># Omits stack trace in the middle.</span>
Caused by: nablarch.core.message.MessageNotFoundException: message was not found. message <span class="nv">id</span> <span class="o">=</span> MSG00010
    at nablarch.core.message.StringResourceHolder.get<span class="o">(</span>StringResourceHolder.java:40<span class="o">)</span>
    <span class="c1"># Subsequent stack trace is omitted.</span>
</pre></div>
</div>
</dd>
<dt>When exception is thrown withnablarch.common.authentication.PasswordAuthenticator class</dt>
<dd><div class="first last highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Applicable when nablarch of property file =FW_ERROR.</span>
<span class="m">2011</span>-02-15 <span class="m">16</span>:59:03.076 -FATAL- <span class="o">[</span>APUSRMGR0001201102151658551890017<span class="o">]</span> R<span class="o">[</span>/login<span class="o">]</span> U<span class="o">[</span><span class="m">9999999999</span><span class="o">]</span> <span class="nv">fail_code</span> <span class="o">=</span> <span class="o">[</span>FW_ERROR<span class="o">]</span> authentication failed.
Stack Trace Information :
nablarch.common.authentication.AuthenticationFailedException
    at nablarch.common.authentication.PasswordAuthenticator.authenticate<span class="o">(</span>PasswordAuthenticator.java:302<span class="o">)</span>
    <span class="c1"># Subsequent stack trace is omitted.</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="output-the-derived-source-run-time-information">
<span id="failure-log-output-src-exe-info"></span><h3><a class="toc-backref" href="#id8">7.1.1.2.1.2.5. Output the derived source run time information</a><a class="headerlink" href="#output-the-derived-source-run-time-information" title="Permalink to this headline">¶</a></h3>
<p>When the data from the web has to be linked to the batch,
runtime information during execution of the screen process is the derived source run time information in the batch process.
Hereinafter, when data is linked between the process architectures, the side that performs the process first is referred to as the pre-stage process, and the side that performs the process later is referred to as the post-stage process.
When a failure occurs in the post-stage process, derived source run time information is output to reduce the tracking work of the pre-stage process.</p>
<p>The placeholder &#8220;$data$&#8221; of this function can be used to output the derived source run time information.
When the placeholder “$data$” is specified, the data read using the data reader is output in the failure log.
If derived source run time information is included in advance in the pre-stage process by using this function,
when a failure occurs in post-stage process , derived source run time information of the pre-stage process is output as the process target data.</p>
<p>An output example of the derived source run time information in the data link using the database is shown here.
The run time information is configured with the following column names in the pre-stage process.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Item</td>
<td>Column name</td>
</tr>
<tr class="row-even"><td>Request ID</td>
<td>INSERT_REQUEST_ID</td>
</tr>
<tr class="row-odd"><td>Run time ID</td>
<td>INSERT_EXECUTION_ID</td>
</tr>
<tr class="row-even"><td>User ID</td>
<td>UPDATED_USER_ID</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Configuration example of app-log.properties</dt>
<dd><div class="first last highlight-properties"><div class="highlight"><pre><span></span><span class="na">failureLogFormatter.defaultFailureCode</span><span class="o">=</span><span class="s">UNEXPECTED_ERROR</span>
<span class="na">failureLogFormatter.defaultMessage</span><span class="o">=</span><span class="s">an unexpected exception occurred.</span>
<span class="na">failureLogFormatter.notificationFormat</span><span class="o">=</span><span class="s">fail_code = [$failureCode$] $message$</span>
<span class="c"># Specify the placeholder &quot;data&quot; of process target data in the format of the failure analysis log.</span>
<span class="na">failureLogFormatter.analysisFormat</span><span class="o">=</span><span class="s">fail_code = [$failureCode$] $message$\nInput Data :\n$data$</span>
</pre></div>
</div>
</dd>
<dt>Output example of failure analysis log</dt>
<dd><div class="first last highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Failure analysis log</span>
<span class="m">2011</span>-09-26 <span class="m">21</span>:06:35.745 -FATAL- root <span class="o">[</span>EXECUTION_ID_0000000123456789<span class="o">]</span> <span class="nv">boot_proc</span> <span class="o">=</span> <span class="o">[]</span> <span class="nv">proc_sys</span> <span class="o">=</span> <span class="o">[]</span> <span class="nv">req_id</span> <span class="o">=</span> <span class="o">[</span>RB11AC0160<span class="o">]</span> <span class="nv">usr_id</span> <span class="o">=</span> <span class="o">[</span>batchuser1<span class="o">]</span> <span class="nv">fail_code</span> <span class="o">=</span> <span class="o">[</span>USER_REGISTER_FAILED<span class="o">]</span> Registration of user information failed.
Input Data :
<span class="o">{</span><span class="nv">MOBILE_PHONE_NUMBER_AREA_CODE</span><span class="o">=</span><span class="m">002</span>, <span class="nv">KANJI_NAME</span><span class="o">=</span>Yamamoto Taro, <span class="nv">USER_INFO_ID</span><span class="o">=</span><span class="m">00000000000000000113</span>, <span class="nv">INSERT_EXECUTION_ID</span><span class="o">=</span>EXECUTION_ID_2000000123456789, <span class="nv">MAIL_ADDRESS</span><span class="o">=</span>yamamoto@sample.com, <span class="nv">MOBILE_PHONE_NUMBER_CITY_CODE</span><span class="o">=</span><span class="m">0003</span>, <span class="nv">UPDATED_USER_ID</span><span class="o">=</span>batch_user, <span class="nv">MOBILE_PHONE_NUMBER_SBSCR_CODE</span><span class="o">=</span><span class="m">0004</span>, <span class="nv">KANA_NAME</span><span class="o">=</span> Yamamoto Taro, <span class="nv">EXTENSION_NUMBER_BUILDING</span><span class="o">=</span><span class="m">13</span>, <span class="nv">LOGIN_ID</span><span class="o">=</span><span class="m">12345678901234567890</span>, <span class="nv">EXTENSION_NUMBER_PERSONAL</span><span class="o">=</span><span class="m">1235</span>, <span class="nv">INSERT_REQUEST_ID</span><span class="o">=</span>RB11AC0140<span class="o">}</span>
Stack Trace Information :
<span class="o">[</span><span class="m">100</span> TransactionAbnormalEnd<span class="o">]</span> Registration of user information failed.
    at nablarch.sample.ss11AC.B11AC016Action.handle<span class="o">(</span>B11AC016Action.java:73<span class="o">)</span>
    at nablarch.sample.ss11AC.B11AC016Action.handle<span class="o">(</span>B11AC016Action.java:1<span class="o">)</span>
    at nablarch.fw.action.BatchAction.handle<span class="o">(</span>BatchAction.java:1<span class="o">)</span>
    <span class="c1"># Subsequent stack trace is omitted.</span>
</pre></div>
</div>
</dd>
<dt>The following run time information is output in the process target data (&#8220;Input Data:&#8221; of output example).</dt>
<dd><div class="first last highlight-properties"><div class="highlight"><pre><span></span><span class="na">INSERT_REQUEST_ID</span><span class="o">=</span><span class="s">RB11AC0140</span>
<span class="na">INSERT_EXECUTION_ID</span><span class="o">=</span><span class="s">EXECUTION_ID_2000000123456789</span>
<span class="na">UPDATED_USER_ID</span><span class="o">=</span><span class="s">batch_user</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="customize-the-output-process-for-placeholders">
<span id="failure-log-placeholder-customize"></span><h3><a class="toc-backref" href="#id9">7.1.1.2.1.2.6. Customize the output process for placeholders</a><a class="headerlink" href="#customize-the-output-process-for-placeholders" title="Permalink to this headline">¶</a></h3>
<p>Since all the data items of the process target data ($data$) are output with the toString method by default,
in some cases masking certain specific items based on the project security requirements may be necessary.
When the output process for the placeholder has to be customized, perform the following operation.</p>
<ul class="simple">
<li>Create a class that implements <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/log/LogItem.html" title="nablarch.core.log.LogItem">LogItem</a></li>
<li>Create a class that inherits <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/log/app/FailureLogFormatter.html" title="nablarch.core.log.app.FailureLogFormatter">FailureLogFormatter</a> and add a placeholder</li>
<li>Configure such that a class that inherits <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/log/app/FailureLogFormatter.html" title="nablarch.core.log.app.FailureLogFormatter">FailureLogFormatter</a> is used</li>
</ul>
<p>A customization example of the output process corresponding to the process target data ($data$) is shown here.</p>
<dl class="docutils">
<dt>Create a class that implements <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/log/LogItem.html" title="nablarch.core.log.LogItem">LogItem</a></dt>
<dd><p class="first">Create a class that provides output contents corresponding to the process target data ($data$).
Create a class by inheriting <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/log/app/FailureLogFormatter.DataItem.html" title="nablarch.core.log.app.FailureLogFormatter.DataItem">DataItem</a> provided by the framework
and implement such that mask processing is performed only for Map type of process target data.</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Defined as an inner class in the extension class of FailureLogFormatter.</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CustomDataItem</span> <span class="kd">extends</span> <span class="n">DataItem</span> <span class="o">{</span>

    <span class="cm">/** Mask character */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">char</span> <span class="n">MASKING_CHAR</span> <span class="o">=</span> <span class="sc">&#39;*&#39;</span><span class="o">;</span>

    <span class="cm">/** Pattern to be masked */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Pattern</span><span class="o">[]</span> <span class="n">MASKING_PATTERNS</span>
            <span class="o">=</span> <span class="k">new</span> <span class="n">Pattern</span><span class="o">[]</span> <span class="o">{</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">&quot;.*MOBILE_PHONE_NUMBER.*&quot;</span><span class="o">),</span>
                              <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">&quot;.*MAIL.*&quot;</span><span class="o">)};</span>

    <span class="cm">/**</span>
<span class="cm">     * Editor for masking map values.</span>
<span class="cm">     * Map editing utility provided by the framework.</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">MapValueEditor</span> <span class="n">mapValueEditor</span>
        <span class="o">=</span> <span class="k">new</span> <span class="n">MaskingMapValueEditor</span><span class="o">(</span><span class="n">MASKING_CHAR</span><span class="o">,</span> <span class="n">MASKING_PATTERNS</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;unchecked&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="n">FailureLogContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// Call getData method of FailureLogContext and acquire process target data.</span>
        <span class="n">Object</span> <span class="n">data</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>

        <span class="c1">// If it is not Map, call the default implementation of the framework.</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">data</span> <span class="k">instanceof</span> <span class="n">Map</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// Returns a string with the Map masked.</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">editedMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="o">((</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;)</span> <span class="n">data</span><span class="o">).</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
            <span class="n">editedMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">mapValueEditor</span><span class="o">.</span><span class="na">edit</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">()));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">editedMap</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</dd>
<dt>Create a class that inherits <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/log/app/FailureLogFormatter.html" title="nablarch.core.log.app.FailureLogFormatter">FailureLogFormatter</a> and add a placeholder</dt>
<dd><p class="first">Override <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/log/app/FailureLogFormatter.html#getLogItems-java.util.Map-" title="nablarch.core.log.app.FailureLogFormatter.getLogItems(java.util.Map)">FailureLogFormatter#getLogItems</a>
and configure CustomDataItem for placeholder <code class="docutils literal"><span class="pre">$data$</span></code>.</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomDataFailureLogFormatter</span> <span class="kd">extends</span> <span class="n">FailureLogFormatter</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">LogItem</span><span class="o">&lt;</span><span class="n">FailureLogContext</span><span class="o">&gt;&gt;</span> <span class="nf">getLogItems</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">props</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">LogItem</span><span class="o">&lt;</span><span class="n">FailureLogContext</span><span class="o">&gt;&gt;</span> <span class="n">logItems</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getLogItems</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>

        <span class="c1">// Overwrite by configuring $data$ with CustomDataItem.</span>
        <span class="n">logItems</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;$data$&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">CustomDataItem</span><span class="o">());</span>

        <span class="k">return</span> <span class="n">logItems</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CustomDataItem</span> <span class="kd">extends</span> <span class="n">DataItem</span> <span class="o">{</span>
        <span class="c1">// Omitted</span>
    <span class="o">}</span>
 <span class="o">}</span>
</pre></div>
</div>
</dd>
<dt>Configure such that a class that inherits <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/log/app/FailureLogFormatter.html" title="nablarch.core.log.app.FailureLogFormatter">FailureLogFormatter</a> is used</dt>
<dd><p class="first">Configure in <code class="docutils literal"><span class="pre">app-log.properties</span></code> such that CustomDataFailureLogFormatter is used as the formatter for failure log.</p>
<div class="last highlight-properties"><div class="highlight"><pre><span></span><span class="c"># Specify CustomDataFailureLogFormatter.</span>
<span class="na">failureLogFormatter.className</span><span class="o">=</span><span class="s">nablarch.core.log.app.CustomDataFailureLogFormatter</span>
<span class="na">failureLogFormatter.defaultFailureCode</span><span class="o">=</span><span class="s">UNEXPECTED_ERROR</span>
<span class="na">failureLogFormatter.defaultMessage</span><span class="o">=</span><span class="s">an unexpected exception occurred.</span>
<span class="na">failureLogFormatter.notificationFormat</span><span class="o">=</span><span class="s">fail_code = [$failureCode$] $message$</span>
<span class="na">failureLogFormatter.analysisFormat</span><span class="o">=</span><span class="s">fail_code = [$failureCode$] $message$\nInput Data :\n$data$</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
        <p>
            &copy; Copyright 2010-2021, TIS Inc.
        </p>
    </div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'5u20',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>