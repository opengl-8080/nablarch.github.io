


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv='content-language' content='ja'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.8. Transaction Management &mdash; ∇Nablarch  5u20 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  

  
  <link rel="canonical" href="https://nablarch.github.io/docs/LATEST/doc/application_framework/application_framework/libraries/transaction.html" />
  
    <link rel="top" title="∇Nablarch  5u20 documentation" href="../../../index.html"/>
        <link rel="up" title="7. Libraries Provided by Nablarch" href="index.html"/>
        <link rel="next" title="7.9. Static Data Cache" href="static_data_cache.html"/>
        <link rel="prev" title="7.7. Sending Emails" href="mail.html"/>
 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  
  <a href="../../../index.html" id="sidebar-title" class="icon"> ∇Nablarch 
  

  
    <div id="sidebar-version">Version: 5u20</div>
  </a>

  <div role="search">
    <form id="google-search-form" class="wy-form" method="get" action="https://www.google.co.jp/search">
      <input type="text" name="text" placeholder="Search docs on google" id="text"/>
      <input type="hidden" name="q" id="q"/>
    </form>
  </div>
    
    

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_nablarch/index.html">What is the Nablarch?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../about_nablarch/concept.html">Nablarch Concept</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../about_nablarch/concept.html#robustness">Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../about_nablarch/concept.html#testability">Testability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../about_nablarch/concept.html#ready-to-use">Ready-to-Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../about_nablarch/mvn_module.html">Module List of Nablarch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../about_nablarch/license.html">Information on Nablarch License</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Nablarch Application Framework</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Application Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../nablarch/index.html">1. What is Nablarch Application Framework?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../web/index.html">2. Web Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../web_service/index.html">3. Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../batch/index.html">4. Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../messaging/index.html">5. Messaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../handlers/index.html">6. Standard Handler Provided by Nablarch</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">7. Libraries Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../blank_project/index.html">8. Blank Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../setting_guide/index.html">9. Nablarch Application Framework Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration/index.html">10. Default Configuration List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cloud_native/index.html">11. Nablarch Cloud Native Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adaptors/index.html">Adaptor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/log_adaptor.html">log Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/router_adaptor.html">Routing Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/webspheremq_adaptor.html">IBM WebSphere MQ Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/jaxrs_adaptor.html">JAX-RS Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/doma_adaptor.html">Doma Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/jsr310_adaptor.html">JSR310(Date and Time API)Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/mail_sender_freemarker_adaptor.html">E-mail FreeMarker Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/mail_sender_thymeleaf_adaptor.html">E-mail Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/mail_sender_velocity_adaptor.html">E-mail Velocity Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/web_thymeleaf_adaptor.html">Web Application Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/lettuce_adaptor.html">Lettuce Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/slf4j_adaptor.html">SLF4J Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adaptors/micrometer_adaptor.html">Micrometer Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../example/index.html">Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../example/index.html#procedure-to-build-the-environment">Procedure to build the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../example/index.html#application-execution-procedure">Application execution procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../extension_components/index.html">Nablarch extension component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../extension_components/report/index.html">1. Form library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extension_components/workflow/doc/index.html">2. Workflow library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extension_components/workflow/tool/index.html">3. Workflow definition data generation tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extension_components/etl/index.html">4. ETL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extension_components/etl/etl_maven_plugin.html">5. ETL Maven plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_tools/index.html">Nablarch development tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../development_tools/java_static_analysis/index.html">1. Efficient Java Static Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../development_tools/java_static_analysis/index.html#conduct-syntax-check">1.1. Conduct syntax check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development_tools/java_static_analysis/index.html#unify-the-format">1.2. Unify the format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development_tools/java_static_analysis/index.html#check-if-unauthorized-apis-are-being-used">1.3. Check if unauthorized APIs are being used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../development_tools/ui_dev/index.html">2. Front-end UI development platform for advanced users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development_tools/testing_framework/index.html">3. Testing framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../development_tools/testing_framework/guide/development_guide/05_UnitTestGuide/index.html">3.1. How to Execute Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development_tools/testing_framework/guide/development_guide/06_TestFWGuide/index.html">3.2. How to Use the Automated Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development_tools/testing_framework/guide/development_guide/08_TestTools/index.html">3.3. Tools Used in the Programming Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../development_tools/toolbox/index.html">4. Useful Tools When Developing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../development_tools/toolbox/JspStaticAnalysis/index.html">4.1. JSP Static Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development_tools/toolbox/SqlExecutor/SqlExecutor.html">4.2. Nablarch SQL Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development_tools/toolbox/JspVerifier/JspVerifier.html">4.3. Job Screen JSP Validation Tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Nablarch Implementation Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/01/index.html">Sample Password Encryption Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/01/0101_PBKDF2PasswordEncryptor.html">Sample Password Encryption Function Using PBKDF2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/01/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/01/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/01/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/01/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/02/index.html">Extended Validation Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/02/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/02/index.html#email-address-validation">Email address validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/02/index.html#validation-of-japan-telephone-numbers">Validation of Japan telephone numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/02/index.html#code-value-validation">Code value validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/03/index.html">Display a List of Search Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#how-to-use">How to Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#listsearchinfo-class">ListSearchInfo class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#listsearchresult-tag">listSearchResult tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#sort-search-results">Sort search results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#how-to-implement-displaying-a-list-of-all-search-results-on-a-single-screen">How to implement displaying a list of all search results on a single screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#how-to-implement-the-initial-display-of-search-results-with-the-default-search-conditions">How to implement the initial display of search results with the default search conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#default-settings-for-the-search-result-list-display-function">Default settings for the search result list display function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#how-to-import-a-sample-implementation-tag-file-into-the-business-application">How to import a sample implementation (tag file) into the business application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/03/index.html#tag-reference">Tag Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/04/index.html">Extended Formatter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/04/0401_ExtendedDataFormatter.html">Data Formatter Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/04/0402_ExtendedFieldType.html">Field Type Expansion in the Data Formatter Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/05/index.html">Sample File Management Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/05/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/05/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/05/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/05/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/05/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/06/index.html">CAPTCHA Function Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/06/06_Captcha_guide.html">How to Incorporate the CAPTCHA Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/06/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/06/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/06/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/06/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/07/index.html">Sample UserAgent Information Acquisition Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/07/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/07/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/07/index.html#description-of-configuration">Description of configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/07/index.html#use-case">Use case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/08/index.html">Sample of HTML Email Send Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/08/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/08/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/08/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/08/index.html#implementation-examples">Implementation examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/09/index.html">How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/09/index.html#environment-preparation">Environment preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/09/index.html#structure-of-digitally-signed-email-send-function">Structure of digitally signed email send function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/09/index.html#preparation-of-configuration-file">Preparation of configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/09/index.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/10/index.html">How to Use the Log Aggregation Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/10/index.html#list-of-samples-provided">List of samples provided</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/11/index.html">Messaging Platform Test Simulator Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/11/index.html#uses">Uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/11/index.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/11/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/11/index.html#how-to-use">How to use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/11/index.html#expansion-example">Expansion example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../nablarch_api/index.html">Nablarch API</a></li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">∇Nablarch </a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Nablarch Application Framework</a> &raquo;</li>
      
          <li><a href="../index.html">Application Framework</a> &raquo;</li>
      
          <li><a href="index.html">7. Libraries Provided by Nablarch</a> &raquo;</li>
      
    <li>7.8. Transaction Management</li>
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/nablarch" class="fa fa-github">GitHub</a>
    </li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://nablarch.github.io/docs/LATEST/doc/index.html" class="ja">日本語</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="transaction-management">
<span id="transaction"></span><h1>7.8. Transaction Management<a class="headerlink" href="#transaction-management" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#function-overview" id="id1">Function overview</a><ul>
<li><a class="reference internal" href="#transaction-control-is-possible-for-various-resources" id="id2">Transaction control is possible for various resources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-list" id="id3">Module list</a></li>
<li><a class="reference internal" href="#how-to-use" id="id4">How to use</a><ul>
<li><a class="reference internal" href="#perform-transaction-control-for-the-database" id="id5">Perform transaction control for the database</a></li>
<li><a class="reference internal" href="#apply-transaction-timeout-for-the-database" id="id6">Apply transaction timeout for the database</a></li>
</ul>
</li>
<li><a class="reference internal" href="#expansion-example" id="id7">Expansion example</a><ul>
<li><a class="reference internal" href="#add-transaction-target-resource" id="id8">Add transaction target resource</a></li>
</ul>
</li>
</ul>
</div>
<p>Provides a transaction management function for resources (database and message queue) that require transaction control.</p>
<div class="section" id="function-overview">
<h2><a class="toc-backref" href="#id1">7.8.1. Function overview</a><a class="headerlink" href="#function-overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="transaction-control-is-possible-for-various-resources">
<h3><a class="toc-backref" href="#id2">7.8.1.1. Transaction control is possible for various resources</a><a class="headerlink" href="#transaction-control-is-possible-for-various-resources" title="Permalink to this headline">¶</a></h3>
<p>Transaction management is possible for resources such as databases and message queues that require transaction control.</p>
<p>Refer to the following for details of transaction control of database.</p>
<ul class="simple">
<li><a class="reference internal" href="#transaction-database"><span>Perform transaction control for the database</span></a></li>
<li><a class="reference internal" href="#transaction-timeout"><span>Apply transaction timeout for the database</span></a></li>
</ul>
<p>If there is a requirement for transaction control for a new resource, the control can be easily realized by implementing the interface defined by this function.
For details, see <a class="reference internal" href="#transaction-addresource"><span>Add transaction target resource</span></a>.</p>
</div>
</div>
<div class="section" id="module-list">
<h2><a class="toc-backref" href="#id3">7.8.2. Module list</a><a class="headerlink" href="#module-list" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.framework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-core-transaction<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.framework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-core-jdbc<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-use">
<h2><a class="toc-backref" href="#id4">7.8.3. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<div class="section" id="perform-transaction-control-for-the-database">
<span id="transaction-database"></span><h3><a class="toc-backref" href="#id5">7.8.3.1. Perform transaction control for the database</a><a class="headerlink" href="#perform-transaction-control-for-the-database" title="Permalink to this headline">¶</a></h3>
<p>Database transaction control can be realized by adding transaction control using JDBC to the component definition file.
It is assumed that the connection has been configured to the database.</p>
<p>For details on how to connect to the database, see <a class="reference internal" href="database/database.html#database-connect"><span>Connection configuration for the database</span></a>.</p>
<p>To use a small transaction such as 1 SQL unit, configure and implement referring to <a class="reference internal" href="database/database.html#database-new-transaction"><span>Execute SQL in a transaction different from the current transaction</span></a>.</p>
<dl class="docutils">
<dt>Example of component definition</dt>
<dd><p class="first">Define the factory class ( <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/db/transaction/JdbcTransactionFactory.html" title="nablarch.core.db.transaction.JdbcTransactionFactory">JdbcTransactionFactory</a> ), which generates transaction class for JDBC, in the component configuration file.</p>
<div class="last highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Configure JdbcTransactionFactory as a component --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.core.db.transaction.JdbcTransactionFactory&quot;</span><span class="nt">&gt;</span>

  <span class="c">&lt;!-- Isolation level --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;isolationLevel&quot;</span> <span class="na">value=</span><span class="s">&quot;READ_COMMITTED&quot;</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- Transaction timeout in seconds --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;transactionTimeoutSec&quot;</span> <span class="na">value=</span><span class="s">&quot;15&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</dd>
</dl>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Basically, the class configured above is not used directly.
If transaction control is required, use <a class="reference internal" href="../handlers/common/transaction_management_handler.html#transaction-management-handler"><span>Transaction Control Handler</span></a>.</p>
</div>
</div>
<div class="section" id="apply-transaction-timeout-for-the-database">
<span id="transaction-timeout"></span><h3><a class="toc-backref" href="#id6">7.8.3.2. Apply transaction timeout for the database</a><a class="headerlink" href="#apply-transaction-timeout-for-the-database" title="Permalink to this headline">¶</a></h3>
<p>The transaction timeout function is enabled by configuring the transaction timeout seconds for <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/db/transaction/JdbcTransactionFactory.html" title="nablarch.core.db.transaction.JdbcTransactionFactory">JdbcTransactionFactory</a>.
If the transaction timeout seconds is 0 or less, the transaction timeout function is disabled.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>For functions such as batch applications that process large amounts of data in bulk,
the processing delays are handled by monitoring the end delay of the job scheduler instead of using the transaction timeout function.</p>
<p class="last">This is because in batch applications, it is sufficient if the overall processing time is within the expected range, and there is no problem even if delays occur in individual transactions.
For example, even if a particular transaction takes 1 minute due to a lack of resources in the database, it is determined that there is no problem if the entire process is finished within the expected time.</p>
</div>
<dl class="docutils">
<dt>Start check timing of transaction timeout</dt>
<dd><p class="first">( <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/transaction/Transaction.html#begin--" title="nablarch.core.transaction.Transaction.begin()">Transaction#begin()</a> ) starts checking at the start of the transaction.</p>
<p class="last">Checks for timeouts for each transaction if multiple transactions are used
(for example, if another transaction is executed in a transaction).</p>
</dd>
<dt>Check timing of transaction timeout</dt>
<dd><p class="first">Checks if the transaction timeout seconds are exceeded at the following timing.</p>
<dl class="docutils">
<dt>Before executing the SQL</dt>
<dd><p class="first">Throws <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/transaction/TransactionTimeoutException.html" title="nablarch.core.transaction.TransactionTimeoutException">TransactionTimeoutException</a> if transaction timeout seconds are exceeded before executing the SQL.</p>
<p class="last">Checks before SQL execution because access to the database will result in unnecessary consumption of resources
if the transaction timeout seconds have already passed.</p>
</dd>
<dt>After executing the SQL</dt>
<dd><p class="first">Throws <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/transaction/TransactionTimeoutException.html" title="nablarch.core.transaction.TransactionTimeoutException">TransactionTimeoutException</a> if transaction timeout seconds are exceeded after executing SQL.</p>
<p class="last">Since the transaction timeout seconds may be exceeded during SQL execution or result set conversion,
a check is performed even if SQL execution is completed normally.</p>
</dd>
<dt>When a query timeout exception occurs</dt>
<dd><p class="first">Throws <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/transaction/TransactionTimeoutException.html" title="nablarch.core.transaction.TransactionTimeoutException">TransactionTimeoutException</a> if an exception that indicates a query timeout occurs and transaction timeout number of seconds has been exceeded.
Whether it is a query timeout exception is determined using the <a class="reference internal" href="database/database.html#database-dialect"><span>dialect</span></a> of the database function.</p>
<p>Control might not come back from the database if a SQL statement with a long processing time (simple slow SQL or SQL waiting for lock release) is executed.
Therefore, the number of seconds remaining in the transaction timeout is configured to <cite>java.sql.Statement#setQueryTimeout</cite>
and the execution is forced to be canceled when the transaction timeout seconds is exceeded.</p>
<p>If the query timeout time is configured when executing the SQL,
overwrites the configured query timeout time with the remaining transaction timeout seconds
when the remaining transaction timeout seconds is smaller than the configured query timeout time.</p>
<p>An example of handling query timeout is shown below.</p>
<dl class="last docutils">
<dt>Pattern 1</dt>
<dd><div class="first last line-block">
<div class="line">Configured query timeout time: 10 seconds</div>
<div class="line">Transaction timeout remaining seconds: 15 seconds</div>
<div class="line">Query timeout time configured when executing the SQL: 10 seconds</div>
<div class="line">Transaction timeout does not occur when query timeout occurs and SQL runtime exception is thrown</div>
</div>
</dd>
<dt>Pattern 2</dt>
<dd><div class="first last line-block">
<div class="line">Configured query timeout time: 10 seconds</div>
<div class="line">Transaction timeout remaining seconds: 5 seconds</div>
<div class="line">Query timeout time configured when executing the SQL: 5 seconds</div>
<div class="line">Transaction timeout occurs when query timeout occurs and <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/transaction/TransactionTimeoutException.html" title="nablarch.core.transaction.TransactionTimeoutException">TransactionTimeoutException</a> is thrown.</div>
</div>
</dd>
</dl>
</dd>
</dl>
<div class="last admonition tip">
<p class="first admonition-title">Tip</p>
<p>Since this function checks for transaction timeout when accessing a database,
it does not cause a transaction timeout when processing delay occurs in a logic that does not access the database.</p>
<p class="last">For example, if an infinite loop occurs in the logic that does not access the database, this function cannot detect the transaction timeout.
In such a case, delayed application threads are handled using the application server timeout function, etc.</p>
</div>
</dd>
<dt>Reset timing of transaction timeout time</dt>
<dd>The transaction timeout period is reset when a transaction is explicitly started ( when <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/transaction/Transaction.html#begin--" title="nablarch.core.transaction.Transaction.begin()">Transaction#begin</a> is called).
Note that at the end of the transaction ( <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/transaction/Transaction.html#commit--" title="nablarch.core.transaction.Transaction.commit()">Transaction#commit</a> and  <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/transaction/Transaction.html#rollback--" title="nablarch.core.transaction.Transaction.rollback()">Transaction#rollback</a> ),
the remaining time of transaction timeout is not reset.</dd>
</dl>
</div>
</div>
<div class="section" id="expansion-example">
<h2><a class="toc-backref" href="#id7">7.8.4. Expansion example</a><a class="headerlink" href="#expansion-example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add-transaction-target-resource">
<span id="transaction-addresource"></span><h3><a class="toc-backref" href="#id8">7.8.4.1. Add transaction target resource</a><a class="headerlink" href="#add-transaction-target-resource" title="Permalink to this headline">¶</a></h3>
<p>The following steps are required to add transaction target resource.</p>
<p>For example, this applies when performing transaction control using IBM WebSphere MQ as a transaction manager for distributed transactions.</p>
<ol class="arabic simple">
<li>Add transaction implementation</li>
<li>Add a factory implementation to generate a transaction</li>
<li>Realize transaction control using <a class="reference internal" href="../handlers/common/transaction_management_handler.html#transaction-management-handler"><span>Transaction Control Handler</span></a></li>
</ol>
<p>The detailed procedure is shown below.</p>
<dl class="docutils">
<dt>Add transaction implementation</dt>
<dd><p class="first">Transaction implements the <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/transaction/Transaction.html" title="nablarch.core.transaction.Transaction">Transaction</a> interface and implements
transaction begin/end process for the transaction target resource.</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleTransaction</span> <span class="kd">implements</span> <span class="n">Transaction</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">resourceName</span><span class="o">;</span>

  <span class="c1">// Receive the resource name for identifying</span>
  <span class="c1">// the transaction control target resource.</span>
  <span class="c1">// During transaction control, the resource for transaction control must be acquired</span>
  <span class="c1">// from this resource name.</span>
  <span class="kd">public</span> <span class="nf">SampleTransaction</span><span class="o">(</span><span class="n">String</span> <span class="n">resourceName</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">resourceName</span> <span class="o">=</span> <span class="n">resourceName</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">begin</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Implement the transaction start process for the transaction target resource</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">commit</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Implement the transaction confirmation process for the transaction target resource</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rollback</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Implement the transaction discard process for the transaction target resource</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</dd>
<dt>Add a factory implementation to generate a transaction</dt>
<dd><p class="first">Create a factory class to generate a transaction.
Implement <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/core/transaction/TransactionFactory.html" title="nablarch.core.transaction.TransactionFactory">TransactionFactory</a> for the factory class.</p>
<p>This example is a factory class that generates the <cite>SampleTransaction</cite> created above.</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleTransactionFactory</span> <span class="kd">implements</span> <span class="n">TransactionFactory</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Transaction</span> <span class="nf">getTransaction</span><span class="o">(</span><span class="n">String</span> <span class="n">resourceName</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Hold a resource name to identify the transaction target</span>
    <span class="c1">// Create and return a transaction object.</span>
    <span class="n">SampleTransaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleTransaction</span><span class="o">(</span><span class="n">resourceName</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">transaction</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</dd>
<dt>Realize transaction control using <a class="reference internal" href="../handlers/common/transaction_management_handler.html#transaction-management-handler"><span>Transaction Control Handler</span></a></dt>
<dd><p class="first">Transaction control can be achieved by using the transaction control handler included in the standard handler of Nablarch.</p>
<p>Configure the added factory class to the transaction control handler, as in the following example.</p>
<div class="last highlight-xml"><div class="highlight"><pre><span></span> <span class="c">&lt;!-- Transaction control handler --&gt;</span>
 <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.handler.TransactionManagementHandler&quot;</span><span class="nt">&gt;</span>

   <span class="c">&lt;!-- Transaction factory --&gt;</span>
   <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;transactionFactory&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;sample.SampleTransactionFactory&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;/property&gt;</span>

<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
        <p>
            &copy; Copyright 2010-2021, TIS Inc.
        </p>
    </div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'5u20',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>