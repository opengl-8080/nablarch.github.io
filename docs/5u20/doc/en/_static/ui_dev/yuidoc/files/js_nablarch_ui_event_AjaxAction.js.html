<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js\nablarch\ui\event\AjaxAction.js - Nablarch JavaScript Widget</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Nablarch JavaScript Widget"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/jQuery.html">jQuery</a></li>
            
                <li><a href="../classes/nablarch.ui.html">nablarch.ui</a></li>
            
                <li><a href="../classes/nablarch.ui.AutoSpan.html">nablarch.ui.AutoSpan</a></li>
            
                <li><a href="../classes/nablarch.ui.AutoSum.html">nablarch.ui.AutoSum</a></li>
            
                <li><a href="../classes/nablarch.ui.Collapsible.html">nablarch.ui.Collapsible</a></li>
            
                <li><a href="../classes/nablarch.ui.ContextMenu.html">nablarch.ui.ContextMenu</a></li>
            
                <li><a href="../classes/nablarch.ui.DatePicker.html">nablarch.ui.DatePicker</a></li>
            
                <li><a href="../classes/nablarch.ui.event.AjaxAction.html">nablarch.ui.event.AjaxAction</a></li>
            
                <li><a href="../classes/nablarch.ui.event.Listener.html">nablarch.ui.event.Listener</a></li>
            
                <li><a href="../classes/nablarch.ui.event.ShowDialog.html">nablarch.ui.event.ShowDialog</a></li>
            
                <li><a href="../classes/nablarch.ui.event.SubWindowListener.html">nablarch.ui.event.SubWindowListener</a></li>
            
                <li><a href="../classes/nablarch.ui.event.ToggleAction.html">nablarch.ui.event.ToggleAction</a></li>
            
                <li><a href="../classes/nablarch.ui.event.WindowClose.html">nablarch.ui.event.WindowClose</a></li>
            
                <li><a href="../classes/nablarch.ui.event.WriteAction.html">nablarch.ui.event.WriteAction</a></li>
            
                <li><a href="../classes/nablarch.ui.LightBox.html">nablarch.ui.LightBox</a></li>
            
                <li><a href="../classes/nablarch.ui.ListBuilder.html">nablarch.ui.ListBuilder</a></li>
            
                <li><a href="../classes/nablarch.ui.selector.html">nablarch.ui.selector</a></li>
            
                <li><a href="../classes/nablarch.ui.Tab.html">nablarch.ui.Tab</a></li>
            
                <li><a href="../classes/nablarch.ui.TabindexOrder.html">nablarch.ui.TabindexOrder</a></li>
            
                <li><a href="../classes/nablarch.ui.TabLink.html">nablarch.ui.TabLink</a></li>
            
                <li><a href="../classes/nablarch.ui.ToggleCheckbox.html">nablarch.ui.ToggleCheckbox</a></li>
            
                <li><a href="../classes/nablarch.ui.Tooltip.html">nablarch.ui.Tooltip</a></li>
            
                <li><a href="../classes/nablarch.ui.TreeList.html">nablarch.ui.TreeList</a></li>
            
                <li><a href="../classes/nablarch.ui.TreeMenu.html">nablarch.ui.TreeMenu</a></li>
            
                <li><a href="../classes/nablarch.ui.Widget.html">nablarch.ui.Widget</a></li>
            
                <li><a href="../classes/nablarch.util.BigDecimal.html">nablarch.util.BigDecimal</a></li>
            
                <li><a href="../classes/nablarch.util.BigDecimal.NaN.html">nablarch.util.BigDecimal.NaN</a></li>
            
                <li><a href="../classes/nablarch.util.Consumer.html">nablarch.util.Consumer</a></li>
            
                <li><a href="../classes/nablarch.util.DateUtil.html">nablarch.util.DateUtil</a></li>
            
                <li><a href="../classes/nablarch.util.SimpleDateFormat.html">nablarch.util.SimpleDateFormat</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/devtool.html">devtool</a></li>
            
                <li><a href="../modules/nablarch.ui.html">nablarch.ui</a></li>
            
                <li><a href="../modules/nablarch.util.html">nablarch.util</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js\nablarch\ui\event\AjaxAction.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define([&#x27;jquery&#x27;, &#x27;./Listener&#x27;, &#x27;sugar&#x27;],
function($, Listener) { &quot;use strict&quot;;
  /**
   * Ajaxリクエスト送信アクション
   * =============================================
   * Ajaxリクエストを送信するイベントアクション。
   *
   * Nablarch本体の機構(ウィンドウスコープ/Nablarch サブミット等)
   * と連動し、&lt;n:button&gt;、&lt;n:subimitLink&gt; を使用した場合と同じPOSTリクエストを
   * 送信することができる。
   * また、&lt;n:param&gt; を用いたリクエストパラメータの付与も可能となっている。
   *
   * @class nablarch.ui.event.AjaxAction
   * @author Iwauo Tajima
   * @since 1.4
   */
  AjaxAction.prototype = {
    /**
     * コンストラクタ。
     * @constructor
     * @param {Object} opts このアクションに設定するプロパティ。
     *   **name:**           サブミット名(必須指定)
     *   **uri:**            送信対象URI(必須指定)
     *   **target:**         レスポンスされたページ内で取得対象とするノードを指定するセレクタ式。
     *   **condition:**      リクエスト送信を実行する際に満たすべき条件を表すセレクタ式。
     *   **paramNameAlias:** リクエストを送信する際に、リクエストパラメータの置換を行うルールを定義する。
     *                       置換ルールの書式は以下のとおり。
     *
     *      【置換対象文字列1】/【置換後文字列1】|【置換対象文字列2】/【置換後文字列2】| ..
     */
    constructor: AjaxAction
    /**
     * サブミット名(必須指定)
     * @property name
     * @type String
     */
  , name: null
    /**
     * 検索対象URI(必須指定)
     * @property uri
     * @type String
     */
  , uri: null
    /**
     * レスポンスされたページ内で取得対象とするノードを指定するセレクタ式。
     */
  , target: null
    /**
     * リクエスト送信を実行する際に満たすべき条件を表すセレクタ式。
     * @property condtion
     * @type String
     */
  , condition: null
    /**
     * リクエストを送信する際に、リクエストパラメータの置換を行うルールを定義する。
     * 置換ルールの書式は以下のとおり。
     *
     *    【置換対象文字列1】/【置換後文字列1】|【置換対象文字列2】/【置換後文字列2】| ..
     *
     * 共通画面への遷移を行う場合に、ウィンドウプレフィックスの置き換えを行う場合など
     * に使用する。
     *
     * @property paramNameAlias
     * @type String
     */
  , paramNameAlias: null
    /**
     * このアクションがリスナからコールバックされた場合に実行する処理。
     * プロパティの設定内容に従って、XHRリクエストを送信する。
     * @method fire
     * @param {nablarch.ui.event.Listener} このアクションを呼び出したリスナ
     * @param {jQuery.Event} リスナが捕捉したイベントオブジェクト
     */
  , fire: AjaxAction_sendRequest
    /**
     * 初期化処理後にリスナからコールバックされた場合に実行する処理。
     * fireコールバックと同等のXHRリクエストを送信する。
     * @method fire
     * @param {nablarch.ui.event.Listener} このアクションを呼び出したリスナ
     * @param {jQuery.Event} リスナが捕捉したイベントオブジェクト
     */
  , init: AjaxAction_sendRequest
  };

  function AjaxAction(opts) {
    this.constructor = AjaxAction;
    Object.merge(this, opts);
    // IE8,9 XHR.open bug if url has double byte.
    this.uri = this.uri.escapeURL();
  }

  function AjaxAction_sendRequest(listener, event) {
    if (this.condition &amp;&amp; !listener.$watchTarget.find(this.condition).length) {
      return;
    }
    var target      = this.target
      , $form       = listener.$context.closest(&#x27;form&#x27;)
      , $submitName = $form
                     .find(&#x27;input[name=&quot;nablarch_submit&quot;]&#x27;)
                     .val(this.name) //サブミット名を設定する(nablarch本体との連動に必要)
      , queryString = $form.serialize()
      , nameAlias   = this.paramNameAlias;

    if (nameAlias) {
      nameAlias.split(&#x27;|&#x27;).each(function(replace) {
        var pattern = replace.split(&#x27;/&#x27;);
        queryString = queryString.replace(/(^|&amp;)([^=]+)=(.*?)(?=(&amp;|$))/g,
          function(org, head, name, value) {
            var replaced = name.replace(pattern[0], pattern[1]);
            if (replaced === name) {
              return org;
            }
            return [
              head, name,     &#x27;=&#x27;, value
            , &#x27;&amp;&#x27;,  replaced, &#x27;=&#x27;, value
            ].join(&#x27;&#x27;);
          }
        );
      });
    }

    $.ajax({
      type     : &#x27;POST&#x27;
    , url      : this.uri
    , dataType : &#x27;html&#x27;
    , data     : queryString
    , complete : function(xhr) {
        var html      = xhr.responseText
          , eventName = (xhr.status &lt;= 400)
                      ? &#x27;ajaxSuccess&#x27;
                      : &#x27;ajaxError&#x27;;
        listener.$context.trigger(eventName, [$(html).find(target)][0]);
      }
    });
  }
  Listener.register(&#x27;Ajax&#x27;, AjaxAction);
  return AjaxAction;
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
