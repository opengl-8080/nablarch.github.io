<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>nablarch-js-util-bigdecimal\ui_public\js\nablarch\util\BigDecimal.js - Nablarch JavaScript Widget</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Nablarch JavaScript Widget"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/jQuery.html">jQuery</a></li>
            
                <li><a href="../classes/jsp.html">jsp</a></li>
            
                <li><a href="../classes/jsp.taglib.box.html">jsp.taglib.box</a></li>
            
                <li><a href="../classes/jsp.taglib.button.html">jsp.taglib.button</a></li>
            
                <li><a href="../classes/jsp.taglib.column.html">jsp.taglib.column</a></li>
            
                <li><a href="../classes/jsp.taglib.device.html">jsp.taglib.device</a></li>
            
                <li><a href="../classes/jsp.taglib.function.html">jsp.taglib.function</a></li>
            
                <li><a href="../classes/jsp.taglib.html.html">jsp.taglib.html</a></li>
            
                <li><a href="../classes/jsp.taglib.jsp.html">jsp.taglib.jsp</a></li>
            
                <li><a href="../classes/jsp.taglib.jstl.html">jsp.taglib.jstl</a></li>
            
                <li><a href="../classes/jsp.taglib.layout.html">jsp.taglib.layout</a></li>
            
                <li><a href="../classes/jsp.taglib.listsearchresult.html">jsp.taglib.listsearchresult</a></li>
            
                <li><a href="../classes/jsp.taglib.nablarch.html">jsp.taglib.nablarch</a></li>
            
                <li><a href="../classes/jsp.taglib.tab.html">jsp.taglib.tab</a></li>
            
                <li><a href="../classes/jsp.taglib.table.html">jsp.taglib.table</a></li>
            
                <li><a href="../classes/jsp.taglib.template.html">jsp.taglib.template</a></li>
            
                <li><a href="../classes/nablarch.ui.html">nablarch.ui</a></li>
            
                <li><a href="../classes/nablarch.ui.AutoSpan.html">nablarch.ui.AutoSpan</a></li>
            
                <li><a href="../classes/nablarch.ui.AutoSum.html">nablarch.ui.AutoSum</a></li>
            
                <li><a href="../classes/nablarch.ui.Collapsible.html">nablarch.ui.Collapsible</a></li>
            
                <li><a href="../classes/nablarch.ui.ContextMenu.html">nablarch.ui.ContextMenu</a></li>
            
                <li><a href="../classes/nablarch.ui.DatePicker.html">nablarch.ui.DatePicker</a></li>
            
                <li><a href="../classes/nablarch.ui.event.AjaxAction.html">nablarch.ui.event.AjaxAction</a></li>
            
                <li><a href="../classes/nablarch.ui.event.Listener.html">nablarch.ui.event.Listener</a></li>
            
                <li><a href="../classes/nablarch.ui.event.ShowDialog.html">nablarch.ui.event.ShowDialog</a></li>
            
                <li><a href="../classes/nablarch.ui.event.SubWindowListener.html">nablarch.ui.event.SubWindowListener</a></li>
            
                <li><a href="../classes/nablarch.ui.event.ToggleAction.html">nablarch.ui.event.ToggleAction</a></li>
            
                <li><a href="../classes/nablarch.ui.event.WindowClose.html">nablarch.ui.event.WindowClose</a></li>
            
                <li><a href="../classes/nablarch.ui.event.WriteAction.html">nablarch.ui.event.WriteAction</a></li>
            
                <li><a href="../classes/nablarch.ui.LightBox.html">nablarch.ui.LightBox</a></li>
            
                <li><a href="../classes/nablarch.ui.ListBuilder.html">nablarch.ui.ListBuilder</a></li>
            
                <li><a href="../classes/nablarch.ui.selector.html">nablarch.ui.selector</a></li>
            
                <li><a href="../classes/nablarch.ui.SlideMenu.html">nablarch.ui.SlideMenu</a></li>
            
                <li><a href="../classes/nablarch.ui.Tab.html">nablarch.ui.Tab</a></li>
            
                <li><a href="../classes/nablarch.ui.TabindexOrder.html">nablarch.ui.TabindexOrder</a></li>
            
                <li><a href="../classes/nablarch.ui.TabLink.html">nablarch.ui.TabLink</a></li>
            
                <li><a href="../classes/nablarch.ui.ToggleCheckbox.html">nablarch.ui.ToggleCheckbox</a></li>
            
                <li><a href="../classes/nablarch.ui.Tooltip.html">nablarch.ui.Tooltip</a></li>
            
                <li><a href="../classes/nablarch.ui.TreeList.html">nablarch.ui.TreeList</a></li>
            
                <li><a href="../classes/nablarch.ui.TreeMenu.html">nablarch.ui.TreeMenu</a></li>
            
                <li><a href="../classes/nablarch.ui.Widget.html">nablarch.ui.Widget</a></li>
            
                <li><a href="../classes/nablarch.util.BigDecimal.html">nablarch.util.BigDecimal</a></li>
            
                <li><a href="../classes/nablarch.util.BigDecimal.NaN.html">nablarch.util.BigDecimal.NaN</a></li>
            
                <li><a href="../classes/nablarch.util.Consumer.html">nablarch.util.Consumer</a></li>
            
                <li><a href="../classes/nablarch.util.DateUtil.html">nablarch.util.DateUtil</a></li>
            
                <li><a href="../classes/nablarch.util.SimpleDateFormat.html">nablarch.util.SimpleDateFormat</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/devtool.html">devtool</a></li>
            
                <li><a href="../modules/jsp.html">jsp</a></li>
            
                <li><a href="../modules/jsp.taglib.html">jsp.taglib</a></li>
            
                <li><a href="../modules/nablarch.ui.html">nablarch.ui</a></li>
            
                <li><a href="../modules/nablarch.ui.device.html">nablarch.ui.device</a></li>
            
                <li><a href="../modules/nablarch.util.html">nablarch.util</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: nablarch-js-util-bigdecimal\ui_public\js\nablarch\util\BigDecimal.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * @module nablarch.util
 */
define(function () {

  &quot;use strict&quot;;
  
  function BigDecimal(value, /* option */ scale) {
    if (overflow(value)) {
      return BigDecimal.NaN;
    }

    // 非数値の場合は、BigDecimal.NaNとする
    if (!isNumber(value)) {
      return BigDecimal.NaN;
    }

    /** 文字列に変換した値 */
    this._value = value.toString();

    /** スケール(スケールが指定されない場合は、値を元に導出する) */
    this._scale = isNumber(scale) ? Math.floor(scale) : getScale(this._value);
  }

  /**
   * Javascriptによる簡易BigDecimal実装
   * ------------------------------------
   * 
   * **許容される10進桁数**  
   * javascriptの数値(number)は全て浮動小数点によって内部的に保持される。
   * このBigDecimalの実装では、数値部分をjavascriptのnumberとして保持するので、
   * 数値部分の計算で浮動小数の実数部の最大値(=2^53)を超過すると精度が下がり、
   * 計算結果がずれる。
   * 
   * このため、計算結果の数値部分が一定の桁数を越えた場合はNaNを返す。
   * log(2^53) = 15.95 なので、デフォルトの設定値では10^15未満の数(15桁の)数を許容する。
   * 
   * @class nablarch.util.BigDecimal
   * @author Hisaaki Sioiri
   * @since 1.2
   */
  BigDecimal.prototype = {
    /**
     * コンストラクタ。
     * @param {Number} value 値。(数値以外の値が指定された場合はNaNに変換する。)
     * @param {Number} scale スケール(数値以外の値が指定された場合は、0に変換する。)
     * @constructor
     */  
    constructor: BigDecimal,
    /**
     * 加算を行う。
     * 
     * @method add
     * @param {Number|String} value 加算する値
     * @param {Number|String} [scale] 加算後のスケール  
     * (未指定の場合は、このオブジェクトのスケールとaddValueのスケールの大きいスケールが適用される。)
     * @return {BigDecimal} 加算後の値
     */    
    add:BigDecimal_add,
    /**
     * 減算を行う。
     * @method subtract
     * @param {Number|String} value 減算する値
     * @param {Number|String} [scale] 減算後のスケール  
     * (未指定の場合は、このオブジェクトのスケールとaddValueのスケールの大きいスケールが適用される。)
     * @return {BigDecimal} 減算後の値
     */
    subtract:BigDecimal_subtract,
    /**
     * 乗算を行う。
     * @method multiply
     * @param {Number|String} value 乗算する値
     * @param {Number|String} [scale] 乗算後のスケール  
     * (未指定の場合は、このオブジェクトのスケールとaddValueのスケールの大きいスケールが適用される。)
     * @return {BigDecimal} 乗算後の値
     */
    multiply:BigDecimal_multiply,
    /**
     * 文字列に変換する。
     * @method toString
     * @return {String} 変換後の文字列
     */    
    toString:BigDecimal_toString,
    /**
     * 数値に変換する。
     * @method toNumber
     * @return {Number} 変換後の数値
     */
    toNumber:BigDecimal_toNumber
  };
  
  /**
   * 最大数値
   * @property maxDigit
   * @static
   * @final
   */
  BigDecimal.maxDigit =  1000 * 1000 * 1000 * 1000 * 1000 - 1; // 最大数値
  
  /**
   * 最小数値
   * @property minDigit
   * @static
   * @final
   */  
  BigDecimal.minDigit = -1000 * 1000 * 1000 * 1000 * 1000 + 1; // 最小数値
  
  function overflow(digit) {
    if (typeof digit === &quot;string&quot;) {
      digit = toInteger(digit);
    }
    return (digit &gt; BigDecimal.maxDigit)
        || (digit &lt; BigDecimal.minDigit);
  }
  
  /**
   *  Not A Number
   *  @class nablarch.util.BigDecimal.NaN
   *  @final
   *  @for nablarch.util.BigDecimal
   */
  BigDecimal.NaN = new BigDecimal(0,0);
  BigDecimal.NaN.add = function() {return this;};
  BigDecimal.NaN.subtract = function() {return this;};
  BigDecimal.NaN.multiply = function() {return this;};
  BigDecimal.NaN.toString = function() {return &quot;NaN&quot;;};
  BigDecimal.NaN.toNumber = function() {return Number.NaN;};
  
  return BigDecimal;

  function BigDecimal_add(value, /* option */ scale) {
    return expression(this, value, scale,
        function (v1, v2) {
          return v1 + v2;
        },
        function (scale) {
          return scale;
        });
  }

  function BigDecimal_subtract(value, /* option */ scale) {
    return expression(this, value, scale,
        function (v1, v2) {
          return v1 - v2;
        },
        function (scale) {
          return scale;
        });
  }

  function BigDecimal_multiply(value, /* option */ scale) {
    return expression(this, value, scale,
        function (v1, v2) {
          return v1 * v2;
        }, function (scale) {
          return scale * 2;
        });
  }

  function BigDecimal_toString() {
    var str = this._value,
    sign = &quot;&quot;;
    if (str.substring(0,1) === &quot;-&quot;){
      str = str.substring(1);
      if (str.match(/[^0.]/)){
        sign = &quot;-&quot;;
      }
    }
    var split = str.split(&quot;.&quot;);
    split[0] = split[0].length == 0 ? &quot;0&quot; : split[0];
    if (this._scale === 0) {
      return sign + split[0];
    } else if (split.length === 1) {
      return sign + split[0] + &quot;.&quot; + addZero(&quot;&quot;, this._scale);
    } else if (split[1].length &lt; this._scale) {
      return sign + split[0] + &quot;.&quot; + addZero(split[1], this._scale);
    } else {
      return sign + split[0] + &quot;.&quot; + split[1].substring(0, this._scale);
    }
  }

  function BigDecimal_toNumber() {
    return Number(this.toString());
  }

  /**
   * 計算を行う。
   * @param value1 計算対象の値1
   * @param value2 計算対象の値2
   * @param scale 計算時のスケール
   * @param expressionInner 計算処理を行う関数
   * @return {BigDecimal} 計算後の値
   */
  function expression(value1, value2, scale, expressionInner, newScale) {
    var thisNumber,
        addNumber,
        maxScale,
        resultNumber;

    if (!(value2 instanceof BigDecimal)) {
      value2 = new BigDecimal(value2);
    }

    if (value2 === BigDecimal.NaN) {
      return BigDecimal.NaN;
    }
    maxScale = Math.max(value1._scale, value2._scale);
    thisNumber   = toInteger(value1._value, maxScale);
    addNumber    = toInteger(value2._value, maxScale);
    if (overflow(thisNumber) || overflow(addNumber)) {
      return BigDecimal.NaN;
    }
    resultNumber = expressionInner(thisNumber, addNumber);
    if (overflow(resultNumber)) {
      return BigDecimal.NaN;
    }
    return new BigDecimal(toBigDecimalString(resultNumber, newScale(maxScale)),
        isNumber(scale) ? scale : maxScale);
  }

  /**
   * 文字列値からスケールを導出する。
   * @param value 値
   * @return {Number} スケール
   */
  function getScale(value) {
    if (value.indexOf(&quot;.&quot;) === -1) {
      return 0;
    }
    return value.split(&quot;.&quot;)[1].length;
  }

  /**
   * スケール分桁をずらした数値に変換する。
   * @param value 値
   * @param scale スケール
   * @return {Number} 変換後の値
   */
  function toInteger(value, scale) {
    var split = value.split(&quot;.&quot;);
    if (split.length === 1) {
      return Number(value + addZero(&quot;&quot;, scale));
    }
    if (split[1].length &gt;= scale) {
      return Number(split[0] + split[1].substring(0, scale));
    } else {
      return Number(split[0] + addZero(split[1], scale));
    }
  }

  /**
   * 指定されたスケールを持つ数値文字列に変換する。
   * 
   * 数値部が BigDecimal.maxDigit を超過した場合は&quot;NaN&quot; を返す。
   * 
   * @param value 値
   * @param scale スケール
   * @return {String}
   */
  function toBigDecimalString(value, scale) {
    var str = value.toString();
    if (scale === 0) {
      return str;
    }
    var sign = &quot;&quot;;
    if (str.substring(0,1) === &quot;-&quot;){
      str = str.substring(1);
      if (str !== &quot;0&quot;){
        sign = &quot;-&quot;;
      }
    }
    if (str.length &lt;= scale){
      str = addZero(&quot;&quot;, scale - str.length + 1) + str;
    }
    return sign + str.substring(0, str.length - scale) + &quot;.&quot; + str.substring(str.length - scale);
  }

  /**
   * 指定した長さになるように末尾に「0」を付加する。
   * @param value 値
   * @param length 長さ
   * @return {String} 指定された長さの値
   */
  function addZero(value, length) {
    var i,
        ret = value;
    for (i = ret.length; i &lt; length; i += 1) {
      ret += &quot;0&quot;;
    }
    return ret;
  }

  /**
   * 指定した値が数値か否か。
   * @param value 値
   * @return {Boolean} 数値の場合は、true
   */
  function isNumber(value) {
    if (value === undefined) {
      return false;
    }
    if (value.toString().length === 0) {
      return false;
    }
    return !isNaN(value);
  }
});


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
