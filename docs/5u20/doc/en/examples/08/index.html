


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv='content-language' content='ja'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sample of HTML Email Send Function &mdash; ∇Nablarch  5u20 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  

  
  <link rel="canonical" href="https://nablarch.github.io/docs/LATEST/doc/examples/08/index.html" />
  
    <link rel="top" title="∇Nablarch  5u20 documentation" href="../../index.html"/>
        <link rel="up" title="Nablarch Implementation Examples" href="../index.html"/>
        <link rel="next" title="How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle" href="../09/index.html"/>
        <link rel="prev" title="Configuration Sample of UserAgent Information Acquisition Function" href="../07/useragent_sample.html"/>
 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  
  <a href="../../index.html" id="sidebar-title" class="icon"> ∇Nablarch 
  

  
    <div id="sidebar-version">Version: 5u20</div>
  </a>

  <div role="search">
    <form id="google-search-form" class="wy-form" method="get" action="https://www.google.co.jp/search">
      <input type="text" name="text" placeholder="Search docs on google" id="text"/>
      <input type="hidden" name="q" id="q"/>
    </form>
  </div>
    
    

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_nablarch/index.html">What is the Nablarch?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/concept.html">Nablarch Concept</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#robustness">Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#testability">Testability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../about_nablarch/concept.html#ready-to-use">Ready-to-Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/mvn_module.html">Module List of Nablarch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about_nablarch/license.html">Information on Nablarch License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../application_framework/index.html">Nablarch Application Framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../application_framework/application_framework/index.html">Application Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/nablarch/index.html">1. What is Nablarch Application Framework?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/web/index.html">2. Web Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/web_service/index.html">3. Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/batch/index.html">4. Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/messaging/index.html">5. Messaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/handlers/index.html">6. Standard Handler Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/libraries/index.html">7. Libraries Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/blank_project/index.html">8. Blank Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/setting_guide/index.html">9. Nablarch Application Framework Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/configuration/index.html">10. Default Configuration List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/application_framework/cloud_native/index.html">11. Nablarch Cloud Native Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../application_framework/adaptors/index.html">Adaptor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/log_adaptor.html">log Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/router_adaptor.html">Routing Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/webspheremq_adaptor.html">IBM WebSphere MQ Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/jaxrs_adaptor.html">JAX-RS Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/doma_adaptor.html">Doma Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/jsr310_adaptor.html">JSR310(Date and Time API)Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/mail_sender_freemarker_adaptor.html">E-mail FreeMarker Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/mail_sender_thymeleaf_adaptor.html">E-mail Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/mail_sender_velocity_adaptor.html">E-mail Velocity Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/web_thymeleaf_adaptor.html">Web Application Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/lettuce_adaptor.html">Lettuce Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/slf4j_adaptor.html">SLF4J Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/adaptors/micrometer_adaptor.html">Micrometer Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../application_framework/example/index.html">Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/example/index.html#procedure-to-build-the-environment">Procedure to build the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../application_framework/example/index.html#application-execution-procedure">Application execution procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../extension_components/index.html">Nablarch extension component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../extension_components/report/index.html">1. Form library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extension_components/workflow/doc/index.html">2. Workflow library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extension_components/workflow/tool/index.html">3. Workflow definition data generation tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extension_components/etl/index.html">4. ETL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../extension_components/etl/etl_maven_plugin.html">5. ETL Maven plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development_tools/index.html">Nablarch development tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html">1. Efficient Java Static Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#conduct-syntax-check">1.1. Conduct syntax check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#unify-the-format">1.2. Unify the format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/java_static_analysis/index.html#check-if-unauthorized-apis-are-being-used">1.3. Check if unauthorized APIs are being used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/ui_dev/index.html">2. Front-end UI development platform for advanced users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/testing_framework/index.html">3. Testing framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/05_UnitTestGuide/index.html">3.1. How to Execute Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/06_TestFWGuide/index.html">3.2. How to Use the Automated Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/testing_framework/guide/development_guide/08_TestTools/index.html">3.3. Tools Used in the Programming Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../development_tools/toolbox/index.html">4. Useful Tools When Developing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/toolbox/JspStaticAnalysis/index.html">4.1. JSP Static Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/toolbox/SqlExecutor/SqlExecutor.html">4.2. Nablarch SQL Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../development_tools/toolbox/JspVerifier/JspVerifier.html">4.3. Job Screen JSP Validation Tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Nablarch Implementation Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01/index.html">Sample Password Encryption Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../01/0101_PBKDF2PasswordEncryptor.html">Sample Password Encryption Function Using PBKDF2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../02/index.html">Extended Validation Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../02/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02/index.html#email-address-validation">Email address validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02/index.html#validation-of-japan-telephone-numbers">Validation of Japan telephone numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02/index.html#code-value-validation">Code value validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../03/index.html">Display a List of Search Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#how-to-use">How to Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#listsearchinfo-class">ListSearchInfo class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#listsearchresult-tag">listSearchResult tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#sort-search-results">Sort search results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#how-to-implement-displaying-a-list-of-all-search-results-on-a-single-screen">How to implement displaying a list of all search results on a single screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#how-to-implement-the-initial-display-of-search-results-with-the-default-search-conditions">How to implement the initial display of search results with the default search conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#default-settings-for-the-search-result-list-display-function">Default settings for the search result list display function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#how-to-import-a-sample-implementation-tag-file-into-the-business-application">How to import a sample implementation (tag file) into the business application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03/index.html#tag-reference">Tag Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../04/index.html">Extended Formatter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../04/0401_ExtendedDataFormatter.html">Data Formatter Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../04/0402_ExtendedFieldType.html">Field Type Expansion in the Data Formatter Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../05/index.html">Sample File Management Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../05/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../05/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../05/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../05/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../05/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../06/index.html">CAPTCHA Function Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../06/06_Captcha_guide.html">How to Incorporate the CAPTCHA Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../07/index.html">Sample UserAgent Information Acquisition Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../07/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../07/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../07/index.html#description-of-configuration">Description of configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../07/index.html#use-case">Use case</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Sample of HTML Email Send Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation-examples">Implementation examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../09/index.html">How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../09/index.html#environment-preparation">Environment preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../09/index.html#structure-of-digitally-signed-email-send-function">Structure of digitally signed email send function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../09/index.html#preparation-of-configuration-file">Preparation of configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../09/index.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../10/index.html">How to Use the Log Aggregation Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../10/index.html#list-of-samples-provided">List of samples provided</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../11/index.html">Messaging Platform Test Simulator Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../11/index.html#uses">Uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../11/index.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../11/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../11/index.html#how-to-use">How to use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../11/index.html#expansion-example">Expansion example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../nablarch_api/index.html">Nablarch API</a></li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">∇Nablarch </a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Nablarch Implementation Examples</a> &raquo;</li>
      
    <li>Sample of HTML Email Send Function</li>
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/nablarch" class="fa fa-github">GitHub</a>
    </li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://nablarch.github.io/docs/LATEST/doc/index.html" class="ja">日本語</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sample-of-html-email-send-function">
<h1>Sample of HTML Email Send Function<a class="headerlink" href="#sample-of-html-email-send-function" title="Permalink to this headline">¶</a></h1>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>This sample uses a Nablarch 1.4 compliant API.</p>
<p class="last">When combining with versions later than Nablarch 1.4 series, customize as necessary.</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Provides the implementation sample of the function that sends the HTML email.</p>
<p><a class="reference external" href="https://github.com/nablarch/nablarch-biz-sample-all">Source code</a></p>
<p>This function is a sample of sending HTML emails using the standard email send function (nablarch.common.mail.MailSender) provided in the Nablarch application framework.
Since this function is a sample implementation, the source code (both production and test code) must be imported into the project when using it in an implementation project.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>This sample does not support the batch send of HTML emails such as campaign notifications.
Using specialized products is recommended when the following is applicable.</p>
<blockquote class="last">
<div><ul class="simple">
<li>Sending mass emails such as campaign notifications and email newsletters.</li>
<li>Measure the opening rate of the delivered email and effectiveness of click count.</li>
<li>The client device (for example, whether it is a feature phone) is identified with the email address and emails sent are switched accordingly.</li>
<li>Use emojis.</li>
<li>Send a deco-mail.</li>
<li>Supports content creation for HTML email, and the content is created by the customer.
(since there is no draw tool or content creation function in this sample, the developer has to create the content.)</li>
</ul>
</div></blockquote>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Some clients do not display HTML email as expected, which may prevent the user from viewing the email. For this reason, do not use HTML email for emails where user notifications are important as a business requirement.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p><strong>Layout of HTML email</strong></p>
<blockquote>
<div><p>Since HTML emails differ in display depending on the email client, establish an HTML email standard with mutual understanding or consent from the customer.
The following points should be considered with project in the HTML email standard.</p>
<ul class="simple">
<li>The email client, device and OS to be tested.</li>
<li>The scope of use of HTML tags, styles (CSS properties), etc.</li>
<li>Extent to which fonts, color schemes, etc. are used.</li>
<li>Width of content. (Even when only PC is supported, the size that can be confirmed by the preview function of the email client.)</li>
</ul>
</div></blockquote>
<p><strong>Points to keep in mind when creating content</strong></p>
<blockquote class="last">
<div><ul class="simple">
<li>Since some email clients ignore the contents of the &lt;head&gt; tag, it is <strong>generally not recommended</strong> to remove styles in CSS files and &lt;style&gt; tags for HTML mail.</li>
<li>Try to keep the design as simple as possible.</li>
<li>Since some email clients do not support media queries, do not use responsive design as much as possible.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="request">
<h2>Request<a class="headerlink" href="#request" title="Permalink to this headline">¶</a></h2>
<div class="section" id="implemented">
<h3>Implemented<a class="headerlink" href="#implemented" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>HTML email can be sent (including alternative text).</li>
<li>Performs HTML escape for the string in the placeholder part of the text.
This enables the same security measures to be implemented as a normal online screen.</li>
</ul>
</div>
<div class="section" id="discontinued">
<h3>Discontinued<a class="headerlink" href="#discontinued" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>It can absorb the differences between different email clients.
(Specifically, it can absorb differences in style defined by CSS, etc., as well as implementation differences, including whether JavaScript can be used or not.)</li>
</ul>
<blockquote>
<div>Since the HTML design and target client are selected by the project that wants to send the HTML email,
this request should be dealt with during content creation and is not provided in this sample.</div></blockquote>
<ul>
<li><p class="first">Images can be embedded in HTML email.</p>
<p>Embedded images in an email increases the size of the email, and it takes a long time to receive them even if the user rejects HTML in the email client.It also increases the load on the email server.
Since the consumer web services often use the URL format, this sample does not provide the image embedding function.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="structure">
<h2>Structure<a class="headerlink" href="#structure" title="Permalink to this headline">¶</a></h2>
<p>Depending on the content, HTML emails should be sent with the following Content-Type patterns that conform to RFC 2557.</p>
<p>This shows the pattern and data model of the email to be sent.</p>
<div class="section" id="email-format">
<h3>Email format<a class="headerlink" href="#email-format" title="Permalink to this headline">¶</a></h3>
<p>The following emails can be sent in this sample.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="43%" />
<col width="18%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Email format</th>
<th class="head">Context class used by business action</th>
<th class="head">Attachment files</th>
<th class="head">Mail structure pattern</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="2">TEXT</td>
<td rowspan="2">TemplateMailContext</td>
<td>No</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>2</td>
</tr>
<tr class="row-even"><td rowspan="2">HTML</td>
<td rowspan="2">TemplateHtmlMailContext</td>
<td>No</td>
<td>3</td>
</tr>
<tr class="row-odd"><td>Yes</td>
<td>4</td>
</tr>
</tbody>
</table>
<p><strong>Mail structure pattern 1</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/Mail_Pattern01.jpg"><img alt="../../_images/Mail_Pattern01.jpg" src="../../_images/Mail_Pattern01.jpg" /></a>
</div></blockquote>
<p><strong>Mail structure pattern 2</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/Mail_Pattern02.jpg"><img alt="../../_images/Mail_Pattern02.jpg" src="../../_images/Mail_Pattern02.jpg" /></a>
</div></blockquote>
<p><strong>Mail structure pattern 3</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/Mail_Pattern03.jpg"><img alt="../../_images/Mail_Pattern03.jpg" src="../../_images/Mail_Pattern03.jpg" /></a>
</div></blockquote>
<p><strong>Mail structure pattern 4</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/Mail_Pattern04.jpg"><img alt="../../_images/Mail_Pattern04.jpg" src="../../_images/Mail_Pattern04.jpg" /></a>
</div></blockquote>
</div>
<div class="section" id="class-diagram">
<h3>Class diagram<a class="headerlink" href="#class-diagram" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/HtmlMail_ClassDiagram.png"><img alt="../../_images/HtmlMail_ClassDiagram.png" src="../../_images/HtmlMail_ClassDiagram.png" style="width: 100%;" /></a>
</div></blockquote>
<div class="section" id="responsibilities-of-each-class">
<h4>Responsibilities of each class<a class="headerlink" href="#responsibilities-of-each-class" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Class name</th>
<th class="head">Summary</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>please.change.me.common.mail.html.HtmlMailRequester</td>
<td>Class that accepts HTML email send request which is an extension of MailRequester</td>
</tr>
<tr class="row-odd"><td>please.change.me.common.mail.html.TemplateHtmlMailContext</td>
<td>Class that extends TemplateMailContext and retains information required for HTML email.
By converting alternative text to the body, it is possible to implement the function
which sends email in plain text format using the template for HTML email.</td>
</tr>
<tr class="row-even"><td>please.change.me.common.mail.html.HtmlMailTable</td>
<td>Class that accesses the HTML email table.</td>
</tr>
<tr class="row-odd"><td>please.change.me.common.mail.html.HtmlMailSender</td>
<td>Class that supports sending HTML emails which is an extension of MailSender. If the request is
not for HTML email, delegates the process to parent class and sends email in plain text format.</td>
</tr>
<tr class="row-even"><td>please.change.me.common.mail.html.HtmlMailContentCreator</td>
<td>Class that generates content for HTML email.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="description-of-configuration">
<h4>Description of configuration<a class="headerlink" href="#description-of-configuration" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Email send request API --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;mailRequester&quot;</span> <span class="na">class=</span><span class="s">&quot;please.change.me.common.mail.html.HtmlMailRequester&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mailRequestConfig&quot;</span> <span class="na">ref=</span><span class="s">&quot;mailRequestConfig&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mailRequestIdGenerator&quot;</span> <span class="na">ref=</span><span class="s">&quot;mailRequestIdGenerator&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mailRequestTable&quot;</span> <span class="na">ref=</span><span class="s">&quot;mailRequestTable&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mailRecipientTable&quot;</span> <span class="na">ref=</span><span class="s">&quot;mailRecipientTable&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mailAttachedFileTable&quot;</span> <span class="na">ref=</span><span class="s">&quot;mailAttachedFileTable&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mailTemplateTable&quot;</span> <span class="na">ref=</span><span class="s">&quot;mailTemplateTable&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- Configure the access function to extended table --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;htmlMailTable&quot;</span> <span class="na">ref=</span><span class="s">&quot;htmlMailTable&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="c">&lt;!--</span>
<span class="c">Although the schema is defined with the email send function of the Nablarch application framework,</span>
<span class="c">it is not defined in the configuration file as modifying the source code directly in this library is better</span>
<span class="c">Since the function of table access is common to Requester and Sender, the component should be defined.</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;databaseMetaDataExtractor&quot;</span> <span class="na">class=</span><span class="s">&quot;.dao.CustomDatabaseMetaDataExtractor&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="data-model">
<h3>Data model<a class="headerlink" href="#data-model" title="Permalink to this headline">¶</a></h3>
<p>The extension from the email function is shown.</p>
<p>This sample adopts a architecture to operate as TEXT+HTML email
by associating the extended table for HTML to the email-related table.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The DDL of the data model shown below is included in the test resource.</p>
</div>
<div class="section" id="alternative-text-template-table-for-html-email">
<h4>Alternative text template table for HTML email<a class="headerlink" href="#alternative-text-template-table-for-html-email" title="Permalink to this headline">¶</a></h4>
<p>A relation table of the email template that manages the alternative text of the standard email for HTML.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="11%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Definition</th>
<th class="head">Java type</th>
<th class="head">Remarks</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Email template ID</td>
<td>java.lang.String</td>
<td><div class="first last line-block">
<div class="line">PK</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Language</td>
<td>java.lang.String</td>
<td><div class="first last line-block">
<div class="line">PK</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Alternate text</td>
<td>java.lang.String</td>
<td><div class="first last line-block">
<div class="line">Text for mailers that cannot display HTML email messages.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="alternative-text-table-for-html-mail">
<h4>Alternative text table for HTML mail<a class="headerlink" href="#alternative-text-table-for-html-mail" title="Permalink to this headline">¶</a></h4>
<p>Relation table for email send requests that manages alternative text for HTML email.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="11%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Definition</th>
<th class="head">Java type</th>
<th class="head">Remarks</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Email send request PK</td>
<td>java.lang.String</td>
<td><div class="first last line-block">
<div class="line">PK</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Alternate text</td>
<td>java.lang.String</td>
<td><div class="first last line-block">
<div class="line">Text for mailers that cannot display HTML email messages.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="implementation-examples">
<h2>Implementation examples<a class="headerlink" href="#implementation-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="send-html-email">
<h3>Send HTML email<a class="headerlink" href="#send-html-email" title="Permalink to this headline">¶</a></h3>
<p>The implementation using this sample is similar to the standard email send of the email send function of the Nablarch application framework.</p>
<p>As the context class used in business action is different, implementation example is omitted.</p>
</div>
<div class="section" id="dynamic-content-switching">
<h3>Dynamic content switching<a class="headerlink" href="#dynamic-content-switching" title="Permalink to this headline">¶</a></h3>
<p>A sample implementation, by using an HTML template, that dynamically switches between HTML and TEXT formats from business actions is shown.</p>
<div class="section" id="switching-method">
<h4>Switching method<a class="headerlink" href="#switching-method" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>When <strong>plain text</strong> is specified in the contentType of TemplateHtmlMailContext during email send request,
the body is replaced with the alternate text.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="16%" />
<col width="43%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Context class</th>
<th class="head">Specified type</th>
<th class="head">Transfer source to body text</th>
<th class="head">Content-Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>TemplateMailContext</td>
<td>-</td>
<td>Email template.Body</td>
<td>text/plain</td>
</tr>
<tr class="row-odd"><td rowspan="2">TemplateHtmlMailContext</td>
<td><em>text/plain</em></td>
<td><em>Alternate text template.Alternate text</em></td>
<td><em>text/plain</em></td>
</tr>
<tr class="row-even"><td>text/html</td>
<td>Email template.Body</td>
<td>text/html</td>
</tr>
</tbody>
</table>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">HttpResponse</span> <span class="nf">doSendMail</span><span class="o">(</span><span class="n">HttpRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ExecutionContext</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">MailSampleForm</span> <span class="n">form</span> <span class="o">=</span> <span class="n">MailSampleForm</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="s">&quot;mail&quot;</span><span class="o">);</span>
    <span class="n">TemplateHtmlMailContext</span> <span class="n">mail</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TemplateHtmlMailContext</span><span class="o">();</span>
    <span class="c1">// If the user has selected ContentType.PLAIN, the alternative text will be switched to the body.</span>
    <span class="n">mail</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>
    <span class="c1">// Configure other properties and call MailRequester.</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="combined-use-of-digital-signature">
<h3>Combined use of digital signature<a class="headerlink" href="#combined-use-of-digital-signature" title="Permalink to this headline">¶</a></h3>
<p>When using a digital signature, use the extended sample of digital signature and HTML email sample together.</p>
<blockquote>
<div><ul class="simple">
<li>This sample is used for the registration process of the email send request.</li>
<li>For email send batch, use the HtmlMailContentCreator class provided by this sample to extend the digital signature extended sample (SMIMESignedMailSender) so that HTML email content can be created and used.</li>
</ul>
</div></blockquote>
<p>The implementation image is shown below.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">addBodyContent</span><span class="o">(</span><span class="n">MimeMessage</span> <span class="n">mimeMessage</span><span class="o">,</span> <span class="n">MailRequestTable</span><span class="o">.</span><span class="na">MailRequest</span> <span class="n">mailRequest</span><span class="o">,</span>
        <span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">MailAttachedFileTable</span><span class="o">.</span><span class="na">MailAttachedFile</span><span class="o">&gt;</span> <span class="n">attachedFiles</span><span class="o">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">MessagingException</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">mailSendPatternId</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getSessionScopedVar</span><span class="o">(</span><span class="s">&quot;mailSendPatternId&quot;</span><span class="o">);</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">CertificateWrapper</span><span class="o">&gt;</span> <span class="n">certificateChain</span> <span class="o">=</span> <span class="n">SystemRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">CERTIFICATE_REPOSITORY_KEY</span><span class="o">);</span>
    <span class="n">CertificateWrapper</span> <span class="n">certificateWrapper</span> <span class="o">=</span> <span class="n">certificateChain</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">mailSendPatternId</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="c1">// Configure the generator that creates the digital signature.</span>
        <span class="n">SMIMESignedGenerator</span> <span class="n">smimeSignedGenerator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SMIMESignedGenerator</span><span class="o">();</span>
        <span class="c1">// ---Middle is omitted---</span>

        <span class="c1">// Branching with HTML email</span>
        <span class="n">MimeBodyPart</span> <span class="n">bodyPart</span><span class="o">;</span>
        <span class="n">HtmlMailTable</span> <span class="n">htmlTable</span> <span class="o">=</span> <span class="n">SystemRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;htmlMailTable&quot;</span><span class="o">);</span>
        <span class="n">SqlRow</span> <span class="n">alternativeText</span> <span class="o">=</span> <span class="n">htmlTable</span><span class="o">.</span><span class="na">findAlternativeText</span><span class="o">(</span><span class="n">mailRequest</span><span class="o">.</span><span class="na">getMailRequestId</span><span class="o">());</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">alternativeText</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bodyPart</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeBodyPart</span><span class="o">();</span>
            <span class="n">bodyPart</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">HtmlMailContentCreator</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mailRequest</span><span class="o">.</span><span class="na">getMailBody</span><span class="o">(),</span> <span class="n">mailRequest</span><span class="o">.</span><span class="na">getCharset</span><span class="o">(),</span>
                                                              <span class="n">alternativeText</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;alternativeText&quot;</span><span class="o">),</span> <span class="n">attachedFiles</span><span class="o">));</span>
            <span class="n">mimeMessage</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">smimeSignedGenerator</span><span class="o">.</span><span class="na">generate</span><span class="o">(</span><span class="n">bodyPart</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="c1">// Implementation of SMIMESignedMailSender</span>
          <span class="n">bodyPart</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeBodyPart</span><span class="o">();</span>
          <span class="n">bodyPart</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">mailRequest</span><span class="o">.</span><span class="na">getMailBody</span><span class="o">(),</span> <span class="n">mailRequest</span><span class="o">.</span><span class="na">getCharset</span><span class="o">());</span>
          <span class="c1">// ---Rest is omitted---</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">MailConfig</span> <span class="n">mailConfig</span> <span class="o">=</span> <span class="n">SystemRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;mailConfig&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">mailRequestId</span> <span class="o">=</span> <span class="n">mailRequest</span><span class="o">.</span><span class="na">getMailRequestId</span><span class="o">();</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="n">TransactionAbnormalEnd</span><span class="o">(</span>
                <span class="n">mailConfig</span><span class="o">.</span><span class="na">getAbnormalEndExitCode</span><span class="o">(),</span> <span class="n">e</span><span class="o">,</span>
                <span class="n">mailConfig</span><span class="o">.</span><span class="na">getSendFailureCode</span><span class="o">(),</span> <span class="n">mailRequestId</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="embed-tags">
<h3>Embed tags<a class="headerlink" href="#embed-tags" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>Embedding of tags is not implemented or recommended at the time of provision because of the following points.</p>
<blockquote>
<div><ul class="simple">
<li>It becomes difficult to check the layout of HTML email</li>
<li>Security measures must be implemented with project</li>
</ul>
</div></blockquote>
<p class="last">Therefore, use it carefully after considering whether it can be handled by preparing multiple templates.
Consider whether template creation cost can compensate for the security risk.</p>
</div>
<p>In the sample provided by Nablarch, HTML escape is enforced, so it is not possible to dynamically embed HTML tags in the template.</p>
<p>When it is needed to embed it dynamically, modify TemplateHtmlMailContext in the project and add an API that calls TemplateMailContext#setReplaceKeyValue.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Embed</span> <span class="n">the</span> <span class="n">tag</span> <span class="n">without</span> <span class="n">doing</span> <span class="n">HTML</span> <span class="n">escape</span><span class="o">.</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setReplaceKeyRawValue</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="n">tag</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">setReplaceKeyValue</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">tag</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>The test for HTML emails is the same as that for regular emails.</p>
<blockquote class="last">
<div><ul class="simple">
<li>The HTML text validates the table of email send requests.</li>
<li>Layout confirmation in the actual email client uses the send batch to send and check the email.</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
        <p>
            &copy; Copyright 2010-2021, TIS Inc.
        </p>
    </div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'5u20',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>