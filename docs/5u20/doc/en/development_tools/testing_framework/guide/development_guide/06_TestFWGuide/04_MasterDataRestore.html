


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv='content-language' content='ja'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.2.10. Master Data Recovery Function &mdash; ∇Nablarch  5u20 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  

  

  
  <link rel="canonical" href="https://nablarch.github.io/docs/LATEST/doc/development_tools/testing_framework/guide/development_guide/06_TestFWGuide/04_MasterDataRestore.html" />
  
    <link rel="top" title="∇Nablarch  5u20 documentation" href="../../../../../index.html"/>
        <link rel="up" title="3.2. How to Use the Automated Test Framework" href="index.html"/>
        <link rel="next" title="3.3. Tools Used in the Programming Phase" href="../08_TestTools/index.html"/>
        <link rel="prev" title="3.2.9. How to Use Purpose-specific APIs" href="03_Tips.html"/>
 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  
  <a href="../../../../../index.html" id="sidebar-title" class="icon"> ∇Nablarch 
  

  
    <div id="sidebar-version">Version: 5u20</div>
  </a>

  <div role="search">
    <form id="google-search-form" class="wy-form" method="get" action="https://www.google.co.jp/search">
      <input type="text" name="text" placeholder="Search docs on google" id="text"/>
      <input type="hidden" name="q" id="q"/>
    </form>
  </div>
    
    

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../about_nablarch/index.html">What is the Nablarch?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../about_nablarch/concept.html">Nablarch Concept</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../about_nablarch/concept.html#robustness">Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../about_nablarch/concept.html#testability">Testability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../about_nablarch/concept.html#ready-to-use">Ready-to-Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../about_nablarch/mvn_module.html">Module List of Nablarch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../about_nablarch/license.html">Information on Nablarch License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../application_framework/index.html">Nablarch Application Framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../application_framework/application_framework/index.html">Application Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/application_framework/nablarch/index.html">1. What is Nablarch Application Framework?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/application_framework/web/index.html">2. Web Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/application_framework/web_service/index.html">3. Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/application_framework/batch/index.html">4. Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/application_framework/messaging/index.html">5. Messaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/application_framework/handlers/index.html">6. Standard Handler Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/application_framework/libraries/index.html">7. Libraries Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/application_framework/blank_project/index.html">8. Blank Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/application_framework/setting_guide/index.html">9. Nablarch Application Framework Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/application_framework/configuration/index.html">10. Default Configuration List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/application_framework/cloud_native/index.html">11. Nablarch Cloud Native Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../application_framework/adaptors/index.html">Adaptor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/log_adaptor.html">log Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/router_adaptor.html">Routing Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/webspheremq_adaptor.html">IBM WebSphere MQ Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/jaxrs_adaptor.html">JAX-RS Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/doma_adaptor.html">Doma Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/jsr310_adaptor.html">JSR310(Date and Time API)Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/mail_sender_freemarker_adaptor.html">E-mail FreeMarker Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/mail_sender_thymeleaf_adaptor.html">E-mail Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/mail_sender_velocity_adaptor.html">E-mail Velocity Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/web_thymeleaf_adaptor.html">Web Application Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/lettuce_adaptor.html">Lettuce Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/slf4j_adaptor.html">SLF4J Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/adaptors/micrometer_adaptor.html">Micrometer Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../application_framework/example/index.html">Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/example/index.html#procedure-to-build-the-environment">Procedure to build the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../application_framework/example/index.html#application-execution-procedure">Application execution procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../extension_components/index.html">Nablarch extension component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../extension_components/report/index.html">1. Form library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../extension_components/workflow/doc/index.html">2. Workflow library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../extension_components/workflow/tool/index.html">3. Workflow definition data generation tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../extension_components/etl/index.html">4. ETL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../extension_components/etl/etl_maven_plugin.html">5. ETL Maven plugin</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Nablarch development tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../java_static_analysis/index.html">1. Efficient Java Static Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../java_static_analysis/index.html#conduct-syntax-check">1.1. Conduct syntax check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../java_static_analysis/index.html#unify-the-format">1.2. Unify the format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../java_static_analysis/index.html#check-if-unauthorized-apis-are-being-used">1.3. Check if unauthorized APIs are being used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ui_dev/index.html">2. Front-end UI development platform for advanced users</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">3. Testing framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../05_UnitTestGuide/index.html">3.1. How to Execute Unit Tests</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">3.2. How to Use the Automated Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../08_TestTools/index.html">3.3. Tools Used in the Programming Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../toolbox/index.html">4. Useful Tools When Developing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../toolbox/JspStaticAnalysis/index.html">4.1. JSP Static Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../toolbox/SqlExecutor/SqlExecutor.html">4.2. Nablarch SQL Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../toolbox/JspVerifier/JspVerifier.html">4.3. Job Screen JSP Validation Tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../examples/index.html">Nablarch Implementation Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/01/index.html">Sample Password Encryption Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/01/0101_PBKDF2PasswordEncryptor.html">Sample Password Encryption Function Using PBKDF2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/01/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/01/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/01/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/01/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/02/index.html">Extended Validation Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/02/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/02/index.html#email-address-validation">Email address validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/02/index.html#validation-of-japan-telephone-numbers">Validation of Japan telephone numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/02/index.html#code-value-validation">Code value validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/03/index.html">Display a List of Search Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#how-to-use">How to Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#listsearchinfo-class">ListSearchInfo class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#listsearchresult-tag">listSearchResult tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#sort-search-results">Sort search results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#how-to-implement-displaying-a-list-of-all-search-results-on-a-single-screen">How to implement displaying a list of all search results on a single screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#how-to-implement-the-initial-display-of-search-results-with-the-default-search-conditions">How to implement the initial display of search results with the default search conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#default-settings-for-the-search-result-list-display-function">Default settings for the search result list display function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#how-to-import-a-sample-implementation-tag-file-into-the-business-application">How to import a sample implementation (tag file) into the business application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/03/index.html#tag-reference">Tag Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/04/index.html">Extended Formatter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/04/0401_ExtendedDataFormatter.html">Data Formatter Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/04/0402_ExtendedFieldType.html">Field Type Expansion in the Data Formatter Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/05/index.html">Sample File Management Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/05/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/05/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/05/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/05/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/05/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/06/index.html">CAPTCHA Function Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/06/06_Captcha_guide.html">How to Incorporate the CAPTCHA Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/06/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/06/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/06/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/06/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/07/index.html">Sample UserAgent Information Acquisition Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/07/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/07/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/07/index.html#description-of-configuration">Description of configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/07/index.html#use-case">Use case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/08/index.html">Sample of HTML Email Send Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/08/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/08/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/08/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/08/index.html#implementation-examples">Implementation examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/09/index.html">How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/09/index.html#environment-preparation">Environment preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/09/index.html#structure-of-digitally-signed-email-send-function">Structure of digitally signed email send function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/09/index.html#preparation-of-configuration-file">Preparation of configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/09/index.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/10/index.html">How to Use the Log Aggregation Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/10/index.html#list-of-samples-provided">List of samples provided</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/11/index.html">Messaging Platform Test Simulator Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/11/index.html#uses">Uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/11/index.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/11/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/11/index.html#how-to-use">How to use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/11/index.html#expansion-example">Expansion example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../nablarch_api/index.html">Nablarch API</a></li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">∇Nablarch </a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../../index.html">Nablarch development tools</a> &raquo;</li>
      
          <li><a href="../../../index.html">3. Testing framework</a> &raquo;</li>
      
          <li><a href="index.html">3.2. How to Use the Automated Test Framework</a> &raquo;</li>
      
    <li>3.2.10. Master Data Recovery Function</li>
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/nablarch" class="fa fa-github">GitHub</a>
    </li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://nablarch.github.io/docs/LATEST/doc/index.html" class="ja">日本語</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="master-data-recovery-function">
<span id="master-data-backup"></span><h1>3.2.10. Master Data Recovery Function<a class="headerlink" href="#master-data-recovery-function" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#features" id="id2">Features</a></li>
<li><a class="reference internal" href="#required-schemas" id="id3">Required schemas</a></li>
<li><a class="reference internal" href="#operation-image" id="id4">Operation image</a></li>
<li><a class="reference internal" href="#environment-construction" id="id5">Environment construction</a><ul>
<li><a class="reference internal" href="#create-a-backup-schema-and-submit-the-data" id="id6">Create a backup schema and submit the data</a></li>
<li><a class="reference internal" href="#when-using-a-table-with-a-foreign-key" id="id7">When using a table with a foreign key</a></li>
<li><a class="reference internal" href="#describing-tables-to-be-monitored-in-the-component-configuration-file" id="id8">Describing tables to be monitored, in the component configuration file</a></li>
<li><a class="reference internal" href="#example-of-log-output" id="id9">Example of log output</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">3.2.10.1. Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>In normal cases, the master data is not rewritten when testing.
However, in tests such as the master maintenance function, there are some test cases that cannot be executed without changing the master data.
For example, in the abnormal-type test cases such as those where the data that should have existed did not exist,
it is necessary to delete the records from the master data.</p>
<p>If the master data is changed during the test,
the test of subsequent test classes may fail because the master data is in an unexpected state.</p>
<p>In order to prevent such unintentional test failures due to master data changes,
when the master data is updated during an automated test,
a function is provided to restore the master data to its original state when the test method ends.</p>
</div>
<div class="section" id="features">
<h2><a class="toc-backref" href="#id2">3.2.10.2. Features</a><a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>You can always test with the correct state of master data, regardless of the order in which the tests are executed.</li>
<li>Since the master data restoration is performed automatically, there is no need to provide the restoration process and data for restoration in each test class.</li>
<li>Since the master data is restored in batches for each table from the backup schema, restoration can be done faster as compared to inserting the records one by one.</li>
</ul>
</div>
<div class="section" id="required-schemas">
<h2><a class="toc-backref" href="#id3">3.2.10.3. Required schemas</a><a class="headerlink" href="#required-schemas" title="Permalink to this headline">¶</a></h2>
<p>To use this function, the following two schemas are required.</p>
<table border="1" class="colwidths-given white-space-normal docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Schema</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Schema for automated testing</td>
<td>The schema used for automated testing.</td>
</tr>
<tr class="row-odd"><td>Backup schema</td>
<td>A schema for storing the master data for use in restoration.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="operation-image">
<h2><a class="toc-backref" href="#id4">3.2.10.4. Operation image</a><a class="headerlink" href="#operation-image" title="Permalink to this headline">¶</a></h2>
<p>The automated testing framework fetches a list of table names to be monitored from the component configuration file.
During test execution, the automated testing framework monitors the SQL log
and detects whether an SQL statement was issued to change a monitored table.</p>
<img alt="../../../../../_images/modification_detected.png" src="../../../../../_images/modification_detected.png" />
<p>If an SQL statement that changes a monitored table was issued, the changed table is restored after the test method ends.
When restoring the table, all the records in the table are temporarily deleted.
Then, all the records are inserted from the table in the backup schema.</p>
<img alt="../../../../../_images/copy_from_backup.png" src="../../../../../_images/copy_from_backup.png" />
</div>
<div class="section" id="environment-construction">
<span id="master-data-backup-settings"></span><h2><a class="toc-backref" href="#id5">3.2.10.5. Environment construction</a><a class="headerlink" href="#environment-construction" title="Permalink to this headline">¶</a></h2>
<p>Build an environment as follows and enable the master data restoration function of the automated testing framework.</p>
<div class="section" id="create-a-backup-schema-and-submit-the-data">
<h3><a class="toc-backref" href="#id6">3.2.10.5.1. Create a backup schema and submit the data</a><a class="headerlink" href="#create-a-backup-schema-and-submit-the-data" title="Permalink to this headline">¶</a></h3>
<p>Create a schema for master data restoration.
Create the same tables as the schema for automated test in the master data restoration schema, and submit the data.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">It is not necessary to create all the tables in the master data restoration schema.
Only the tables for which the master data is to be restored need to be created (it does not matter even if other tables exist).</p>
</div>
</div>
<div class="section" id="when-using-a-table-with-a-foreign-key">
<span id="masterdatarestore-fk-key"></span><h3><a class="toc-backref" href="#id7">3.2.10.5.2. When using a table with a foreign key</a><a class="headerlink" href="#when-using-a-table-with-a-foreign-key" title="Permalink to this headline">¶</a></h3>
<p>When restoring data from a table with a foreign key, it is necessary to perform the restoration process by keeping in mind the parent-child relationship.
For this reason, this function uses the JDBC function as the default action to acquire and build the parent-child relationship,
and controls deletion from the child table and insertion from the parent table in that order.</p>
<p>However, in the case of a project with a large number of tables, slow test problem may occur due to the process of building a parent-child relationship based on the JDBC function.
To avoid this problem, a function is provided for performing deletion and insertion from tables based on the description order (refer to <a class="reference internal" href="#masterdatarestore-configuration"><span>Configuration example</span></a>) instead of using the JDBC function.</p>
<p>If you want to restore the master data based on the description order, add the following to the configuration file:</p>
<div class="highlight-jproperties"><div class="highlight"><pre><span></span><span class="na">nablarch.suppress-table-sort</span><span class="o">=</span><span class="s">true</span>
</pre></div>
</div>
</div>
<div class="section" id="describing-tables-to-be-monitored-in-the-component-configuration-file">
<h3><a class="toc-backref" href="#id8">3.2.10.5.3. Describing tables to be monitored, in the component configuration file</a><a class="headerlink" href="#describing-tables-to-be-monitored-in-the-component-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>Enumerate the tables to be monitored in the component configuration file for an automated test.</p>
<div class="section" id="settings-items-list">
<h4>3.2.10.5.3.1. Settings items list<a class="headerlink" href="#settings-items-list" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-given white-space-normal docutils">
<colgroup>
<col width="25%" />
<col width="58%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Configuration item name</th>
<th class="head">Description</th>
<th class="head">Default values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>backupSchema</td>
<td>Describe the schema name for master data restoration.</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>tablesTobeWatched</td>
<td>Enumerate the names of the tables to be monitored, in a list format.</td>
<td>No</td>
</tr>
<tr class="row-even"><td>testEventListeners</td>
<td>List of test event listeners.
By registering the master data restoration class (nablarch.test.core.db.MasterDataRestorer) here,
master data will be performed at the end of the test method.</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuration-example">
<span id="masterdatarestore-configuration"></span><h4>3.2.10.5.3.2. Configuration example<a class="headerlink" href="#configuration-example" title="Permalink to this headline">¶</a></h4>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Master data recovery class --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;masterDataRestorer&quot;</span>
           <span class="na">class=</span><span class="s">&quot;nablarch.test.core.db.MasterDataRestorer&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Backup schema --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;backupSchema&quot;</span> <span class="na">value=</span><span class="s">&quot;nablarch_test_master&quot;</span><span class="nt">/&gt;</span>
  <span class="c">&lt;!-- List of monitored tables --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;tablesTobeWatched&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;list&gt;</span>
      <span class="nt">&lt;value&gt;</span>MESSAGE<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span>ID_GENERATE<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span>BUSINESS_DATE<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span>PERMISSION_UNIT<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span>REQUEST<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span>PERMISSION_UNIT_REQUEST<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-of-log-output">
<h3><a class="toc-backref" href="#id9">3.2.10.5.4. Example of log output</a><a class="headerlink" href="#example-of-log-output" title="Permalink to this headline">¶</a></h3>
<p>This function detects changes to the master data by monitoring the SQL log.
It is necessary to output a log for this purpose.</p>
<div class="section" id="app-log-properties">
<h4>3.2.10.5.4.1. app-log.properties<a class="headerlink" href="#app-log-properties" title="Permalink to this headline">¶</a></h4>
<p>Specify the class to provide this function in the <cite>sqlLogFormatter</cite> class name.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>sqlLogFormatter.className=nablarch.test.core.db.MasterDataRestorer$SqlLogWatchingFormatter
</pre></div>
</div>
</div>
<div class="section" id="log-properties">
<h4>3.2.10.5.4.2. log.properties<a class="headerlink" href="#log-properties" title="Permalink to this headline">¶</a></h4>
<p>Configure in log.properties so as to output the SQL log at DEBUG level or higher.
In the following example, a dedicated logger (a logger that does not do anything) is configured
to prevent the SQL log from being displayed in the standard output.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span># Logger factory implementation class
loggerFactory.className=nablarch.core.log.basic.BasicLoggerFactory

#  Log writer name
writerNames=stdout,nop

# Standard output for debugging
writer.stdout.className=nablarch.core.log.basic.StandardOutputLogWriter
writer.nop.className=nablarch.test.core.log.NopLogWriter   # [Description] A logger that does not do anything

# Available logger name order
availableLoggersNamesOrder=sql,root

# For all logger acquisitions, the DEBUG level or higher is output in the standard output.
loggers.root.nameRegex=.*
loggers.root.level=DEBUG
loggers.root.writerNames=stdout

# The DEBUG level or higher is output for the logger acquisitions with &quot;SQL&quot; specified in the logger name.
loggers.sql.nameRegex=SQL
loggers.sql.level=DEBUG      #  [Description] Should be set to DEBUG level or higher
loggers.sql.writerNames=nop
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
        <p>
            &copy; Copyright 2010-2021, TIS Inc.
        </p>
    </div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'5u20',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>