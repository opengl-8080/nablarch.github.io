<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>nablarch-js-util-date\ui_public\js\nablarch\util\SimpleDateFormat.js - Nablarch JavaScript Widget</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Nablarch JavaScript Widget"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/jQuery.html">jQuery</a></li>
            
                <li><a href="../classes/jsp.html">jsp</a></li>
            
                <li><a href="../classes/jsp.taglib.box.html">jsp.taglib.box</a></li>
            
                <li><a href="../classes/jsp.taglib.button.html">jsp.taglib.button</a></li>
            
                <li><a href="../classes/jsp.taglib.column.html">jsp.taglib.column</a></li>
            
                <li><a href="../classes/jsp.taglib.device.html">jsp.taglib.device</a></li>
            
                <li><a href="../classes/jsp.taglib.function.html">jsp.taglib.function</a></li>
            
                <li><a href="../classes/jsp.taglib.html.html">jsp.taglib.html</a></li>
            
                <li><a href="../classes/jsp.taglib.jsp.html">jsp.taglib.jsp</a></li>
            
                <li><a href="../classes/jsp.taglib.jstl.html">jsp.taglib.jstl</a></li>
            
                <li><a href="../classes/jsp.taglib.layout.html">jsp.taglib.layout</a></li>
            
                <li><a href="../classes/jsp.taglib.listsearchresult.html">jsp.taglib.listsearchresult</a></li>
            
                <li><a href="../classes/jsp.taglib.nablarch.html">jsp.taglib.nablarch</a></li>
            
                <li><a href="../classes/jsp.taglib.tab.html">jsp.taglib.tab</a></li>
            
                <li><a href="../classes/jsp.taglib.table.html">jsp.taglib.table</a></li>
            
                <li><a href="../classes/jsp.taglib.template.html">jsp.taglib.template</a></li>
            
                <li><a href="../classes/nablarch.ui.html">nablarch.ui</a></li>
            
                <li><a href="../classes/nablarch.ui.AutoSpan.html">nablarch.ui.AutoSpan</a></li>
            
                <li><a href="../classes/nablarch.ui.AutoSum.html">nablarch.ui.AutoSum</a></li>
            
                <li><a href="../classes/nablarch.ui.Collapsible.html">nablarch.ui.Collapsible</a></li>
            
                <li><a href="../classes/nablarch.ui.ContextMenu.html">nablarch.ui.ContextMenu</a></li>
            
                <li><a href="../classes/nablarch.ui.DatePicker.html">nablarch.ui.DatePicker</a></li>
            
                <li><a href="../classes/nablarch.ui.event.AjaxAction.html">nablarch.ui.event.AjaxAction</a></li>
            
                <li><a href="../classes/nablarch.ui.event.Listener.html">nablarch.ui.event.Listener</a></li>
            
                <li><a href="../classes/nablarch.ui.event.ShowDialog.html">nablarch.ui.event.ShowDialog</a></li>
            
                <li><a href="../classes/nablarch.ui.event.SubWindowListener.html">nablarch.ui.event.SubWindowListener</a></li>
            
                <li><a href="../classes/nablarch.ui.event.ToggleAction.html">nablarch.ui.event.ToggleAction</a></li>
            
                <li><a href="../classes/nablarch.ui.event.WindowClose.html">nablarch.ui.event.WindowClose</a></li>
            
                <li><a href="../classes/nablarch.ui.event.WriteAction.html">nablarch.ui.event.WriteAction</a></li>
            
                <li><a href="../classes/nablarch.ui.LightBox.html">nablarch.ui.LightBox</a></li>
            
                <li><a href="../classes/nablarch.ui.ListBuilder.html">nablarch.ui.ListBuilder</a></li>
            
                <li><a href="../classes/nablarch.ui.selector.html">nablarch.ui.selector</a></li>
            
                <li><a href="../classes/nablarch.ui.SlideMenu.html">nablarch.ui.SlideMenu</a></li>
            
                <li><a href="../classes/nablarch.ui.Tab.html">nablarch.ui.Tab</a></li>
            
                <li><a href="../classes/nablarch.ui.TabindexOrder.html">nablarch.ui.TabindexOrder</a></li>
            
                <li><a href="../classes/nablarch.ui.TabLink.html">nablarch.ui.TabLink</a></li>
            
                <li><a href="../classes/nablarch.ui.ToggleCheckbox.html">nablarch.ui.ToggleCheckbox</a></li>
            
                <li><a href="../classes/nablarch.ui.Tooltip.html">nablarch.ui.Tooltip</a></li>
            
                <li><a href="../classes/nablarch.ui.TreeList.html">nablarch.ui.TreeList</a></li>
            
                <li><a href="../classes/nablarch.ui.TreeMenu.html">nablarch.ui.TreeMenu</a></li>
            
                <li><a href="../classes/nablarch.ui.Widget.html">nablarch.ui.Widget</a></li>
            
                <li><a href="../classes/nablarch.util.BigDecimal.html">nablarch.util.BigDecimal</a></li>
            
                <li><a href="../classes/nablarch.util.BigDecimal.NaN.html">nablarch.util.BigDecimal.NaN</a></li>
            
                <li><a href="../classes/nablarch.util.Consumer.html">nablarch.util.Consumer</a></li>
            
                <li><a href="../classes/nablarch.util.DateUtil.html">nablarch.util.DateUtil</a></li>
            
                <li><a href="../classes/nablarch.util.SimpleDateFormat.html">nablarch.util.SimpleDateFormat</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/devtool.html">devtool</a></li>
            
                <li><a href="../modules/jsp.html">jsp</a></li>
            
                <li><a href="../modules/jsp.taglib.html">jsp.taglib</a></li>
            
                <li><a href="../modules/nablarch.ui.html">nablarch.ui</a></li>
            
                <li><a href="../modules/nablarch.ui.device.html">nablarch.ui.device</a></li>
            
                <li><a href="../modules/nablarch.util.html">nablarch.util</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: nablarch-js-util-date\ui_public\js\nablarch\util\SimpleDateFormat.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * @module nablarch.util
 */
define([&quot;sugar&quot;], function() { &quot;use strict&quot;;

  function define() {
    return SimpleDateFormat;
  }

  /**
   * Java SDK SimpleDateFormat クラス互換ライブラリ
   * ---------------------------------------------------------
   * 本クラスではSimpleDateFormatの仕様のうち、日付に関する処理のサブセットを実装する。
   * サポートするフォーマット書式は以下の通り。
   *
   *     yyyy: 西暦年(4桁)
   *     yy  : 西暦年(下2桁)  * パース時は現在を起点として過去80年～20年後に収まる日付になる。
   *     M   : 月 (1～2桁)
   *     MM  : 月 (2桁)
   *     MMM : 月 (テキスト)  * フォーマット時のみ
   *     d   : 日 (1～2桁)
   *     dd  : 日 (2桁)
   *     EEEE: 曜日 (テキスト) * フォーマット時のみ、ロケール対応
   *     E   : 曜日略号 (テキスト) * フォーマット時のみ、ロケール対応
   *     &#x27;&#x27;  : シングルクォート
   *     [a-zA-Z&#x27;]以外の文字 : リテラル
   *     &#x27;によるクォート文字列 : リテラル
   *
   * @class nablarch.util.SimpleDateFormat
   * @author Iwauo Tajima
   * @since  1.2
   */
  SimpleDateFormat.prototype = {
    /**
     * コンストラクタ
     * @method SimpleDateFormat
     * @constructor
     * @param {String} pattern フォーマット文字列
     * @return {SimpleDateFormat} インスタンス
    */
    constructor: SimpleDateFormat
    /**
     * フォーマット文字列
     * @property pattern
     * @type String
     */
  , pattern: null
    /**
     * 日付オブジェクトを文字列表現に変換する。
     * @method format
     * @param   {String} date 日付オブジェクト
     * @param   {String} locale = &#x27;ja&#x27; ロケール
     * @return {String} 日付オブジェクトの文字列表現
     */
  , format: SimpleDateFormat_format
    /**
     * 日付文字列を&#x60;Date&#x60;オブジェクトに変換する。
     * 変換できない場合nullを返却する。
     *
     * @method parse
     * @param {String} dateStr 日付文字列
     * @returns {Date} 日付オブジェクト
     */
  , parse: SimpleDateFormat_parse
    /**
     * フォーマット文字列をパースし、対応するアクションを実行する。
     * @method eval
     * @param {Object} action 実行するアクション
     */
  , eval: SimpleDateFormat_eval
  };

  function SimpleDateFormat(pattern) {
    this.pattern = pattern;
  }

  function SimpleDateFormat_parse(dateStr) {
    var date  = new Date(1970, 1, 1)
      , c     = new Consumer(dateStr)
      , valid = true;
    this.eval({
      letters: consumeLetters
    , text   : consumeText
    });
    return valid ? date : null;

    //--- subroutines ---//

    /** 日付書式文字列を読み込む */
    function consumeLetters(letters) {
      var m;
      switch (letters) {
        case &quot;yyyy&quot;:
          (m = c.consume(/^\d{1,4}/)) &amp;&amp; date.setFullYear(Number(m[0]));
          break;

        case &quot;yy&quot;:
          (m = c.consume(/^\d{1,4}/)) &amp;&amp; setYear(date, Number(m[0]));
          break;

        case &quot;M&quot;: case &quot;MM&quot;:
          (m = c.consume(/^\d{1,2}/)) &amp;&amp; date.setMonth(Number(m[0]) -1);
          break;

        case &quot;d&quot;: case &quot;dd&quot;:
          (m = c.consume(/^\d{1,2}/)) &amp;&amp; date.setDate(Number(m[0]));
          break;

        default:
          m = null;
      }
      if (!m) {
        valid = false;
        return false;
      }
    }

    /** リテラル文字列を読み込む */
    function consumeText(text) {
      return c.consume(&quot;^&quot; + RegExp.escape(text));
    }

    /** 2桁表記の年を設定する。(設定年は現在から80年前～20年後の範囲に収める) */
    function setYear(date, yy) {
      var currentCentury, year;

      if (yy.length &gt; 2) {
        date.setFullYear(Number(yy));
        return;
      }

      currentCentury = new Date().getFullYear().toString().first(2);
      year = Date.create(currentCentury + (&quot;0&quot; + yy).last(2));

      year = year.isAfter(&quot;20 years after&quot;)  ? year.rewind(&quot;100 years&quot;)
           : year.isBefore(&quot;80 yeas before&quot;) ? year.advance(&quot;100 years&quot;)
           : year;

      date.setFullYear(year.getFullYear());
    }
  }

  function SimpleDateFormat_format(date, locale) {
    var buff = []
      , valid = null;
    locale = locale || &quot;ja&quot;;

    if (!date || !Object.isDate(date)) {
      return &quot;&quot;;
    }

    valid = this.eval({
      letters : consumeLetters
    , text    : consumeText
    });
    return valid ? buff.join(&quot;&quot;) : &quot;&quot;;

    //--- subroutines ---//
    /** 日付書式文字を読み込む */
    function consumeLetters(letters) {
      switch (letters) {
        case &quot;yyyy&quot;: buff.push((&quot;000&quot; + date.getFullYear()).last(4));  break;
        case &quot;yy&quot;  : buff.push(date.getFullYear().toString().last(2)); break;
        case &quot;M&quot;   : buff.push(date.getMonth()+1);                     break;
        case &quot;MM&quot;  : buff.push((&quot;0&quot; + (date.getMonth()+1)).last(2));   break;
        case &quot;MMM&quot; : buff.push(date.format(&quot;{Mon}&quot;, locale));          break;
        case &quot;d&quot;   : buff.push(date.getDate());                        break;
        case &quot;dd&quot;  : buff.push((&quot;0&quot; + date.getDate()).last(2));        break;
        case &quot;EEEE&quot;: buff.push(date.format(&quot;{Weekday}&quot;, locale));      break;
        case &quot;E&quot;   : buff.push(date.format(&quot;{Dow}&quot;, locale));          break;
        default:;
      }
    }
    /** リテラル文字を読み込む */
    function consumeText(text) {
      buff.push(text);
    }
  }

  function SimpleDateFormat_eval(action) {
    var c = new Consumer(this.pattern);
    action = action || {};
    var result = c.some(token);
    return result;

    function token(c) {
      return c.consume(letters, action.letters)
          || c.consume(text,    action.text);
    }

    function letters(c) {
      return c.consume(/^([a-zA-Z])\1*/);
    }

    function text(c) {
      return c.consume(quotedText)
          || c.consume(unquotedText);
    }

    function quotedText(c) {
      return c.consume(/^&#x27;([^&#x27;]|&#x27;&#x27;)+&#x27;/);
    }

    function unquotedText(c) {
      return c.consume(/^[^a-zA-Z&#x27;]+/);
    }
  }

  /**
   * 簡易スキャナ
   */
  Consumer.prototype = {
    // properties
    source  : null
  , pos     : null
  , action  : null
    // methods
  , some    : Consumer_some
  , consume : Consumer_consume
  , ended   : function() { return (this.pos &gt; this.source.length); }
  };

  /**
   * コンストラクタ
   * @param source   入力文字列
   * @param actions  実行するアクション
   * @returns {Consumer} インスタンス
   */
  function Consumer(source) {
    this.source  = source;
    this.pos     = 0;              // 次回読み出し開始位置
  }

  /**
   * 指定された正規表現、もしくはルールを読み込む
   * @param pattern {RegExp} 読み込むパターン
   * @param pattern {String} 読み込むパターン
   * @param pattern {Function} 読み込むルール
   */
  function Consumer_consume(pattern, action) {
    var self = this
      , head = this.pos
      , m    = null;

    m = Object.isRegExp(pattern)   ? consumePattern(pattern)
      : Object.isString(pattern)   ? consumePattern(new RegExp(pattern))
      : Object.isFunction(pattern) ? consumeFunction(pattern)
      : null;

    if (!m) {
      this.pos = head;
    }

    if (m &amp;&amp; action &amp;&amp; Object.isFunction(action)) {
      if (action.apply(self, m) === false) {
        return null;
      }
    }
    return m;

    //--- subroutines ---//
    /** パターンを読み込む */
    function consumePattern(regex) {
      var m = regex.exec(self.source.substring(self.pos));
      if (m) {
         self.pos += m[0].length;
      }
      return m;
    }

    /** ルールを読み込む */
    function consumeFunction(func) {
      return func.call(null, self);
    }
  }

  /**
   * 指定されたルールを1回以上読み込む。
   * @param func {Function} ルール
   */
  function Consumer_some(func) {
    var m = this.consume(func)
      , result = m;

    while (m &amp;&amp; !this.ended()) {
      m = this.consume(func);
    }
    return result;
  }

  return define();
});


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
