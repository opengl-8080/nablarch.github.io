


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv='content-language' content='ja'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.2.10. Session Variable Store Handler &mdash; ∇Nablarch  5u19 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  

  
  <link rel="canonical" href="https://nablarch.github.io/docs/LATEST/doc/application_framework/application_framework/handlers/web/SessionStoreHandler.html" />
  
    <link rel="top" title="∇Nablarch  5u19 documentation" href="../../../../index.html"/>
        <link rel="up" title="6.2. Web Application Dedicated Handler" href="index.html"/>
        <link rel="next" title="6.2.11. HTTP Request Dispatch Handler" href="http_request_java_package_mapping.html"/>
        <link rel="prev" title="6.2.9. Multipart Request Handler" href="multipart_handler.html"/>
 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  
  <a href="../../../../index.html" id="sidebar-title" class="icon"> ∇Nablarch 
  

  
    <div id="sidebar-version">Version: 5u19</div>
  </a>

  <div role="search">
    <form id="google-search-form" class="wy-form" method="get" action="https://www.google.co.jp/search">
      <input type="text" name="text" placeholder="Search docs on google" id="text"/>
      <input type="hidden" name="q" id="q"/>
    </form>
  </div>
    
    

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../about_nablarch/index.html">What is the Nablarch?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/concept.html">Nablarch Concept</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#robustness">Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#testability">Testability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../about_nablarch/concept.html#ready-to-use">Ready-to-Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/mvn_module.html">Module List of Nablarch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../about_nablarch/license.html">Information on Nablarch License</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Nablarch Application Framework</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Application Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../nablarch/index.html">1. What is Nablarch Application Framework?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/index.html">2. Web Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web_service/index.html">3. Web Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../batch/index.html">4. Batch Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../messaging/index.html">5. Messaging</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">6. Standard Handler Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../libraries/index.html">7. Libraries Provided by Nablarch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../blank_project/index.html">8. Blank Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../setting_guide/index.html">9. Nablarch Application Framework Configuration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/index.html">10. Default Configuration List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cloud_native/index.html">11. Nablarch Cloud Native Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../adaptors/index.html">Adaptor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/log_adaptor.html">log Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/router_adaptor.html">Routing Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/webspheremq_adaptor.html">IBM WebSphere MQ Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/jaxrs_adaptor.html">JAX-RS Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/doma_adaptor.html">Doma Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/jsr310_adaptor.html">JSR310(Date and Time API)Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_freemarker_adaptor.html">E-mail FreeMarker Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_thymeleaf_adaptor.html">E-mail Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/mail_sender_velocity_adaptor.html">E-mail Velocity Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/web_thymeleaf_adaptor.html">Web Application Thymeleaf Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/lettuce_adaptor.html">Lettuce Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/slf4j_adaptor.html">SLF4J Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../adaptors/micrometer_adaptor.html">Micrometer Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../example/index.html">Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../example/index.html#procedure-to-build-the-environment">Procedure to build the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../example/index.html#application-execution-procedure">Application execution procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../extension_components/index.html">Nablarch extension component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/report/index.html">1. Form library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/workflow/doc/index.html">2. Workflow library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/workflow/tool/index.html">3. Workflow definition data generation tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/etl/index.html">4. ETL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extension_components/etl/etl_maven_plugin.html">5. ETL Maven plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development_tools/index.html">Nablarch development tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html">1. Efficient Java Static Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#conduct-syntax-check">1.1. Conduct syntax check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#unify-the-format">1.2. Unify the format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/java_static_analysis/index.html#check-if-unauthorized-apis-are-being-used">1.3. Check if unauthorized APIs are being used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/ui_dev/index.html">2. Front-end UI development platform for advanced users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/testing_framework/index.html">3. Testing framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/05_UnitTestGuide/index.html">3.1. How to Execute Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/06_TestFWGuide/index.html">3.2. How to Use the Automated Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/testing_framework/guide/development_guide/08_TestTools/index.html">3.3. Tools Used in the Programming Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../development_tools/toolbox/index.html">4. Useful Tools When Developing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/JspStaticAnalysis/index.html">4.1. JSP Static Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/SqlExecutor/SqlExecutor.html">4.2. Nablarch SQL Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../development_tools/toolbox/JspVerifier/JspVerifier.html">4.3. Job Screen JSP Validation Tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/index.html">Nablarch Implementation Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/01/index.html">Sample Password Encryption Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/0101_PBKDF2PasswordEncryptor.html">Sample Password Encryption Function Using PBKDF2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/01/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/02/index.html">Extended Validation Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#email-address-validation">Email address validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#validation-of-japan-telephone-numbers">Validation of Japan telephone numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/02/index.html#code-value-validation">Code value validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/03/index.html">Display a List of Search Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-use">How to Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#listsearchinfo-class">ListSearchInfo class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#listsearchresult-tag">listSearchResult tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#sort-search-results">Sort search results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-implement-displaying-a-list-of-all-search-results-on-a-single-screen">How to implement displaying a list of all search results on a single screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-implement-the-initial-display-of-search-results-with-the-default-search-conditions">How to implement the initial display of search results with the default search conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#default-settings-for-the-search-result-list-display-function">Default settings for the search result list display function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#how-to-import-a-sample-implementation-tag-file-into-the-business-application">How to import a sample implementation (tag file) into the business application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/03/index.html#tag-reference">Tag Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/04/index.html">Extended Formatter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/04/0401_ExtendedDataFormatter.html">Data Formatter Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/04/0402_ExtendedFieldType.html">Field Type Expansion in the Data Formatter Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/05/index.html">Sample File Management Function Using Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/05/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/06/index.html">CAPTCHA Function Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/06_Captcha_guide.html">How to Incorporate the CAPTCHA Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#delivery-package">Delivery package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/06/index.html#how-to-use">How to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/07/index.html">Sample UserAgent Information Acquisition Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#description-of-configuration">Description of configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/07/index.html#use-case">Use case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/08/index.html">Sample of HTML Email Send Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/08/index.html#implementation-examples">Implementation examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/09/index.html">How to Use a Sample to Send a Digitally Signed Email Using Bouncycastle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#environment-preparation">Environment preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#structure-of-digitally-signed-email-send-function">Structure of digitally signed email send function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#preparation-of-configuration-file">Preparation of configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/09/index.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/10/index.html">How to Use the Log Aggregation Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/10/index.html#list-of-samples-provided">List of samples provided</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples/11/index.html">Messaging Platform Test Simulator Sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#uses">Uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#request">Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#how-to-use">How to use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples/11/index.html#expansion-example">Expansion example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nablarch_api/index.html">Nablarch API</a></li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">∇Nablarch </a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../index.html">Nablarch Application Framework</a> &raquo;</li>
      
          <li><a href="../../index.html">Application Framework</a> &raquo;</li>
      
          <li><a href="../index.html">6. Standard Handler Provided by Nablarch</a> &raquo;</li>
      
          <li><a href="index.html">6.2. Web Application Dedicated Handler</a> &raquo;</li>
      
    <li>6.2.10. Session Variable Store Handler</li>
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/nablarch" class="fa fa-github">GitHub</a>
    </li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://nablarch.github.io/docs/LATEST/doc/index.html" class="ja">日本語</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="session-variable-store-handler">
<span id="session-store-handler"></span><h1>6.2.10. Session Variable Store Handler<a class="headerlink" href="#session-variable-store-handler" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#handler-class-name" id="id1">Handler class name</a></li>
<li><a class="reference internal" href="#module-list" id="id2">Module list</a></li>
<li><a class="reference internal" href="#constraints" id="id3">Constraints</a></li>
<li><a class="reference internal" href="#configure-for-using-session-store" id="id4">Configure for using session store</a></li>
<li><a class="reference internal" href="#serialize-the-session-variables-and-save-to-the-session-store" id="id5">Serialize the session variables and save to the session store</a></li>
<li><a class="reference internal" href="#check-the-session-store-for-tampering" id="id6">Check the session store for tampering</a></li>
<li><a class="reference internal" href="#configure-the-transition-destination-during-tampering-error" id="id7">Configure the transition destination during tampering error</a></li>
<li><a class="reference internal" href="#change-the-name-and-attributes-of-the-cookie-that-holds-the-session-id" id="id8">Change the name and attributes of the cookie that holds the session ID</a></li>
<li><a class="reference internal" href="#save-the-expiration-date-in-the-database" id="id9">Save the expiration date in the database</a><ul>
<li><a class="reference internal" href="#usage" id="id10">Usage</a></li>
</ul>
</li>
</ul>
</div>
<p>This handler stores the session variables added/updated/deleted in subsequent handlers and libraries in the session store.</p>
<p>For details of session store functions, see <a class="reference internal" href="../../libraries/session_store.html#session-store"><span>Session Store</span></a> .</p>
<p>The process flow of this handler is as follows.</p>
<img alt="../../../../_images/flow25.png" src="../../../../_images/flow25.png" />
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>If processing of the same session is executed by multiple threads (for example, if there are requests from multiple tabs in the browser at the same time), then depending on the store being used, the request that comes last will be processed. See the below image for details.</p>
<a class="reference internal image-reference" href="../../../../_images/multi-thread.png"><img alt="../../../../_images/multi-thread.png" src="../../../../_images/multi-thread.png" /></a>
<p class="last">Therefore, it is necessary to fully understand the characteristics of the store to be used and select the store that meets the requirements. For details of the store, see <a class="reference internal" href="../../libraries/session_store.html#session-store-future-of-store"><span>Features and selection criteria of session store</span></a> .</p>
</div>
<div class="section" id="handler-class-name">
<h2><a class="toc-backref" href="#id1">6.2.10.1. Handler class name</a><a class="headerlink" href="#handler-class-name" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/session/SessionStoreHandler.html" title="nablarch.common.web.session.SessionStoreHandler">nablarch.common.web.session.SessionStoreHandler</a></li>
</ul>
</div>
<div class="section" id="module-list">
<h2><a class="toc-backref" href="#id2">6.2.10.2. Module list</a><a class="headerlink" href="#module-list" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.framework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-fw-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- Only when using the DB store or using save the expiration date in the database --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.nablarch.framework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>nablarch-fw-web-dbstore<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="constraints">
<span id="session-store-handler-constraint"></span><h2><a class="toc-backref" href="#id3">6.2.10.3. Constraints</a><a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Place this handler after the <a class="reference internal" href="http_response_handler.html#http-response-handler"><span>HTTP Response Handler</span></a></dt>
<dd>During servlet forward, this handler must be placed after the <a class="reference internal" href="http_response_handler.html#http-response-handler"><span>HTTP Response Handler</span></a> so that the value of the session store can be accessed at the forward destination.</dd>
<dt>Place this handler after the <a class="reference internal" href="multipart_handler.html#multipart-handler"><span>Multipart Request Handler</span></a></dt>
<dd>This handler must be placed after the <a class="reference internal" href="multipart_handler.html#multipart-handler"><span>Multipart Request Handler</span></a> so that the request parameters can be accessed when using the HIDDEN store.</dd>
<dt>Place this handler before the <a class="reference internal" href="forwarding_handler.html#forwarding-handler"><span>Internal Forward Handler</span></a></dt>
<dd>Although the session store is read and saved multiple times if the <a class="reference internal" href="forwarding_handler.html#forwarding-handler"><span>Internal Forward Handler</span></a> is configured before this handler, the HIDDEN store reads the session variable from the request parameter and saves the session variable in the request scope. Therefore, there is a problem that the latest session variable cannot be obtained when using the HIDDEN store during internal forward. Therefore, place this handler before the <a class="reference internal" href="forwarding_handler.html#forwarding-handler"><span>Internal Forward Handler</span></a> .</dd>
</dl>
</div>
<div class="section" id="configure-for-using-session-store">
<h2><a class="toc-backref" href="#id4">6.2.10.4. Configure for using session store</a><a class="headerlink" href="#configure-for-using-session-store" title="Permalink to this headline">¶</a></h2>
<p>To use the session store, configure <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/session/SessionManager.html" title="nablarch.common.web.session.SessionManager">SessionManager</a> which has been configured as given below to the property <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/session/SessionStoreHandler.html#setSessionManager-nablarch.common.web.session.SessionManager-" title="nablarch.common.web.session.SessionStoreHandler.setSessionManager(nablarch.common.web.session.SessionManager)">sessionManager</a> of this handler.</p>
<ul class="simple">
<li>Session store used by the application (multiple specifications possible)</li>
<li>Session store name used by default</li>
</ul>
<p>Configure the handler by referring to the configuration example given below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.web.session.SessionStoreHandler&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sessionManager&quot;</span> <span class="na">ref=</span><span class="s">&quot;sessionManager&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="c">&lt;!-- Configure with the component name &quot;sessionManager&quot; --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;sessionManager&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.web.session.SessionManager&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Property configuration is omitted --&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>For details of the property configured in <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/session/SessionManager.html" title="nablarch.common.web.session.SessionManager">SessionManager</a> , see <a class="reference internal" href="../../libraries/session_store.html#session-store-use-config"><span>Configure for using session store</span></a> .</p>
</div>
<div class="section" id="serialize-the-session-variables-and-save-to-the-session-store">
<h2><a class="toc-backref" href="#id5">6.2.10.5. Serialize the session variables and save to the session store</a><a class="headerlink" href="#serialize-the-session-variables-and-save-to-the-session-store" title="Permalink to this headline">¶</a></h2>
<p>When saving the session variable in the session store with this handler, the serialization mechanism can be selected.</p>
<p>For details on the serialization mechanism that can be selected, see <a class="reference internal" href="../../libraries/session_store.html#session-store-serialize"><span>Serialization mechanism for session variable can be selected</span></a> .</p>
</div>
<div class="section" id="check-the-session-store-for-tampering">
<h2><a class="toc-backref" href="#id6">6.2.10.6. Check the session store for tampering</a><a class="headerlink" href="#check-the-session-store-for-tampering" title="Permalink to this headline">¶</a></h2>
<p>When reading the session variables from the session store, check the session store for tampering.</p>
<dl class="docutils">
<dt>When tampering of the HIDDEN store is detected</dt>
<dd><a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/fw/web/HttpErrorResponse.html" title="nablarch.fw.web.HttpErrorResponse">HttpErrorResponse</a> of status code 400 is thrown.</dd>
<dt>When tampering of other stores is detected</dt>
<dd>Exception that occurred during the decryption process of the session store is thrown without any changes.</dd>
</dl>
</div>
<div class="section" id="configure-the-transition-destination-during-tampering-error">
<span id="session-store-handler-error-forward-path"></span><h2><a class="toc-backref" href="#id7">6.2.10.7. Configure the transition destination during tampering error</a><a class="headerlink" href="#configure-the-transition-destination-during-tampering-error" title="Permalink to this headline">¶</a></h2>
<p>The error page displayed when the tampering of the session store is detected must be described in <cite>web.xml</cite>. This handler must be configured before the <a class="reference internal" href="forwarding_handler.html#forwarding-handler"><span>Internal Forward Handler</span></a> as described in the <a class="reference internal" href="#session-store-handler-constraint"><span>Constraints</span></a> . In this case, <a class="reference internal" href="HttpErrorHandler.html#httperrorhandler-defaultpage"><span>Configuration of the default page</span></a> cannot be applied to the exception that occurs in this handler for the following reasons. Therefore, configuration in <cite>web.xml</cite> is required.</p>
<dl class="docutils">
<dt>Reason</dt>
<dd><p class="first"><a class="reference internal" href="forwarding_handler.html#forwarding-handler"><span>Internal Forward Handler</span></a> must be configured before the <a class="reference internal" href="HttpErrorHandler.html#http-error-handler"><span>HTTP Error Control Handler</span></a> . This configuration order is required to correctly handle the internal forward path specified for <a class="reference internal" href="HttpErrorHandler.html#httperrorhandler-defaultpage"><span>Configuration of the default page</span></a> of the <a class="reference internal" href="HttpErrorHandler.html#http-error-handler"><span>HTTP Error Control Handler</span></a> .</p>
<p class="last">As a result, when an exception occurs in the handler that is configured before the <a class="reference internal" href="forwarding_handler.html#forwarding-handler"><span>Internal Forward Handler</span></a> , the configuration value in the <a class="reference internal" href="HttpErrorHandler.html#httperrorhandler-defaultpage"><span>Configuration of the default page</span></a> cannot be applied. Therefore, configuration in <cite>web.xml</cite> is required.</p>
</dd>
</dl>
</div>
<div class="section" id="change-the-name-and-attributes-of-the-cookie-that-holds-the-session-id">
<h2><a class="toc-backref" href="#id8">6.2.10.8. Change the name and attributes of the cookie that holds the session ID</a><a class="headerlink" href="#change-the-name-and-attributes-of-the-cookie-that-holds-the-session-id" title="Permalink to this headline">¶</a></h2>
<p>The name and attributes of the cookie that holds the session ID can be changed to an arbitrary value.</p>
<p>The default configuration is as follows.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Cookie name:</th><td class="field-body"><div class="first last line-block">
<div class="line">NABLARCH_SID</div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Path attribute:</th><td class="field-body"><div class="first last line-block">
<div class="line">All paths under the host</div>
<div class="line">Set this option separately if you want to explicitly specify all paths that can be sent</div>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">Domain attribute:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"><div class="first last line-block">
<div class="line">Not specified</div>
<div class="line">Set this option separately if you want to explicitly specify all domains that can be sent</div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Secure attribute:</th></tr>
<tr class="field-even field"><td>&nbsp;</td><td class="field-body"><div class="first last line-block">
<div class="line">Not used</div>
<div class="line">To use in an HTTPS environment, configure to <code class="docutils literal"><span class="pre">Use</span></code></div>
</div>
</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">MaxAge attribute:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">HttpOnly attribute:</th></tr>
<tr class="field-even field"><td>&nbsp;</td><td class="field-body"><div class="first last line-block">
<div class="line">Use if the Servlet API version is 3.0 or higher</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>To change the cookie name or attribute, refer to the example given below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.web.session.SessionStoreHandler&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Cookie name --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;cookieName&quot;</span> <span class="na">value=</span><span class="s">&quot;NABLARCH_SID&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- Path attribute --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;cookiePath&quot;</span> <span class="na">value=</span><span class="s">&quot;/&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- Domain attribute --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;cookieDomain&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- Secure attribute --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;cookieSecure&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- Session manager --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sessionManager&quot;</span> <span class="na">ref=</span><span class="s">&quot;sessionManager&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;sessionManager&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.web.session.SessionManager&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;availableStores&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;list&gt;</span>
      <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.web.session.store.DbStore&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- Expiry interval --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;expires&quot;</span> <span class="na">value=</span><span class="s">&quot;1800&quot;</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- Other properties are omitted --&gt;</span>
      <span class="nt">&lt;/component&gt;</span>
    <span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
  <span class="c">&lt;!-- Other properties are omitted --&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>The MaxAge attribute is not used because the cookie holding the session ID is a session cookie (cookie that is destroyed when the browser is closed).</p>
<p class="last">The expiry interval of the session store is saved in the HTTP session. If different expiry intervals are configured between multiple stores, the longest expiry interval value is stored in the HTTP session.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Since the value of HttpOnly attribute is determined by the version of the Servlet API used in the application, an arbitrary value cannot be specified from the configuration file.</p>
</div>
</div>
<div class="section" id="save-the-expiration-date-in-the-database">
<span id="db-managed-expiration"></span><h2><a class="toc-backref" href="#id9">6.2.10.9. Save the expiration date in the database</a><a class="headerlink" href="#save-the-expiration-date-in-the-database" title="Permalink to this headline">¶</a></h2>
<p>You can change where the session expiration date is stored.</p>
<p>By default, <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/session/HttpSessionManagedExpiration.html" title="nablarch.common.web.session.HttpSessionManagedExpiration">HttpSessionManagedExpiration</a>
is used, so the session expiration is stored in the HTTP session.</p>
<p>You can save the session expiration  to the database by setting the <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/session/DbManagedExpiration.html" title="nablarch.common.web.session.DbManagedExpiration">DbManagedExpiration</a>
to the <a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/session/SessionStoreHandler.html#setExpiration-nablarch.common.web.session.Expiration-" title="nablarch.common.web.session.SessionStoreHandler.setExpiration(nablarch.common.web.session.Expiration)">expiration</a> property of this handler.</p>
<div class="section" id="usage">
<h3><a class="toc-backref" href="#id10">6.2.10.9.1. Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>The table used to store the expiratoin date on the database shall be the table described in the <a class="reference internal" href="../../libraries/session_store.html#session-store-use-config"><span>DB store</span></a> when using the DB store.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">When saving the expiration date to the database, the SESSION_OBJECT column must not be a required attribute.
The SESSION_OBJECT column will be registered as null on logout, etc., so it must be defined as a null-allowed attribute.
In projects created from archetypes before 5u15, it is defined as a required attribute by default.
It is necessary to issue ALTER statement or recreate the table if necessary.</p>
</div>
<p>If you change the table name and column names, define a component of the
<a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/session/store/UserSessionSchema.html" title="nablarch.common.web.session.store.UserSessionSchema">UserSessionSchema</a> in
<a class="reference external" href="https://nablarch.github.io/docs/LATEST/javadoc/nablarch/common/web/session/DbManagedExpiration.html#setUserSessionSchema-nablarch.common.web.session.store.UserSessionSchema-" title="nablarch.common.web.session.DbManagedExpiration.setUserSessionSchema(nablarch.common.web.session.store.UserSessionSchema)">DbManagedExpiration.userSessionSchema</a>.
Change the table columns in the DB store to the same ones.</p>
<p>Also, the expiration date needs <a class="reference internal" href="../../libraries/repository.html#repository-initialize-object"><span>initialize</span></a>.</p>
<p>An example setting is shown below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;sessionStoreHandler&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.web.session.SessionStoreHandler&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Other properties are omitted --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;expiration&quot;</span> <span class="na">ref=</span><span class="s">&quot;expiration&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;expiration&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.web.session.DbManagedExpiration&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- A class that provides transaction control to the database --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dbManager&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;component</span> <span class="na">class=</span><span class="s">&quot;nablarch.core.db.transaction.SimpleDbTransactionManager&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dbTransactionName&quot;</span> <span class="na">value=</span><span class="s">&quot;expirationTransaction&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/component&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
  <span class="c">&lt;!-- The following settings are required only when changing table names</span>
<span class="c">       and column names from the above table definition --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;userSessionSchema&quot;</span> <span class="na">ref=</span><span class="s">&quot;userSessionSchema&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="c">&lt;!-- When you change the table definition, change the DB store definition as well --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;dbStore&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.web.session.store.DbStore&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Other properties are omitted --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;userSessionSchema&quot;</span> <span class="na">ref=</span><span class="s">&quot;userSessionSchema&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="c">&lt;!-- The following settings are required only when changing table names</span>
<span class="c">     and column names from the above table definition --&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;userSessionSchema&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.common.web.session.store.UserSessionSchema&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;tableName&quot;</span> <span class="na">value=</span><span class="s">&quot;USER_SESSION_DB&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sessionIdName&quot;</span> <span class="na">value=</span><span class="s">&quot;SESSION_ID_COL&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sessionObjectName&quot;</span> <span class="na">value=</span><span class="s">&quot;SESSION_OBJECT_COL&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;expirationDatetimeName&quot;</span> <span class="na">value=</span><span class="s">&quot;EXPIRATION_DATETIME_COL&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;initializer&quot;</span> <span class="na">class=</span><span class="s">&quot;nablarch.core.repository.initialization.BasicApplicationInitializer&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Requires initialization for expiration date --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;initializeList&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;list&gt;</span>
      <span class="nt">&lt;component-ref</span> <span class="na">name=</span><span class="s">&quot;expiration&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
        <p>
            &copy; Copyright 2010-2021, TIS Inc.
        </p>
    </div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'5u19',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>